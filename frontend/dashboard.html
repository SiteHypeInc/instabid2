<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InstaBid - Contractor Dashboard</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.container {
  max-width: 1600px;
  margin: 0 auto;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  border-radius: 12px 12px 0 0;
}

.header h1 {
  font-size: 2em;
  margin-bottom: 5px;
}

.header p {
  opacity: 0.9;
  font-size: 1.1em;
}

.main-tabs {
  display: flex;
  background: #2c3e50;
  padding: 0 20px;
}

.main-tab {
  padding: 18px 30px;
  cursor: pointer;
  border: none;
  background: none;
  font-size: 1.1em;
  font-weight: 600;
  color: #ecf0f1;
  border-bottom: 4px solid transparent;
  transition: all 0.3s;
}

.main-tab:hover {
  background: rgba(255,255,255,0.1);
}

.main-tab.active {
  background: white;
  color: #667eea;
  border-bottom-color: #667eea;
}

.sub-tabs {
  display: flex;
  background: #f8f9fa;
  border-bottom: 2px solid #ddd;
  padding: 0 20px;
  flex-wrap: wrap;
}

.sub-tab {
  padding: 12px 20px;
  cursor: pointer;
  border: none;
  background: none;
  font-size: 0.95em;
  font-weight: 600;
  color: #666;
  border-bottom: 3px solid transparent;
  transition: all 0.3s;
}

.sub-tab:hover {
  color: #667eea;
}

.sub-tab.active {
  color: #667eea;
  border-bottom-color: #667eea;
}

.content {
  padding: 30px;
  min-height: 500px;
}

.main-content {
  display: none;
}

.main-content.active {
  display: block;
}

.sub-content {
  display: none;
}

.sub-content.active {
  display: block;
}

.section-title {
  font-size: 1.5em;
  color: #333;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #667eea;
}

.config-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.config-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  border: 2px solid #ddd;
}

.config-card h3 {
  font-size: 1.2em;
  color: #667eea;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.config-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid #ddd;
}

.config-item:last-child {
  border-bottom: none;
}

.config-item label {
  font-weight: 600;
  color: #333;
  flex: 1;
}

.config-item input {
  width: 140px;
  padding: 8px 12px;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 1em;
  text-align: right;
}

.config-item input:focus {
  outline: none;
  border-color: #667eea;
}

.btn-save {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 14px 35px;
  font-size: 1.1em;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 20px;
}

.btn-save:hover {
  opacity: 0.9;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-cancel {
  background: #dc3545;
  color: white;
  border: none;
  padding: 14px 35px;
  font-size: 1.1em;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 20px;
}

.btn-cancel:hover {
  opacity: 0.9;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
}

.status-message {
  padding: 15px;
  border-radius: 6px;
  margin-top: 20px;
  display: none;
}

.status-message.success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.status-message.error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.info-box {
  background: #e7f3ff;
  border-left: 4px solid #2196F3;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 4px;
}

.info-box p {
  color: #0d47a1;
  margin: 5px 0;
}

.placeholder-content {
  text-align: center;
  padding: 60px 20px;
  color: #999;
}

.placeholder-content h2 {
  font-size: 2em;
  margin-bottom: 10px;
}
</style>

</head>
<body>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5u7bMfb76Il4K9x6oP-k2wccwB1mbSP0&libraries=places"></script>

  <!-- ‚úÖ GLOBAL CONSTANTS - DECLARED FIRST THING IN BODY -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  window.RAILWAY_API = 'https://roofbid-backend-production.up.railway.app';
  window.INSTABID_API_KEY = 'ib_74064730bb369effbc6bdfe50b5352e72180054351a5f3afb87839af29b029be';
  console.log('‚úÖ window.RAILWAY_API loaded:', window.RAILWAY_API);
</script>

<!-- ‚úÖ SUPABASE INITIALIZATION -->
<script>
  // Wait for Supabase library to load, then initialize
  window.addEventListener('load', function() {
    if (window.supabase && window.supabase.createClient) {
      window.supabaseClient = window.supabase.createClient(
        'https://audvkmgaufxzylebtmpx.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF1ZHZrbWdhdWZ4enlsZWJ0bXB4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU2OTMxMTUsImV4cCI6MjA1MTI2OTExNX0.0KkQs7vLqM_k7cFV-TT-VxJpLKvxZOWfDKF5e2JF6Ag'
      );
      console.log('‚úÖ Supabase initialized');
    } else {
      console.error('‚ùå Supabase library not loaded');
    }
  });
</script>

<div class="container">
  <div class="header">
    <h1>‚öôÔ∏è InstaBid Contractor Dashboard</h1>
    <p>Manage pricing, regional adjustments, company profile, and contracts</p>
  </div>

  <div class="main-tabs">
    <button class="main-tab active" data-main="price-adjustments">üí∞ Price Adjustments</button>
    <button class="main-tab" data-main="estimate-tracker">üìä Estimate Tracker</button>
    <button class="main-tab" data-main="company-profile">üè¢ Company Profile</button>
    <button class="main-tab" data-main="contracts">üìÑ Contract Templates</button>
  </div>

  <div class="content">
    
    <div class="main-content active" id="price-adjustments">
      
  <div class="sub-tabs">
    <button class="sub-tab active" data-sub="roofing">üè† Roofing</button>
    <button class="sub-tab" data-sub="hvac">‚ùÑÔ∏è HVAC</button>
    <button class="sub-tab" data-sub="electrical">‚ö° Electrical</button>
    <button class="sub-tab" data-sub="plumbing">üö∞ Plumbing</button>
    <button class="sub-tab" data-sub="flooring">üìê Flooring</button>
    <button class="sub-tab" data-sub="painting">üé® Painting</button>
    <button class="sub-tab" data-sub="drywall">üß± Drywall</button>
    <button class="sub-tab" data-sub="siding">üèòÔ∏è Siding</button>
    <button class="sub-tab" data-sub="regional">üó∫Ô∏è Regional</button>
  </div>

      <div class="sub-content active" id="roofing">
        <h2 class="section-title">Roofing Configuration</h2>
        
        <div class="config-grid">
          <div class="config-card">
            <h3>üî∫ Pitch Multipliers</h3>
            <div class="config-item">
              <label>3/12 - 4/12 (Low):</label>
              <input type="number" step="0.05" id="pitch_low" value="1.0">
            </div>
            <div class="config-item">
              <label>5/12 - 6/12 (Medium):</label>
              <input type="number" step="0.05" id="pitch_med" value="1.2">
            </div>
            <div class="config-item">
              <label>7/12 - 9/12 (High):</label>
              <input type="number" step="0.05" id="pitch_high" value="1.4">
            </div>
            <div class="config-item">
              <label>10/12+ (Steep):</label>
              <input type="number" step="0.05" id="pitch_steep" value="1.8">
            </div>
          </div>

          <div class="config-card">
            <h3>üè¢ Story Multipliers</h3>
            <div class="config-item">
              <label>1 Story:</label>
              <input type="number" step="0.05" id="story_1" value="1.0">
            </div>
            <div class="config-item">
              <label>2 Story:</label>
              <input type="number" step="0.05" id="story_2" value="1.3">
            </div>
            <div class="config-item">
              <label>3+ Story:</label>
              <input type="number" step="0.05" id="story_3" value="1.6">
            </div>
          </div>

          <div class="config-card">
            <h3>üì¶ Material Costs (per sqft)</h3>
            <div class="config-item">
              <label>Asphalt Shingles:</label>
              <input type="number" step="0.1" id="mat_asphalt" value="2.5">
            </div>
            <div class="config-item">
              <label>Architectural:</label>
              <input type="number" step="0.1" id="mat_arch" value="3.5">
            </div>
            <div class="config-item">
              <label>Metal:</label>
              <input type="number" step="0.1" id="mat_metal" value="5.0">
            </div>
            <div class="config-item">
              <label>Tile:</label>
              <input type="number" step="0.1" id="mat_tile" value="7.0">
            </div>
            <div class="config-item">
              <label>Slate:</label>
              <input type="number" step="0.1" id="mat_slate" value="12.0">
            </div>
          </div>

          <div class="config-card">
            <h3>üíµ Fixed Costs</h3>
            <div class="config-item">
              <label>Tear-Off (per layer):</label>
              <input type="number" step="50" id="tearoff_cost" value="1500">
            </div>
            <div class="config-item">
              <label>Plywood (per sqft):</label>
              <input type="number" step="0.5" id="plywood_cost" value="4.5">
            </div>
            <div class="config-item">
              <label>Chimney Flashing:</label>
              <input type="number" step="50" id="chimney_cost" value="400">
            </div>
            <div class="config-item">
              <label>Valley (per linear ft):</label>
              <input type="number" step="1" id="valley_cost" value="8">
            </div>
            <div class="config-item">
              <label>Skylight:</label>
              <input type="number" step="50" id="skylight_cost" value="300">
            </div>
            <div class="config-item">
              <label>Ridge Vent (per ft):</label>
              <input type="number" step="1" id="ridge_cost" value="10">
            </div>
          </div>
        </div>

        <button class="btn-save" onclick="saveConfig('roofing')">üíæ Save Roofing Config</button>
        <div class="status-message" id="roofing-status"></div>
      </div>

      <div class="sub-content" id="hvac">
        <h2 class="section-title">HVAC Configuration</h2>
        
        <div class="config-grid">
          <div class="config-card">
            <h3>üè† Home Size Multipliers</h3>
            <div class="config-item">
              <label>< 1500 sqft:</label>
              <input type="number" step="0.05" id="hvac_size_small" value="0.9">
            </div>
            <div class="config-item">
              <label>1500-2500 sqft:</label>
              <input type="number" step="0.05" id="hvac_size_med" value="1.0">
            </div>
            <div class="config-item">
              <label>2500-4000 sqft:</label>
              <input type="number" step="0.05" id="hvac_size_large" value="1.2">
            </div>
            <div class="config-item">
              <label>> 4000 sqft:</label>
              <input type="number" step="0.05" id="hvac_size_xlarge" value="1.4">
            </div>
          </div>

          <div class="config-card">
            <h3>‚ùÑÔ∏è Unit Costs (Base)</h3>
            <div class="config-item">
              <label>Furnace (Gas):</label>
              <input type="number" step="100" id="hvac_furnace" value="3500">
            </div>
            <div class="config-item">
              <input type="number" step="100" id="hvac_ac" value="4000">
            </div>
            <div class="config-item">
              <label>Heat Pump:</label>
              <input type="number" step="100" id="hvac_heatpump" value="5500">
            </div>
            <div class="config-item">
              <label>Mini-Split (per head):</label>
              <input type="number" step="100" id="hvac_minisplit" value="2500">
            </div>              <label>AC Unit (Central):</label>

          </div>

          <div class="config-card">
            <h3>‚öôÔ∏è Additional Costs</h3>
            <div class="config-item">
              <label>Ductwork (per ft):</label>
              <input type="number" step="1" id="hvac_duct" value="15">
            </div>
            <div class="config-item">
              <label>Thermostat (Smart):</label>
              <input type="number" step="10" id="hvac_thermostat" value="350">
            </div>
            <div class="config-item">
              <label>Air Handler:</label>
              <input type="number" step="100" id="hvac_handler" value="1200">
            </div>
          </div>

          <div class="config-card">
            <h3>üîß Complexity Multipliers</h3>
            <div class="config-item">
              <label>Standard Install:</label>
              <input type="number" step="0.05" id="hvac_standard" value="1.0">
            </div>
            <div class="config-item">
              <label>Moderate (2 story):</label>
              <input type="number" step="0.05" id="hvac_moderate" value="1.2">
            </div>
            <div class="config-item">
              <label>Complex (3+, tight):</label>
              <input type="number" step="0.05" id="hvac_complex" value="1.5">
            </div>
          </div>
        </div>

        <button class="btn-save" onclick="saveConfig('hvac')">üíæ Save HVAC Config</button>
        <div class="status-message" id="hvac-status"></div>
      </div>

      <div class="sub-content" id="electrical">
        <h2 class="section-title">Electrical Configuration</h2>
        
        <div class="config-grid">
          <div class="config-card">
            <h3>üîå Panel & Service</h3>
            <div class="config-item">
              <label>100A Panel Upgrade:</label>
              <input type="number" step="100" id="elec_panel_100" value="1800">
            </div>
            <div class="config-item">
              <label>200A Panel Upgrade:</label>
              <input type="number" step="100" id="elec_panel_200" value="2500">
            </div>
            <div class="config-item">
              <label>Sub-Panel Install:</label>
              <input type="number" step="100" id="elec_subpanel" value="1200">
            </div>
          </div>

          <div class="config-card">
            <h3>üí° Fixtures & Devices</h3>
            <div class="config-item">
              <label>Outlet Install:</label>
              <input type="number" step="10" id="elec_outlet" value="125">
            </div>
            <div class="config-item">
              <label>Switch Install:</label>
              <input type="number" step="10" id="elec_switch" value="110">
            </div>
            <div class="config-item">
              <label>Light Fixture:</label>
              <input type="number" step="10" id="elec_fixture" value="150">
            </div>
            <div class="config-item">
              <label>Ceiling Fan:</label>
              <input type="number" step="10" id="elec_fan" value="200">
            </div>
            <div class="config-item">
              <label>GFCI Outlet:</label>
              <input type="number" step="10" id="elec_gfci" value="175">
            </div>
          </div>

          <div class="config-card">
            <h3>‚ö° Specialty Work</h3>
            <div class="config-item">
              <label>EV Charger (240V):</label>
              <input type="number" step="100" id="elec_ev" value="1200">
            </div>
            <div class="config-item">
              <label>Generator Hook-up:</label>
              <input type="number" step="100" id="elec_generator" value="1500">
            </div>
            <div class="config-item">
              <label>Hot Tub Circuit:</label>
              <input type="number" step="100" id="elec_hottub" value="800">
            </div>
          </div>

          <div class="config-card">
            <h3>üèóÔ∏è Labor Rates (per hour)</h3>
            <div class="config-item">
              <label>Standard Work:</label>
              <input type="number" step="5" id="elec_labor_std" value="85">
            </div>
            <div class="config-item">
              <label>Complex/Rework:</label>
              <input type="number" step="5" id="elec_labor_complex" value="110">
            </div>
          </div>
        </div>

        <button class="btn-save" onclick="saveConfig('electrical')">üíæ Save Electrical Config</button>
        <div class="status-message" id="electrical-status"></div>
      </div>

      <div class="sub-content" id="plumbing">
        <h2 class="section-title">Plumbing Configuration</h2>
        
        <div class="config-grid">
          <div class="config-card">
            <h3>üö∞ Fixtures</h3>
            <div class="config-item">
              <label>Toilet Install:</label>
              <input type="number" step="50" id="plumb_toilet" value="350">
            </div>
            <div class="config-item">
              <label>Sink/Faucet Install:</label>
              <input type="number" step="50" id="plumb_sink" value="400">
            </div>
            <div class="config-item">
              <label>Shower Install:</label>
              <input type="number" step="100" id="plumb_shower" value="1200">
            </div>
            <div class="config-item">
              <label>Bathtub Install:</label>
              <input type="number" step="100" id="plumb_tub" value="1500">
            </div>
            <div class="config-item">
              <label>Dishwasher Hook-up:</label>
              <input type="number" step="50" id="plumb_dishwasher" value="300">
            </div>
          </div>

          <div class="config-card">
            <h3>üîß Water Systems</h3>
            <div class="config-item">
              <label>Water Heater (Tank):</label>
              <input type="number" step="100" id="plumb_heater_tank" value="1800">
            </div>
            <div class="config-item">
              <label>Water Heater (Tankless):</label>
              <input type="number" step="100" id="plumb_heater_tankless" value="3200">
            </div>
            <div class="config-item">
              <label>Sump Pump:</label>
              <input type="number" step="50" id="plumb_sump" value="850">
            </div>
            <div class="config-item">
              <label>Water Softener:</label>
              <input type="number" step="100" id="plumb_softener" value="1400">
            </div>
          </div>

          <div class="config-card">
            <h3>üöø Pipes & Drains</h3>
            <div class="config-item">
              <label>Pipe Repair (per ft):</label>
              <input type="number" step="5" id="plumb_pipe_repair" value="45">
            </div>
            <div class="config-item">
              <label>Pipe Replace (per ft):</label>
              <input type="number" step="5" id="plumb_pipe_replace" value="75">
            </div>
            <div class="config-item">
              <label>Drain Clearing:</label>
              <input type="number" step="25" id="plumb_drain" value="250">
            </div>
            <div class="config-item">
              <label>Sewer Line (per ft):</label>
              <input type="number" step="10" id="plumb_sewer" value="125">
            </div>
          </div>

          <div class="config-card">
            <h3>‚öôÔ∏è Labor Rates (per hour)</h3>
            <div class="config-item">
              <label>Standard Work:</label>
              <input type="number" step="5" id="plumb_labor_std" value="95">
            </div>
            <div class="config-item">
              <label>Emergency/Complex:</label>
              <input type="number" step="5" id="plumb_labor_emerg" value="140">
            </div>
          </div>
        </div>

        <button class="btn-save" onclick="saveConfig('plumbing')">üíæ Save Plumbing Config</button>
        <div class="status-message" id="plumbing-status"></div>
      </div>

      <div class="sub-content" id="flooring">
        <h2 class="section-title">Flooring Configuration</h2>
        
        <div class="config-grid">
          <div class="config-card">
            <h3>üìê Material Costs (per sqft)</h3>
            <div class="config-item">
              <label>Carpet (Standard):</label>
              <input type="number" step="0.5" id="floor_carpet" value="3.5">
            </div>
            <div class="config-item">
              <label>Vinyl Plank:</label>
              <input type="number" step="0.5" id="floor_vinyl" value="4.0">
            </div>
            <div class="config-item">
              <label>Laminate:</label>
              <input type="number" step="0.5" id="floor_laminate" value="4.5">
            </div>
            <div class="config-item">
              <label>Hardwood (Engineered):</label>
              <input type="number" step="0.5" id="floor_hardwood_eng" value="8.0">
            </div>
            <div class="config-item">
              <label>Hardwood (Solid):</label>
              <input type="number" step="0.5" id="floor_hardwood_solid" value="12.0">
            </div>
            <div class="config-item">
              <label>Tile (Ceramic):</label>
              <input type="number" step="0.5" id="floor_tile_ceramic" value="6.0">
            </div>
            <div class="config-item">
              <label>Tile (Porcelain):</label>
              <input type="number" step="0.5" id="floor_tile_porcelain" value="8.5">
            </div>
          </div>

          <div class="config-card">
            <h3>üî® Installation Labor (per sqft)</h3>
            <div class="config-item">
              <label>Carpet:</label>
              <input type="number" step="0.25" id="floor_labor_carpet" value="1.5">
            </div>
            <div class="config-item">
              <label>Vinyl/Laminate:</label>
              <input type="number" step="0.25" id="floor_labor_vinyl" value="2.0">
            </div>
            <div class="config-item">
              <label>Hardwood:</label>
              <input type="number" step="0.25" id="floor_labor_hardwood" value="4.0">
            </div>
            <div class="config-item">
              <label>Tile:</label>
              <input type="number" step="0.25" id="floor_labor_tile" value="5.0">
            </div>
          </div>

          <div class="config-card">
            <h3>üß∞ Prep & Extras</h3>
            <div class="config-item">
              <label>Subfloor Repair (per sqft):</label>
              <input type="number" step="0.25" id="floor_subfloor" value="3.0">
            </div>
            <div class="config-item">
              <label>Removal (per sqft):</label>
              <input type="number" step="0.25" id="floor_removal" value="1.5">
            </div>
            <div class="config-item">
              <label>Underlayment (per sqft):</label>
              <input type="number" step="0.1" id="floor_underlay" value="0.75">
            </div>
            <div class="config-item">
              <label>Baseboard (per linear ft):</label>
              <input type="number" step="0.5" id="floor_baseboard" value="4.0">
            </div>
          </div>

          <div class="config-card">
            <h3>‚öôÔ∏è Complexity Multipliers</h3>
            <div class="config-item">
              <label>Standard Room:</label>
              <input type="number" step="0.05" id="floor_standard" value="1.0">
            </div>
            <div class="config-item">
              <label>Moderate (stairs/angles):</label>
              <input type="number" step="0.05" id="floor_moderate" value="1.2">
            </div>
            <div class="config-item">
              <label>Complex (patterns):</label>
              <input type="number" step="0.05" id="floor_complex" value="1.5">
            </div>
          </div>
        </div>

        <button class="btn-save" onclick="saveConfig('flooring')">üíæ Save Flooring Config</button>
        <div class="status-message" id="flooring-status"></div>
      </div>

      <div class="sub-content" id="painting">
        <h2 class="section-title">Painting Configuration</h2>
        
        <div class="config-grid">
          <div class="config-card">
            <h3>üé® Interior Rates (per sqft)</h3>
            <div class="config-item">
              <label>Walls (1 coat):</label>
              <input type="number" step="0.1" id="paint_int_walls_1" value="1.5">
            </div>
            <div class="config-item">
              <label>Walls (2 coats):</label>
              <input type="number" step="0.1" id="paint_int_walls_2" value="2.5">
            </div>
            <div class="config-item">
              <label>Ceiling:</label>
              <input type="number" step="0.1" id="paint_int_ceiling" value="2.0">
            </div>
            <div class="config-item">
              <label>Trim (per linear ft):</label>
              <input type="number" step="0.1" id="paint_int_trim" value="1.75">
            </div>
            <div class="config-item">
              <label>Door (per door):</label>
              <input type="number" step="5" id="paint_int_door" value="75">
            </div>
            <div class="config-item">
              <label>Cabinet (per linear ft):</label>
              <input type="number" step="1" id="paint_int_cabinet" value="35">
            </div>
          </div>

          <div class="config-card">
            <h3>üè† Exterior Rates (per sqft)</h3>
            <div class="config-item">
              <label>Siding (1 coat):</label>
              <input type="number" step="0.1" id="paint_ext_siding_1" value="2.0">
            </div>
            <div class="config-item">
              <label>Siding (2 coats):</label>
              <input type="number" step="0.1" id="paint_ext_siding_2" value="3.5">
            </div>
            <div class="config-item">
              <label>Trim (per linear ft):</label>
              <input type="number" step="0.1" id="paint_ext_trim" value="2.5">
            </div>
            <div class="config-item">
              <label>Deck (per sqft):</label>
              <input type="number" step="0.1" id="paint_ext_deck" value="2.25">
            </div>
            <div class="config-item">
              <label>Fence (per linear ft):</label>
              <input type="number" step="0.1" id="paint_ext_fence" value="3.0">
            </div>
          </div>

          <div class="config-card">
            <h3>üîß Prep & Specialty</h3>
            <div class="config-item">
              <label>Prep/Sanding (per sqft):</label>
              <input type="number" step="0.1" id="paint_prep" value="1.0">
            </div>
            <div class="config-item">
              <label>Primer (per sqft):</label>
              <input type="number" step="0.1" id="paint_primer" value="0.75">
            </div>
            <div class="config-item">
              <label>Wallpaper Removal (per sqft):</label>
              <input type="number" step="0.1" id="paint_wallpaper" value="1.5">
            </div>
            <div class="config-item">
              <label>Texture Repair (per sqft):</label>
              <input type="number" step="0.5" id="paint_texture" value="3.0">
            </div>
          </div>

          <div class="config-card">
            <h3>‚öôÔ∏è Complexity Multipliers</h3>
            <div class="config-item">
              <label>Standard:</label>
              <input type="number" step="0.05" id="paint_standard" value="1.0">
            </div>
            <div class="config-item">
              <label>Moderate (high ceilings):</label>
              <input type="number" step="0.05" id="paint_moderate" value="1.25">
            </div>
            <div class="config-item">
              <label>Complex (2+ story ext):</label>
              <input type="number" step="0.05" id="paint_complex" value="1.5">
            </div>
          </div>
        </div>

        <button class="btn-save" onclick="saveConfig('painting')">üíæ Save Painting Config</button>
        <div class="status-message" id="painting-status"></div>
      </div>

      <div class="sub-content" id="drywall">
  <h2 class="section-title">Drywall Configuration</h2>
  
  <div class="config-grid">
    <div class="config-card">
      <h3>üìè Material Costs</h3>
      <div class="config-item">
        <label>Drywall Sheet (4x8):</label>
        <input type="number" step="1" id="drywall_sheet" value="15">
      </div>
      <div class="config-item">
        <label>Joint Compound (per sqft):</label>
        <input type="number" step="0.05" id="drywall_compound" value="0.35">
      </div>
      <div class="config-item">
        <label>Tape (per sqft):</label>
        <input type="number" step="0.05" id="drywall_tape" value="0.15">
      </div>
      <div class="config-item">
        <label>Screws (per sheet):</label>
        <input type="number" step="0.1" id="drywall_screws" value="0.50">
      </div>
    </div>

    <div class="config-card">
      <h3>üë∑ Labor Rates (per sqft)</h3>
      <div class="config-item">
        <label>Hanging Rate:</label>
        <input type="number" step="0.01" id="drywall_hang_rate" value="0.02">
      </div>
      <div class="config-item">
        <label>Taping/Mudding Rate:</label>
        <input type="number" step="0.01" id="drywall_tape_rate" value="0.03">
      </div>
      <div class="config-item">
        <label>Texture Rate:</label>
        <input type="number" step="0.01" id="drywall_texture_rate" value="0.015">
      </div>
      <div class="config-item">
        <label>Hourly Labor Cost:</label>
        <input type="number" step="1" id="drywall_hourly" value="45">
      </div>
    </div>

    <div class="config-card">
      <h3>üîß Complexity Multipliers</h3>
      <div class="config-item">
        <label>Standard Install:</label>
        <input type="number" step="0.05" id="drywall_standard" value="1.0">
      </div>
      <div class="config-item">
        <label>High Ceiling (10ft+):</label>
        <input type="number" step="0.05" id="drywall_high_ceiling" value="1.2">
      </div>
      <div class="config-item">
        <label>Smooth Finish (Level 5):</label>
        <input type="number" step="0.05" id="drywall_smooth" value="1.3">
      </div>
      <div class="config-item">
        <label>Textured Finish:</label>
        <input type="number" step="0.05" id="drywall_textured" value="1.15">
      </div>
    </div>

    <div class="config-card">
      <h3>üõ†Ô∏è Additional Costs</h3>
      <div class="config-item">
        <label>Repair Patch (minor):</label>
        <input type="number" step="10" id="drywall_repair_minor" value="75">
      </div>
      <div class="config-item">
        <label>Repair Patch (moderate):</label>
        <input type="number" step="10" id="drywall_repair_moderate" value="200">
      </div>
      <div class="config-item">
        <label>Repair Patch (extensive):</label>
        <input type="number" step="10" id="drywall_repair_extensive" value="500">
      </div>
    </div>
  </div>

  <button class="btn-save" onclick="saveConfig('drywall')">üíæ Save Drywall Config</button>
  <div class="status-message" id="drywall-status"></div>
</div>


<div class="sub-content" id="siding">
  <h2 class="section-title">Siding Configuration</h2>
  
  <div class="config-grid">
    <div class="config-card">
      <h3>üè† Material Costs (per sqft)</h3>
      <div class="config-item">
        <label>Vinyl Siding:</label>
        <input type="number" step="0.5" id="siding_vinyl" value="4.50">
      </div>
      <div class="config-item">
        <label>Fiber Cement:</label>
        <input type="number" step="0.5" id="siding_fiber_cement" value="8.00">
      </div>
      <div class="config-item">
        <label>Wood Cedar:</label>
        <input type="number" step="0.5" id="siding_wood" value="12.00">
      </div>
      <div class="config-item">
        <label>Metal/Aluminum:</label>
        <input type="number" step="0.5" id="siding_metal" value="6.50">
      </div>
      <div class="config-item">
        <label>Stucco:</label>
        <input type="number" step="0.5" id="siding_stucco" value="9.00">
      </div>
    </div>

    <div class="config-card">
      <h3>üë∑ Labor Rates (per sqft)</h3>
      <div class="config-item">
        <label>Vinyl Installation:</label>
        <input type="number" step="0.5" id="siding_vinyl_labor" value="3.00">
      </div>
      <div class="config-item">
        <label>Fiber Cement Installation:</label>
        <input type="number" step="0.5" id="siding_fiber_labor" value="5.00">
      </div>
      <div class="config-item">
        <label>Wood Installation:</label>
        <input type="number" step="0.5" id="siding_wood_labor" value="6.00">
      </div>
      <div class="config-item">
        <label>Metal Installation:</label>
        <input type="number" step="0.5" id="siding_metal_labor" value="4.00">
      </div>
      <div class="config-item">
        <label>Stucco Installation:</label>
        <input type="number" step="0.5" id="siding_stucco_labor" value="7.00">
      </div>
    </div>

    <div class="config-card">
      <h3>üèóÔ∏è Story Multipliers</h3>
      <div class="config-item">
        <label>1 Story:</label>
        <input type="number" step="0.05" id="siding_1_story" value="1.0">
      </div>
      <div class="config-item">
        <label>2 Story:</label>
        <input type="number" step="0.05" id="siding_2_story" value="1.2">
      </div>
      <div class="config-item">
        <label>3+ Story:</label>
        <input type="number" step="0.05" id="siding_3_story" value="1.5">
      </div>
    </div>

    <div class="config-card">
      <h3>üíµ Additional Costs</h3>
      <div class="config-item">
        <label>Old Siding Removal (per sqft):</label>
        <input type="number" step="0.25" id="siding_removal" value="1.50">
      </div>
      <div class="config-item">
        <label>House Wrap (per sqft):</label>
        <input type="number" step="0.1" id="siding_wrap" value="0.75">
      </div>
      <div class="config-item">
        <label>Trim (per linear ft):</label>
        <input type="number" step="0.5" id="siding_trim" value="4.00">
      </div>
      <div class="config-item">
        <label>Window Trim (per window):</label>
        <input type="number" step="5" id="siding_window_trim" value="50">
      </div>
    </div>
  </div>

  <button class="btn-save" onclick="saveConfig('siding')">üíæ Save Siding Config</button>
  <div class="status-message" id="siding-status"></div>
</div>

      <div class="sub-content" id="regional">
        <h2 class="section-title">Regional Cost Multipliers</h2>
        
        <div class="info-box">
          <p><strong>‚ÑπÔ∏è Regional multipliers apply to ALL trades in that state/market.</strong></p>
          <p>Based on BLS data + local market conditions. Adjust based on your actual costs.</p>
        </div>
        
        <div class="config-grid">
          <div class="config-card">
            <h3>üî¥ High-Cost Markets</h3>
            <div class="config-item">
              <label>California:</label>
              <input type="number" step="0.05" id="region_CA" value="1.35">
            </div>
            <div class="config-item">
              <label>New York:</label>
              <input type="number" step="0.05" id="region_NY" value="1.30">
            </div>
            <div class="config-item">
              <label>Massachusetts:</label>
              <input type="number" step="0.05" id="region_MA" value="1.25">
            </div>
            <div class="config-item">
              <label>Hawaii:</label>
              <input type="number" step="0.05" id="region_HI" value="1.40">
            </div>
          </div>

          <div class="config-card">
            <h3>üü° Medium-Cost Markets</h3>
            <div class="config-item">
              <label>Washington:</label>
              <input type="number" step="0.05" id="region_WA" value="1.15">
            </div>
            <div class="config-item">
              <label>Oregon:</label>
              <input type="number" step="0.05" id="region_OR" value="1.10">
            </div>
            <div class="config-item">
              <label>Colorado:</label>
              <input type="number" step="0.05" id="region_CO" value="1.10">
            </div>
            <div class="config-item">
              <label>Illinois:</label>
              <input type="number" step="0.05" id="region_IL" value="1.08">
            </div>
            <div class="config-item">
              <label>Virginia:</label>
              <input type="number" step="0.05" id="region_VA" value="1.05">
            </div>
          </div>

          <div class="config-card">
            <h3>üü¢ Low-Cost Markets</h3>
            <div class="config-item">
              <label>Texas:</label>
              <input type="number" step="0.05" id="region_TX" value="0.95">
            </div>
            <div class="config-item">
              <label>Florida:</label>
              <input type="number" step="0.05" id="region_FL" value="0.95">
            </div>
            <div class="config-item">
              <label>Georgia:</label>
              <input type="number" step="0.05" id="region_GA" value="0.90">
            </div>
            <div class="config-item">
              <label>Ohio:</label>
              <input type="number" step="0.05" id="region_OH" value="0.92">
            </div>
            <div class="config-item">
              <label>Tennessee:</label>
              <input type="number" step="0.05" id="region_TN" value="0.88">
            </div>
            <div class="config-item">
              <label>Alabama:</label>
              <input type="number" step="0.05" id="region_AL" value="0.85">
            </div>
          </div>

          <div class="config-card">
            <h3>‚öôÔ∏è Default/National</h3>
            <div class="config-item">
              <label>National Average:</label>
              <input type="number" step="0.05" id="region_default" value="1.00">
            </div>
          </div>
        </div>

        <button class="btn-save" onclick="saveConfig('regional')">üíæ Save Regional Config</button>
        <div class="status-message" id="regional-status"></div>
      </div>

    </div>

    <div class="main-content" id="estimate-tracker">
  <h2 class="section-title">üìä Estimate Tracker</h2>
  
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>üìÖ Google Calendar Integration</h3>
    
    <div id="calendarStatusBox">
      <div id="notConnected" style="display: none;">
        <p style="margin-bottom: 15px; color: #666;">
          Connect your Google Calendar to automatically block out busy dates for customer scheduling.
        </p>
        <button class="btn-save" onclick="connectGoogleCalendar()" style="margin-top: 0;">
          üîó Connect Google Calendar
        </button>
      </div>

      <div id="connected" style="display: none;">
        <p style="color: #28a745; margin-bottom: 10px;">
          ‚úÖ <span id="connectedEmail"></span>
        </p>
        <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
          Last synced: <span id="lastSync">Never</span>
        </p>
        <button class="btn-save" onclick="syncCalendar()" style="margin-right: 10px;">
          üîÑ Sync Now
        </button>
        <button class="btn-cancel" onclick="disconnectCalendar()">
          ‚ùå Disconnect
        </button>
      </div>
    </div>
    
    <div class="status-message" id="calendar-status"></div>
  </div>

 
  
  <!-- ESTIMATE LIST AND DETAILS -->
  <div class="config-card" style="max-width: 100%; padding: 0;">
    <div style="display: grid; grid-template-columns: 350px 1fr; min-height: 600px;">
      
      <!-- LEFT SIDEBAR: ESTIMATE QUEUE -->
      <div style="border-right: 1px solid #e0e0e0; padding: 20px; background: #f8f9fa;">
        <h3 style="margin: 0 0 20px 0; font-size: 18px; color: #333;">üìã Estimates Queue</h3>
        
        <div id="estimatesList" style="display: flex; flex-direction: column; gap: 12px;">
          <!-- Estimates will load here -->
          <div style="text-align: center; padding: 40px 20px; color: #999;">
            <p>Loading estimates...</p>
          </div>
        </div>
      </div>
      
      <!-- RIGHT PANEL: ESTIMATE DETAILS -->
      <div id="estimateDetails" style="padding: 30px; background: white;">
        <div style="text-align: center; padding: 80px 40px; color: #999;">
          <p style="font-size: 18px; margin-bottom: 10px;">üëà Select an estimate</p>
          <p style="font-size: 14px;">Click any estimate from the queue to view details</p>
        </div>
      </div>
      
    </div>
  </div>
</div>

<script>
// ESTIMATE TRACKER FUNCTIONALITY
/*const window.RAILWAY_API = 'https://roofbid-backend-production.up.railway.app';*/
let currentEstimate = null;

// ‚úÖ AUTH HELPER - ADDS AUTHORIZATION HEADER TO ALL FETCH CALLS
function authFetch(url, options = {}) {
  const token = localStorage.getItem('session_token');
  
  if (!token) {
    console.error('‚ùå No session token - redirecting to login');
    window.location.href = '/login-html/';
    return Promise.reject('Not authenticated');
  }
  
  // Add Authorization header
  options.headers = {
    ...options.headers,
    'Authorization': `Bearer ${token}`
  };
  
  return fetch(url, options);
}

// Load estimates on page load
async function loadEstimates() {
  const container = document.getElementById('estimatesList');
  
  try {
   const response = await authFetch(`${window.RAILWAY_API}/api/estimates`);

    
    if (!response.ok) {
      throw new Error(`API returned ${response.status}`);
    }
    
    const estimates = await response.json();
    
    if (!estimates || estimates.length === 0) {
      container.innerHTML = `
        <div style="text-align: center; padding: 40px 20px; color: #999;">
          <p>No estimates yet</p>
          <p style="font-size: 12px; margin-top: 10px;">Estimates will appear here when customers submit quote requests</p>
        </div>
      `;
      return;
    }
    
    // Render estimate cards
    container.innerHTML = estimates.map(est => `
      <div class="estimate-card" onclick="viewEstimateDetails('${est.id}')" style="
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.2s;
      " onmouseover="this.style.borderColor='#667eea'" onmouseout="this.style.borderColor='#e0e0e0'">
        
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
          <div>
            <div style="font-weight: 600; font-size: 16px; color: #333; margin-bottom: 4px;">
              ${est.customerName || 'Unknown Customer'}
            </div>
            <div style="font-size: 12px; color: #999;">
              ${est.customerEmail || ''}
            </div>
          </div>
          <span style="
            background: ${getTradeColor(est.trade)};
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
          ">${est.trade || 'General'}</span>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid #f0f0f0;">
          <div style="font-size: 20px; font-weight: 700; color: #667eea;">
            $${parseFloat(est.totalCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
          </div>
          <div style="font-size: 11px; color: #999;">
            ${new Date(est.createdAt).toLocaleDateString()}
          </div>
        </div>
        
      </div>
    `).join('');
    
  } catch (error) {
    console.error('Error loading estimates:', error);
    container.innerHTML = `
      <div style="text-align: center; padding: 40px 20px; color: #dc3545;">
        <p style="font-weight: 600; margin-bottom: 10px;">‚ö†Ô∏è Connection Error</p>
        <p style="font-size: 12px;">Unable to load estimates. Railway backend may be down.</p>
        <button onclick="loadEstimates()" style="
          margin-top: 15px;
          padding: 8px 16px;
          background: #667eea;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 12px;
        ">üîÑ Retry</button>
      </div>
    `;
  }
}

// Get color based on trade type
function getTradeColor(trade) {
  const colors = {
    'roofing': '#dc3545',
    'hvac': '#007bff',
    'electrical': '#ffc107',
    'plumbing': '#17a2b8',
    'flooring': '#6c757d',
    'painting': '#28a745',
    'drywall': '#fd7e14',
    'siding': '#6f42c1'
  };
  return colors[trade?.toLowerCase()] || '#667eea';
}

// Render trade-specific details
function renderTradeDetails(trade, details) {
  if (!details || typeof details !== 'object') return '<p style="color: #999;">No additional details</p>';
  
  // Parse if it's a string
  if (typeof details === 'string') {
    try {
      details = JSON.parse(details);
    } catch (e) {
      return '<p style="color: #999;">Unable to parse details</p>';
    }
  }
  
  const fieldLabels = {
    squareFeet: 'Square Feet', stories: 'Stories', pitch: 'Roof Pitch',
    material: 'Material', layers: 'Existing Layers', chimneys: 'Chimneys',
    valleys: 'Valleys', skylights: 'Skylights', needsPlywood: 'Needs Plywood',
    plywoodSqft: 'Plywood Sq Ft', ridgeVentFeet: 'Ridge Vent (ft)',
    existingRoofType: 'Existing Roof', systemType: 'System Type',
    units: 'Units', registers: 'Registers', accessType: 'Access Type',
    existingDucts: 'Existing Ducts', zoning: 'Zoning', tonnage: 'Tonnage',
    efficiency: 'Efficiency', gasLineNeeded: 'Gas Line Needed',
    electricalUpgrade: 'Electrical Upgrade', serviceType: 'Service Type',
    amperage: 'Amperage', receptacles: 'Receptacles', switches: 'Switches',
    lightFixtures: 'Light Fixtures', ceilingFans: 'Ceiling Fans',
    gfciOutlets: 'GFCI Outlets', bathrooms: 'Bathrooms', kitchens: 'Kitchens',
    laundryRooms: 'Laundry Rooms', heaterType: 'Water Heater Type',
    floorType: 'Floor Type', rooms: 'Rooms', needRemoval: 'Remove Existing',
    stairs: 'Include Stairs', stairSteps: 'Stair Steps', paintType: 'Paint Type',
    coats: 'Coats', includeCeilings: 'Include Ceilings', includeTrim: 'Include Trim',
    doorCount: 'Doors', windowCount: 'Windows', projectType: 'Project Type',
    ceilingHeight: 'Ceiling Height', finishLevel: 'Finish Level',
    textureType: 'Texture Type', sidingType: 'Siding Type',
    needsRemoval: 'Remove Existing', trimLinearFeet: 'Trim (Linear Ft)',
    projectDetails: 'Project Details', additionalNotes: 'Additional Details'

  };
  
  const skipFields = ['name', 'email', 'phone', 'address', 'city', 'state', 'zip', 'photos'];
  let html = '';
  
  for (const [key, value] of Object.entries(details)) {
    if (value === null || value === undefined || value === '' || skipFields.includes(key)) continue;
    if (Array.isArray(value)) continue;
    
    const label = fieldLabels[key] || key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
    let displayValue = value;
    
    if (value === 'yes') displayValue = '‚úì Yes';
    else if (value === 'no') displayValue = '‚úó No';
    else if (typeof value === 'number') displayValue = value.toLocaleString();
    else if (typeof value === 'string' && value.includes('_')) {
      displayValue = value.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
    }
    
    html += `
      <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #e0e0e0;">
        <div style="font-size: 11px; color: #999; margin-bottom: 4px; text-transform: uppercase;">${label}</div>
        <div style="font-size: 15px; font-weight: 600; color: #333;">${displayValue}</div>
      </div>
    `;
  }
  
  return html || '<p style="color: #999;">No additional specifications</p>';
}

 // Google Maps instances
let aerialMap = null;
let streetViewPanorama = null;
let mapMarker = null;

function initializeDashboardMaps(address) {
  const mapContainer = document.getElementById('dashboardMapContainer');
  if (!mapContainer) return;
  
  // Initialize Geocoder
  const geocoder = new google.maps.Geocoder();
  
  geocoder.geocode({ address: address }, function(results, status) {
    if (status === 'OK' && results[0]) {
      const location = results[0].geometry.location;
      
      // Initialize Aerial Map
      aerialMap = new google.maps.Map(document.getElementById('dashboardAerialMap'), {
        center: location,
        zoom: 19,
        mapTypeId: 'satellite',
        mapTypeControl: true,
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
          position: google.maps.ControlPosition.TOP_RIGHT
        },
        fullscreenControl: true,
        streetViewControl: false
      });
      
      // Add marker
      mapMarker = new google.maps.Marker({
        position: location,
        map: aerialMap,
        title: 'Property Location'
      });
      
      // Initialize Street View
      streetViewPanorama = new google.maps.StreetViewPanorama(
        document.getElementById('dashboardStreetView'),
        {
          position: location,
          pov: { heading: 34, pitch: 10 },
          addressControl: true,
          visible: false
        }
      );
      
      // Check Street View availability
      const streetViewService = new google.maps.StreetViewService();
      streetViewService.getPanorama({ location: location, radius: 50 }, function(data, status) {
        if (status === 'OK') {
          streetViewPanorama.setPosition(data.location.latLng);
          streetViewPanorama.setPov({ heading: 34, pitch: 10 });
          streetViewPanorama.setVisible(true);
        } else {
          document.getElementById('dashboardStreetView').innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f0f0f0; color: #666; font-size: 14px;">
              üö´ Street View not available at this location
            </div>
          `;
        }
      });
      
    } else {
      console.error('Geocoding failed:', status);
      mapContainer.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #999;">
          üìç Unable to load map for this address
        </div>
      `;
    }
  });
}

// View estimate details
async function viewEstimateDetails(estimateId) {
  const detailsPanel = document.getElementById('estimateDetails');
  
  try {
    const response = await authFetch(`${window.RAILWAY_API}/api/estimates/${estimateId}`);
    const estimate = await response.json();
    currentEstimate = estimate;
    
    // ‚úÖ DEBUG: CHECK PHOTOS
    console.log('üì∏ Full estimate object:', estimate);
    console.log('üì∏ estimate.photos:', estimate.photos);
    console.log('üì∏ Photos conditional result:', estimate.photos && estimate.photos.length > 0);

    detailsPanel.innerHTML = `
      <div style="max-width: 700px;">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
          <div>
            <h2 style="margin: 0 0 10px 0; color: #333;">${estimate.customerName}</h2>
            <p style="color: #666; margin: 0;">${estimate.customerEmail} ‚Ä¢ ${estimate.customerPhone || 'No phone'}</p>
          </div>
          <span style="
            background: ${getTradeColor(estimate.trade)};
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            text-transform: uppercase;
          ">${estimate.trade}</span>
        </div>
        
        <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
          <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #333;">üìç Project Address</h3>
          <p style="margin: 0; color: #666; line-height: 1.6;">
            ${estimate.address || 'No address provided'}<br>
            ${estimate.city ? estimate.city + ', ' : ''}${estimate.state || ''} ${estimate.zipCode || ''}
          </p>
        </div>
        
         <!-- ‚úÖ PROJECT SPECIFICATIONS -->
        ${estimate.projectDetails ? `
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #333;">üìã Project Specifications</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
              ${renderTradeDetails(estimate.trade, estimate.projectDetails)}
            </div>
          </div>
        ` : ''}


        <!-- ‚úÖ NEW: GOOGLE MAPS SPLIT VIEW -->
        ${estimate.address && estimate.city && estimate.state && estimate.zipCode ? `
          <div id="dashboardMapContainer" style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #333;">üó∫Ô∏è Property Views</h3>
            <div style="height: 500px; display: grid; grid-template-rows: 1fr 1fr; gap: 0; border: 2px solid #ddd; border-radius: 6px; overflow: hidden;">
              <div style="position: relative; height: 100%;">
                <div style="position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.95); padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: 600; z-index: 1; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  üõ∞Ô∏è Aerial View
                </div>
                <div id="dashboardAerialMap" style="width: 100%; height: 100%;"></div>
              </div>
              <div style="position: relative; height: 100%;">
                <div style="position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.95); padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: 600; z-index: 1; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  üöó Street View
                </div>
                <div id="dashboardStreetView" style="width: 100%; height: 100%;"></div>
              </div>
            </div>
          </div>
        ` : ''}
        
        <!-- ‚úÖ NEW: CUSTOMER PHOTOS SECTION -->
        ${estimate.photos && estimate.photos.length > 0 ? `
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #333;">üì∏ Customer Photos (${estimate.photos.length})</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px;">
              ${estimate.photos.map((photo, index) => `
                <div style="position: relative; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer;" onclick="openPhotoModal('${photo}', ${index})">
                  <img src="${photo}" alt="Customer photo ${index + 1}" style="width: 100%; height: 150px; object-fit: cover;">
                  <div style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                    ${index + 1}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        ` : ''}
        
<div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
  <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #333;">üí∞ Estimate Breakdown</h3>
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
    <div>
      <div style="font-size: 12px; color: #999; margin-bottom: 4px;">Materials</div>
      <div style="font-size: 20px; font-weight: 600; color: #333;">
        $${parseFloat(estimate.materialsCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
    <div>
      <div style="font-size: 12px; color: #999; margin-bottom: 4px;">Labor</div>
      <div style="font-size: 20px; font-weight: 600; color: #333;">
        $${parseFloat(estimate.laborCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
  </div>
  <div style="border-top: 1px solid #dee2e6; margin-top: 15px; padding-top: 15px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
      <div style="font-size: 13px; color: #666;">Subtotal</div>
      <div style="font-size: 16px; font-weight: 600; color: #333;">
        $${parseFloat(estimate.totalCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
      <div style="font-size: 13px; color: #666;">Tax (${parseFloat(estimate.taxRate || 8.25).toFixed(2)}%)</div>
      <div style="font-size: 16px; font-weight: 600; color: #333;">
        $${parseFloat(estimate.taxAmount || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
  </div>
  <div style="border-top: 2px solid #dee2e6; margin-top: 10px; padding-top: 15px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div style="font-size: 14px; font-weight: 600; color: #666;">TOTAL (incl. tax)</div>
      <div style="font-size: 28px; font-weight: 700; color: #667eea;">
        $${parseFloat(estimate.totalWithTax || estimate.totalCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
  </div>
</div>
        
        ${['roofing', 'painting', 'hvac', 'electrical', 'plumbing', 'flooring', 'drywall', 'siding'].includes(estimate.trade) ? `
  <button id="generateMaterialListBtn" onclick="generateMaterialList('${estimate.id}')" style="
    width: 100%;
    background: #667eea;
    color: white;
    padding: 16px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  " onmouseover="this.style.background='#5568d3'" onmouseout="this.style.background='#667eea'">
    üìã Generate Material List
  </button>
` : `
  <div style="text-align: center; padding: 20px; background: #fff3cd; border-radius: 8px; color: #856404;">
    üìã Material list generation not yet available for ${estimate.trade} estimates
  </div>
`}
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0; font-size: 12px; color: #999;">
          Created: ${new Date(estimate.createdAt).toLocaleString()}
        </div>
      </div>
    `;
    
    // ‚úÖ AUTO-LOAD MAPS AFTER DOM RENDERS
    if (estimate.address && estimate.city && estimate.state && estimate.zipCode) {
      const fullAddress = `${estimate.address}, ${estimate.city}, ${estimate.state} ${estimate.zipCode}`;
      setTimeout(() => initializeDashboardMaps(fullAddress), 300);
    }
    
  } catch (error) {
    console.error('Error loading estimate details:', error);
    detailsPanel.innerHTML = `
      <div style="text-align: center; padding: 80px 40px; color: #dc3545;">
        <p style="font-size: 18px; margin-bottom: 10px;">‚ö†Ô∏è Error Loading Details</p>
        <p style="font-size: 14px;">Unable to fetch estimate information</p>
      </div>
    `;
  }
}

function openPhotoModal(photoSrc, index) {
  const modal = document.createElement('div');
  modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; align-items: center; justify-content: center; cursor: pointer;';
  
  modal.innerHTML = `
    <div style="position: relative; max-width: 90%; max-height: 90%;">
      <img src="${photoSrc}" style="max-width: 100%; max-height: 90vh; border-radius: 8px;">
      <div style="position: absolute; top: -40px; right: 0; color: white; font-size: 32px; cursor: pointer;">√ó</div>
    </div>
  `;
  
  modal.onclick = () => modal.remove();
  document.body.appendChild(modal);
}

// Initialize on tab switch
document.addEventListener('DOMContentLoaded', function() {
  // Load estimates when Estimate Tracker tab is clicked
  const estimateTrackerBtn = document.querySelector('[onclick="showSection(\'estimate-tracker\')"]');
  if (estimateTrackerBtn) {
    estimateTrackerBtn.addEventListener('click', loadEstimates);
  }
});
</script>

<div class="main-content" id="company-profile">
  <h2 class="section-title">üè¢ Company Profile Settings</h2>

  <!-- SECTION 1: COMPANY INFORMATION -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>üìã Company Information</h3>
    <div style="display: grid; gap: 15px;">
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600;">Company Name <span style="color: red;">*</span></label>
        <input type="text" id="profile_company_name" required style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600;">Phone <span style="color: red;">*</span></label>
        <input type="tel" id="profile_phone" required style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600;">Email <span style="color: red;">*</span></label>
        <input type="email" id="profile_email" required style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600;">Street Address</label>
        <input type="text" id="profile_address" style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div style="display: grid; grid-template-columns: 150px 1fr 1fr 120px; gap: 10px; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600; grid-column: 1;">City, State, ZIP</label>
        <input type="text" id="profile_city" placeholder="City" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
        <input type="text" id="profile_state" placeholder="State" maxlength="2" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px; text-transform: uppercase;">
        <input type="text" id="profile_zip" placeholder="ZIP" maxlength="10" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; padding: 12px 0;">
        <label style="font-weight: 600;">License Number</label>
        <input type="text" id="profile_license" style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
    </div>
  </div>

  <!-- SECTION 2: LOGO UPLOAD -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>üé® Company Logo</h3>
    <div id="logoDropZone" style="
      border: 3px dashed #ddd;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: white;
    " onclick="document.getElementById('logoFileInput').click()">
      <div id="logoPreview" style="display: none; margin-bottom: 20px;">
        <img id="logoImg" style="max-width: 200px; max-height: 100px; border-radius: 8px;">
      </div>
      <div id="logoPlaceholder">
        <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
        <p style="color: #666; font-weight: 600; margin-bottom: 5px;">Click to upload logo</p>
        <p style="color: #999; font-size: 14px;">PNG, JPG, or SVG ‚Ä¢ Max 2MB</p>
      </div>
      <input type="file" id="logoFileInput" accept="image/*" style="display: none;">
    </div>
  </div>

  <!-- SECTION 3: BRAND COLORS -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>üé® Brand Colors</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
      <div style="text-align: center;">
        <label style="display: block; font-weight: 600; margin-bottom: 10px;">Primary Color</label>
        <input type="color" id="profile_primary_color" value="#4CAF50" style="width: 100%; height: 60px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
        <input type="text" id="profile_primary_hex" value="#4CAF50" readonly style="width: 100%; margin-top: 8px; padding: 6px; text-align: center; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
      </div>
      <div style="text-align: center;">
        <label style="display: block; font-weight: 600; margin-bottom: 10px;">Secondary Color</label>
        <input type="color" id="profile_secondary_color" value="#2196F3" style="width: 100%; height: 60px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
        <input type="text" id="profile_secondary_hex" value="#2196F3" readonly style="width: 100%; margin-top: 8px; padding: 6px; text-align: center; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
      </div>
      <div style="text-align: center;">
        <label style="display: block; font-weight: 600; margin-bottom: 10px;">Accent Color</label>
        <input type="color" id="profile_accent_color" value="#FF9800" style="width: 100%; height: 60px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
        <input type="text" id="profile_accent_hex" value="#FF9800" readonly style="width: 100%; margin-top: 8px; padding: 6px; text-align: center; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
      </div>
    </div>
  </div>

  <!-- SECTION 4: BUSINESS SETTINGS -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>‚öôÔ∏è Business Settings</h3>
    <div class="config-item">
      <label style="font-weight: 600;">Tax Rate (%)</label>
      <input type="number" id="profile_tax_rate" step="0.01" min="0" max="100" placeholder="8.5" style="width: 140px; padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; text-align: right;">
    </div>
    <div class="config-item">
      <label style="font-weight: 600;">Default Markup (%)</label>
      <input type="number" id="profile_default_markup" step="0.01" min="0" max="100" placeholder="20" style="width: 140px; padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; text-align: right;">
    </div>
  </div>

  <!-- SECTION 5: SUBSCRIPTION INFO (READ-ONLY) -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px; background: #f0f8ff;">
    <h3>üí≥ Subscription</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
      <div>
        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Plan</div>
        <div id="profile_subscription_level" style="font-size: 20px; font-weight: 700; color: #667eea;">Free</div>
      </div>
      <div>
        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Status</div>
        <div id="profile_subscription_status" style="font-size: 20px; font-weight: 700; color: #28a745;">Active</div>
      </div>
      <div>
        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Renewal</div>
        <div id="profile_renewal_date" style="font-size: 20px; font-weight: 700; color: #333;">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- SECTION 6: API KEY & EMBED -->
<div class="config-card" style="max-width: 800px; margin-bottom: 30px; background: linear-gradient(135deg, #1a1a2e 0%, #0d1117 100%); border: 1px solid #30363d;">
  <h3 style="color: #00d4ff;">üîó Your Estimate Form</h3>
  
  <div style="margin-bottom: 20px;">
    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #e6edf3;">Share this link with customers:</label>
    <div style="display: flex; gap: 10px;">
      <input type="text" id="profile_share_link" readonly style="flex: 1; padding: 12px; background: #0d1117; border: 2px solid #30363d; border-radius: 6px; color: #00d4ff; font-family: monospace; font-size: 13px;">
      <button onclick="copyShareLink()" style="padding: 12px 20px; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">üìã Copy</button>
    </div>
  </div>
  
  <div style="margin-bottom: 20px;">
    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #e6edf3;">Or embed on your website:</label>
    <div style="display: flex; gap: 10px;">
      <textarea id="profile_embed_code" readonly rows="3" style="flex: 1; padding: 12px; background: #0d1117; border: 2px solid #30363d; border-radius: 6px; color: #00ff88; font-family: monospace; font-size: 12px; resize: none;"></textarea>
      <button onclick="copyEmbedCode()" style="padding: 12px 20px; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">üìã Copy</button>
    </div>
  </div>
  
  <div style="border-top: 1px solid #30363d; padding-top: 15px;">
    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #8b949e; font-size: 13px;">Your API Key:</label>
    <div style="display: flex; gap: 10px;">
      <input type="text" id="profile_api_key" readonly style="flex: 1; padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #8b949e; font-family: monospace; font-size: 12px;">
      <button onclick="copyApiKey()" style="padding: 10px 16px; background: #30363d; color: #e6edf3; border: none; border-radius: 6px; cursor: pointer;">üìã</button>
    </div>
  </div>
</div>

  <!-- SAVE BUTTON -->
  <button class="btn-save" onclick="saveCompanyProfile()">üíæ Save Company Profile</button>
  <div class="status-message" id="profile-status"></div>
</div>

<script>
// COMPANY PROFILE FUNCTIONALITY
/*const window.RAILWAY_API = 'https://roofbid-backend-production.up.railway.app';*/

// Color picker sync
['primary', 'secondary', 'accent'].forEach(color => {
  const picker = document.getElementById(`profile_${color}_color`);
  const hex = document.getElementById(`profile_${color}_hex`);
  
  picker.addEventListener('input', (e) => {
    hex.value = e.target.value.toUpperCase();
  });
});

// Logo upload handler
document.getElementById('logoFileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  if (file.size > 2 * 1024 * 1024) {
    alert('File too large! Max 2MB');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(event) {
    document.getElementById('logoImg').src = event.target.result;
    document.getElementById('logoPreview').style.display = 'block';
    document.getElementById('logoPlaceholder').style.display = 'none';
  };
  reader.readAsDataURL(file);
});

// Drag & drop for logo
const dropZone = document.getElementById('logoDropZone');
dropZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropZone.style.borderColor = '#667eea';
  dropZone.style.background = '#f0f4ff';
});

dropZone.addEventListener('dragleave', () => {
  dropZone.style.borderColor = '#ddd';
  dropZone.style.background = 'white';
});

dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.style.borderColor = '#ddd';
  dropZone.style.background = 'white';
  
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) {
    document.getElementById('logoFileInput').files = e.dataTransfer.files;
    document.getElementById('logoFileInput').dispatchEvent(new Event('change'));
  }
});

// Load contractor profile
async function loadCompanyProfile() {
  const contractorId = localStorage.getItem('contractor_id');
  const sessionToken = localStorage.getItem('session_token');
  
  if (!contractorId || !sessionToken) {
    window.location.href = '/login';
    return;
  }
  
  try {
    const response = await fetch(`${window.RAILWAY_API}/api/contractors/${contractorId}`, {
      headers: {
        'Authorization': `Bearer ${sessionToken}`
      }
    });
    
    if (response.status === 401 || response.status === 403) {
      localStorage.clear();
      window.location.href = '/login';
      return;
    }
    
    const contractor = await response.json();
    
    // Populate form fields
    document.getElementById('profile_company_name').value = contractor.company_name || '';
    document.getElementById('profile_phone').value = contractor.phone || '';
    document.getElementById('profile_email').value = contractor.email || '';
    document.getElementById('profile_address').value = contractor.address || '';
    document.getElementById('profile_city').value = contractor.city || '';
    document.getElementById('profile_state').value = contractor.state || '';
    document.getElementById('profile_zip').value = contractor.zip || '';
    document.getElementById('profile_license').value = contractor.license_number || '';
    
    // Colors
    if (contractor.primary_color) {
      document.getElementById('profile_primary_color').value = contractor.primary_color;
      document.getElementById('profile_primary_hex').value = contractor.primary_color;
    }
    if (contractor.secondary_color) {
      document.getElementById('profile_secondary_color').value = contractor.secondary_color;
      document.getElementById('profile_secondary_hex').value = contractor.secondary_color;
    }
    if (contractor.accent_color) {
      document.getElementById('profile_accent_color').value = contractor.accent_color;
      document.getElementById('profile_accent_hex').value = contractor.accent_color;
    }
    
    // Business settings
    document.getElementById('profile_tax_rate').value = contractor.tax_rate || '';
    document.getElementById('profile_default_markup').value = contractor.default_markup || '';
    
    // Logo
    if (contractor.logo_url) {
      document.getElementById('logoImg').src = contractor.logo_url;
      document.getElementById('logoPreview').style.display = 'block';
      document.getElementById('logoPlaceholder').style.display = 'none';
    }
    
    // Subscription info
    document.getElementById('profile_subscription_level').textContent = contractor.subscription_level || 'Free';
    document.getElementById('profile_subscription_status').textContent = contractor.subscription_status || 'Active';
    document.getElementById('profile_renewal_date').textContent = contractor.renewal_date ? new Date(contractor.renewal_date).toLocaleDateString() : '‚Äî';
    
    // API Key & Embed Code
const apiKey = contractor.api_key || '';
const baseUrl = 'https://white-raven-264519.hostingersite.com/estimate/';

document.getElementById('profile_api_key').value = apiKey;
document.getElementById('profile_share_link').value = baseUrl + '?key=' + apiKey;
document.getElementById('profile_embed_code').value = '<iframe src="' + baseUrl + '?key=' + apiKey + '&embed=true" style="width:100%; height:800px; border:none;"></iframe>';
    
  } catch (error) {
    console.error('Error loading profile:', error);
    alert('Failed to load company profile');
  }
}

// Save company profile
async function saveCompanyProfile() {
  const contractorId = localStorage.getItem('contractor_id');
  const sessionToken = localStorage.getItem('session_token');
  
  if (!contractorId || !sessionToken) {
    window.location.href = '/login';
    return;
  }
  
  const statusDiv = document.getElementById('profile-status');
  statusDiv.textContent = '‚è≥ Saving...';
  statusDiv.className = 'status-message';
  statusDiv.style.display = 'block';
  
  // Collect form data
  const profileData = {
    company_name: document.getElementById('profile_company_name').value,
    phone: document.getElementById('profile_phone').value,
    email: document.getElementById('profile_email').value,
    address: document.getElementById('profile_address').value,
    city: document.getElementById('profile_city').value,
    state: document.getElementById('profile_state').value.toUpperCase(),
    zip: document.getElementById('profile_zip').value,
    license_number: document.getElementById('profile_license').value,
    primary_color: document.getElementById('profile_primary_color').value,
    secondary_color: document.getElementById('profile_secondary_color').value,
    accent_color: document.getElementById('profile_accent_color').value,
    tax_rate: parseFloat(document.getElementById('profile_tax_rate').value) || null,
    default_markup: parseFloat(document.getElementById('profile_default_markup').value) || null,
    logo_url: document.getElementById('logoImg').src || null
  };
  
  try {
    const response = await fetch(`${window.RAILWAY_API}/api/contractors/${contractorId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${sessionToken}`
      },
      body: JSON.stringify(profileData)
    });
    
    if (response.status === 401 || response.status === 403) {
      localStorage.clear();
      window.location.href = '/login';
      return;
    }
    
    const result = await response.json();
    
    if (result.success) {
      statusDiv.textContent = '‚úÖ Profile saved successfully!';
      statusDiv.className = 'status-message success';
      setTimeout(() => { statusDiv.style.display = 'none'; }, 3000);
    } else {
      throw new Error(result.error || 'Save failed');
    }
    
  } catch (error) {
    console.error('Error saving profile:', error);
    statusDiv.textContent = '‚ùå Error: ' + error.message;
    statusDiv.className = 'status-message error';
  }
}

// Load profile when Company Profile tab is clicked
document.querySelector('[data-main="company-profile"]').addEventListener('click', loadCompanyProfile);
</script>

    <div class="main-content" id="contracts">
      <div class="placeholder-content">
        <h2>üìÑ Contract Templates</h2>
        <p>Customize contract language, terms, payment schedules</p>
        <p style="margin-top: 20px; color: #667eea; font-weight: 600;">Coming Soon</p>
      </div>
    </div>

  </div>
</div>

<script>
const API_BASE = 'https://roofbid-backend-production.up.railway.app';


function authFetch(url, options = {}) {
  const token = localStorage.getItem('session_token');
  
  if (!token) {
    console.error('‚ùå No session token - redirecting to login');
    window.location.href = '/login/';
    return Promise.reject('Not authenticated');
  }
  
  options.headers = {
    ...options.headers,
    'Authorization': 'Bearer ' + token
  };
  
  return fetch(url, options);
}

document.querySelectorAll('.main-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.main-content').forEach(c => c.classList.remove('active'));
    
    this.classList.add('active');
    document.getElementById(this.dataset.main).classList.add('active');
  });
});

document.querySelectorAll('.sub-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
    
    this.classList.add('active');
    document.getElementById(this.dataset.sub).classList.add('active');
    
    loadConfig(this.dataset.sub);
  });
});

window.addEventListener('load', function() {
  loadConfig('roofing');
  loadConfig('regional');
  checkCalendarStatus();
});

function loadConfig(section) {
  authFetch(`${API_BASE}/api/config/${section}`)
    .then(res => res.json())
    .then(data => {
      if (data.success && data.config) {
        Object.keys(data.config).forEach(key => {
          const input = document.getElementById(key);
          if (input) input.value = data.config[key];
        });
      }
    })
    .catch(err => console.error('Load error:', err));
}

function saveConfig(section) {
  const inputs = document.querySelectorAll(`#${section} input`);
  const config = {};
  
  inputs.forEach(input => {
    const value = parseFloat(input.value);
    if (!isNaN(value)) {
      config[input.id] = value;
    }
  });
  
  const statusDiv = document.getElementById(`${section}-status`);
  statusDiv.textContent = '‚è≥ Saving...';
  statusDiv.className = 'status-message';
  statusDiv.style.display = 'block';
  
  authFetch(`${API_BASE}/api/config/${section}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ config })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      statusDiv.textContent = '‚úÖ Configuration saved successfully!';
      statusDiv.className = 'status-message success';
      setTimeout(() => { statusDiv.style.display = 'none'; }, 3000);
    } else {
      throw new Error(data.error || 'Save failed');
    }
  })
  .catch(err => {
    statusDiv.textContent = '‚ùå Error: ' + err.message;
    statusDiv.className = 'status-message error';
  });
}

function getContractorId() {
  return localStorage.getItem('contractor_id') || '1';
}

async function connectGoogleCalendar() {
  try {
    const contractorId = getContractorId();
    const res = await authFetch(`${API_BASE}/api/google/auth-url?contractor_id=${contractorId}`);
    const data = await res.json();
    
    const popup = window.open(data.auth_url, 'google-auth', 'width=500,height=600');
    
    const timer = setInterval(() => {
      if (popup.closed) {
        clearInterval(timer);
        checkCalendarStatus();
      }
    }, 500);
  } catch (err) {
    alert('Error connecting to Google: ' + err.message);
  }
}

async function syncCalendar() {
  try {
    const contractorId = getContractorId();
    const res = await authFetch(`${API_BASE}/api/google/sync`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ contractor_id: contractorId })
    });
    const data = await res.json();
    alert('Synced! Blocked ' + (data.blocked_dates ? data.blocked_dates.length : 0) + ' dates');
    checkCalendarStatus();
  } catch (err) {
    alert('Sync failed: ' + err.message);
  }
}

async function disconnectCalendar() {
  if (!confirm('Disconnect Google Calendar?')) return;
  
  try {
    const contractorId = getContractorId();
    await authFetch(`${API_BASE}/api/google/disconnect`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ contractor_id: contractorId })
    });
    checkCalendarStatus();
  } catch (err) {
    alert('Disconnect failed: ' + err.message);
  }
}

async function checkCalendarStatus() {
  try {
    const contractorId = getContractorId();
    const res = await authFetch(`${API_BASE}/api/google/status?contractor_id=${contractorId}`);
    const data = await res.json();
    
    if (data.connected) {
      document.getElementById('notConnected').style.display = 'none';
      document.getElementById('connected').style.display = 'block';
      document.getElementById('connectedEmail').textContent = data.email;
      document.getElementById('lastSync').textContent = data.last_sync || 'Never';
    } else {
      document.getElementById('notConnected').style.display = 'block';
      document.getElementById('connected').style.display = 'none';
    }
  } catch (err) {
    document.getElementById('notConnected').style.display = 'block';
    document.getElementById('connected').style.display = 'none';
  }
}

function copyShareLink() {
  const input = document.getElementById('profile_share_link');
  input.select();
  document.execCommand('copy');
  alert('‚úÖ Link copied to clipboard!');
}

function copyEmbedCode() {
  const textarea = document.getElementById('profile_embed_code');
  textarea.select();
  document.execCommand('copy');
  alert('‚úÖ Embed code copied to clipboard!');
}

function copyApiKey() {
  const input = document.getElementById('profile_api_key');
  input.select();
  document.execCommand('copy');
  alert('‚úÖ API Key copied to clipboard!');
}
</script>""


<!-- InstaBid Material Calculator Scripts -->
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/roofingCalculatorEnhanced.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/paintingCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/hvacCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/electricalCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/plumbingCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/flooringCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/drywallCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/sidingCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/materialMatcher.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/materialListGenerator.js?v=2"></script>



<script>
// MAIN TAB SWITCHING
document.querySelectorAll('.main-tab').forEach(button => {
  button.addEventListener('click', function() {
    const targetSection = this.getAttribute('data-main');
    
    // Remove active class from all main tabs
    document.querySelectorAll('.main-tab').forEach(btn => btn.classList.remove('active'));
    
    // Add active class to clicked tab
    this.classList.add('active');
    
    // Hide all main content sections
    document.querySelectorAll('.main-content').forEach(content => content.classList.remove('active'));
    
    // Show target section
    document.getElementById(targetSection).classList.add('active');
    
    // If switching to estimate tracker, load estimates
    if (targetSection === 'estimate-tracker') {
      loadEstimates();
    }
  });
});

// SUB TAB SWITCHING (for Price Adjustments)
document.querySelectorAll('.sub-tab').forEach(button => {
  button.addEventListener('click', function() {
    const targetSection = this.getAttribute('data-sub');
    
    // Remove active class from all sub tabs
    document.querySelectorAll('.sub-tab').forEach(btn => btn.classList.remove('active'));
    
    // Add active class to clicked tab
    this.classList.add('active');
    
    // Hide all sub content sections
    document.querySelectorAll('.sub-content').forEach(content => content.classList.remove('active'));
    
    // Show target section
    document.getElementById(targetSection).classList.add('active');
  });
});
</script>


</body>
</html>