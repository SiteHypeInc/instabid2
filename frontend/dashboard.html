<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InstaBid - Contractor Dashboard</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.container {
  max-width: 1600px;
  margin: 0 auto;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.header {
  background: linear-gradient(135deg, #66eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  border-radius: 12px 12px 0 0;
}

.header h1 {
  font-size: 2em;
  margin-bottom: 5px;
}

.header p {
  opacity: 0.9;
  font-size: 1.1em;
}

.main-tabs {
  display: flex;
  justify-content: center;
  gap: 10px;
  background: #0d1117;
  padding: 20px;
  flex-wrap: wrap;
  border-bottom: 1px solid #30363d;
}

.main-tab {
  padding: 14px 28px;
  cursor: pointer;
  border: 1px solid #30363d;
  background: #161b22;
  font-size: 1em;
  font-weight: 600;
  color: #8b949e;
  border-radius: 8px;
  transition: all 0.3s;
}

.main-tab:hover {
  border-color: #00d4ff;
  color: #e6edf3;
}

.main-tab.active {
  background: linear-gradient(135deg, #00d4ff, #00a8cc);
  color: #000;
  border-color: transparent;
}

.sub-tabs {
  display: flex;
  justify-content: center;
  gap: 8px;
  background: #161b22;
  border-bottom: 1px solid #30363d;
  padding: 15px 20px;
  flex-wrap: wrap;
}

.sub-tab {
  padding: 10px 18px;
  cursor: pointer;
  border: 1px solid #30363d;
  background: #0d1117;
  font-size: 0.9em;
  font-weight: 600;
  color: #8b949e;
  border-radius: 6px;
  transition: all 0.3s;
}

.sub-tab:hover {
  border-color: #00d4ff;
  color: #00d4ff;
}

.sub-tab.active {
  background: #00d4ff;
  color: #000;
  border-color: #00d4ff;
}
.content {
  padding: 30px;
  min-height: 500px;
}

.main-content {
  display: none;
}

.main-content.active {
  display: block;
}

.sub-content {
  display: none;
}

.sub-content.active {
  display: block;
}

.section-title {
  font-size: 1.5em;
  color: #333;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #667eea;
}

.config-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.config-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  border: 2px solid #ddd;
}

.config-card h3 {
  font-size: 1.2em;
  color: #667eea;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.config-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid #ddd;
}

.config-item:last-child {
  border-bottom: none;
}

.config-item label {
  font-weight: 600;
  color: #333;
  flex: 1;
}

.config-item input {
  width: 140px;
  padding: 8px 12px;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 1em;
  text-align: right;
}

.config-item input:focus {
  outline: none;
  border-color: #667eea;
}

.btn-save {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 14px 35px;
  font-size: 1.1em;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 20px;
}

.btn-save:hover {
  opacity: 0.9;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-cancel {
  background: #dc3545;
  color: white;
  border: none;
  padding: 14px 35px;
  font-size: 1.1em;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 20px;
}

.btn-cancel:hover {
  opacity: 0.9;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
}

.status-message {
  padding: 15px;
  border-radius: 6px;
  margin-top: 20px;
  display: none;
}

.status-message.success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.status-message.error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.info-box {
  background: #e7f3ff;
  border-left: 4px solid #2196F3;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 4px;
}

.info-box p {
  color: #0d47a1;
  margin: 5px 0;
}

.placeholder-content {
  text-align: center;
  padding: 60px 20px;
  color: #999;
}

.placeholder-content h2 {
  font-size: 2em;
  margin-bottom: 10px;
}

.material-list-container {
  background: #0d1117 !important;
  border: 1px solid #30363d !important;
  border-radius: 8px;
  transition: border-color 0.2s;
}

.material-list-container:hover {
  border-color: #00d4ff;
}

.material-list-summary {
  background: #161b22 !important;
  border: 1px solid #30363d !important;
  border-radius: 8px;
}
</style>

</head>
<body>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5u7bMfb76Il4K9x6oP-k2wccwB1mbSP0&libraries=places"></script>

  <!-- ‚úÖ GLOBAL CONSTANTS - DECLARED FIRST THING IN BODY -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  window.RAILWAY_API = 'https://roofbid-backend-production.up.railway.app';
  window.INSTABID_API_KEY = 'ib_74064730bb369effbc6bdfe50b5352e72180054351a5f3afb87839af29b029be';
  console.log('‚úÖ window.RAILWAY_API loaded:', window.RAILWAY_API);
</script>

<!-- ‚úÖ SUPABASE INITIALIZATION -->
<script>
  // Wait for Supabase library to load, then initialize
  window.addEventListener('load', function() {
    if (window.supabase && window.supabase.createClient) {
      window.supabaseClient = window.supabase.createClient(
        'https://audvkmgaufxzylebtmpx.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF1ZHZrbWdhdWZ4enlsZWJ0bXB4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU2OTMxMTUsImV4cCI6MjA1MTI2OTExNX0.0KkQs7vLqM_k7cFV-TT-VxJpLKvxZOWfDKF5e2JF6Ag'
      );
      console.log('‚úÖ Supabase initialized');
    } else {
      console.error('‚ùå Supabase library not loaded');
    }
  });
</script>


  <div class="container">
  <div class="header">
    <h1>‚öôÔ∏è InstaBid Contractor Dashboard</h1>
    <p>Manage pricing, regional adjustments, company profile, and contracts</p>
    <button onclick="logout()" style="
      position: absolute;
      top: 20px;
      right: 20px;
      background: #dc3545;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    ">üö™ Logout</button>
  </div>

  <div class="main-tabs">
    <button class="main-tab active" data-main="price-adjustments">üí∞ Price Adjustments</button>
    <button class="main-tab" data-main="estimate-tracker">üìä Estimate Tracker</button>
    <button class="main-tab" data-main="company-profile">üè¢ Company Profile</button>
    <button class="main-tab" data-main="contracts">üìÑ Contract Templates</button>
  </div>

  <div class="content">
    
    <div class="main-content active" id="price-adjustments">
      
  
<!-- TAB NAVIGATION -->
<div class="tab-navigation">
  <button class="tab-btn active" onclick="showTab('roofing')">üè† Roofing</button>
  <button class="tab-btn" onclick="showTab('hvac')">‚ùÑÔ∏è HVAC</button>
  <button class="tab-btn" onclick="showTab('electrical')">‚ö° Electrical</button>
  <button class="tab-btn" onclick="showTab('plumbing')">üîß Plumbing</button>
  <button class="tab-btn" onclick="showTab('flooring')">ü™µ Flooring</button>
  <button class="tab-btn" onclick="showTab('painting')">üé® Painting</button>
  <button class="tab-btn" onclick="showTab('drywall')">üß± Drywall</button>
  <button class="tab-btn" onclick="showTab('siding')">üèóÔ∏è Siding</button>
  <button class="tab-btn" onclick="showTab('regional')">üìç Regional</button>
</div>

<!-- TAB CONTENT CONTAINER -->
<div class="tab-content">

  <!-- ============================================ -->
<!-- ROOFING SECTION - Synced with materialListGenerator.js -->
<!-- ============================================ -->
<div class="config-section tab-pane active" id="roofing-section">
  <h3>üè† Roofing Configuration</h3>
  
  <h4>Pitch Multipliers</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="pitch_3_12">3/12 Pitch</label>
      <input type="number" id="pitch_3_12" step="0.01" placeholder="1.0">
    </div>
    <div class="input-group">
      <label for="pitch_4_12">4/12 Pitch</label>
      <input type="number" id="pitch_4_12" step="0.01" placeholder="1.0">
    </div>
    <div class="input-group">
      <label for="pitch_5_12">5/12 Pitch</label>
      <input type="number" id="pitch_5_12" step="0.01" placeholder="1.05">
    </div>
    <div class="input-group">
      <label for="pitch_6_12">6/12 Pitch</label>
      <input type="number" id="pitch_6_12" step="0.01" placeholder="1.1">
    </div>
    <div class="input-group">
      <label for="pitch_7_12">7/12 Pitch</label>
      <input type="number" id="pitch_7_12" step="0.01" placeholder="1.15">
    </div>
    <div class="input-group">
      <label for="pitch_8_12">8/12 Pitch</label>
      <input type="number" id="pitch_8_12" step="0.01" placeholder="1.2">
    </div>
    <div class="input-group">
      <label for="pitch_9_12">9/12 Pitch</label>
      <input type="number" id="pitch_9_12" step="0.01" placeholder="1.3">
    </div>
    <div class="input-group">
      <label for="pitch_10_12">10/12 Pitch</label>
      <input type="number" id="pitch_10_12" step="0.01" placeholder="1.4">
    </div>
    <div class="input-group">
      <label for="pitch_11_12">11/12 Pitch</label>
      <input type="number" id="pitch_11_12" step="0.01" placeholder="1.5">
    </div>
    <div class="input-group">
      <label for="pitch_12_12">12/12+ Pitch</label>
      <input type="number" id="pitch_12_12" step="0.01" placeholder="1.6">
    </div>
  </div>

  <
<h4>Shingle Costs</h4>
<div class="input-grid">
  <div class="input-group">
    <label for="mat_asphalt">3-Tab Asphalt (per bundle)</label>
    <input type="number" id="mat_asphalt" step="0.01" placeholder="40.00">
  </div>
  <div class="input-group">
    <label for="mat_arch">Architectural (per bundle)</label>
    <input type="number" id="mat_arch" step="0.01" placeholder="44.96">
  </div>
  <div class="input-group">
    <label for="mat_metal">Metal (per sqft)</label>
    <input type="number" id="mat_metal" step="0.01" placeholder="9.50">
  </div>
  <div class="input-group">
    <label for="mat_tile">Tile (per sqft)</label>
    <input type="number" id="mat_tile" step="0.01" placeholder="12.00">
  </div>
  <div class="input-group">
    <label for="mat_wood_shake">Wood Shake (per sqft)</label>
    <input type="number" id="mat_wood_shake" step="0.01" placeholder="14.00">
  </div>
</div>

  <h4>Materials</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="underlayment_roll">Underlayment (per roll)</label>
      <input type="number" id="underlayment_roll" step="0.01" placeholder="45.00">
    </div>
    <div class="input-group">
      <label for="nails_box">Roofing Nails (per box)</label>
      <input type="number" id="nails_box" step="0.01" placeholder="85.00">
    </div>
    <div class="input-group">
      <label for="starter_lf">Starter Shingles (per LF)</label>
      <input type="number" id="starter_lf" step="0.01" placeholder="2.50">
    </div>
    <div class="input-group">
      <label for="ridge_lf">Ridge Cap (per LF)</label>
      <input type="number" id="ridge_lf" step="0.01" placeholder="3.00">
    </div>
    <div class="input-group">
      <label for="drip_edge_lf">Drip Edge (per LF)</label>
      <input type="number" id="drip_edge_lf" step="0.01" placeholder="2.75">
    </div>
    <div class="input-group">
      <label for="ice_shield_lf">Ice & Water Shield (per LF)</label>
      <input type="number" id="ice_shield_lf" step="0.01" placeholder="4.50">
    </div>
    <div class="input-group">
      <label for="vent_unit">Roof Vent (each)</label>
      <input type="number" id="vent_unit" step="0.01" placeholder="25.00">
    </div>
    <div class="input-group">
      <label for="ridge_vent_lf">Ridge Vent (per LF)</label>
      <input type="number" id="ridge_vent_lf" step="0.01" placeholder="5.50">
    </div>
    <div class="input-group">
      <label for="osb_sheet">OSB Sheathing (per sheet)</label>
      <input type="number" id="osb_sheet" step="0.01" placeholder="28.00">
    </div>
  </div>

  <h4>Disposal (per sqft by material type)</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="disposal_asphalt_sqft">Asphalt Disposal (per sqft)</label>
      <input type="number" id="disposal_asphalt_sqft" step="0.01" placeholder="0.40">
    </div>
    <div class="input-group">
      <label for="disposal_wood_sqft">Wood Shake Disposal (per sqft)</label>
      <input type="number" id="disposal_wood_sqft" step="0.01" placeholder="0.40">
    </div>
    <div class="input-group">
      <label for="disposal_metal_sqft">Metal Disposal (per sqft)</label>
      <input type="number" id="disposal_metal_sqft" step="0.01" placeholder="0.50">
    </div>
    <div class="input-group">
      <label for="disposal_tile_sqft">Tile Disposal (per sqft)</label>
      <input type="number" id="disposal_tile_sqft" step="0.01" placeholder="0.75">
    </div>
  </div>

  <h4>Flashing Kits</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="chimney_flash">Chimney Flashing Kit</label>
      <input type="number" id="chimney_flash" step="0.01" placeholder="125.00">
    </div>
    <div class="input-group">
      <label for="skylight_flash">Skylight Flashing Kit</label>
      <input type="number" id="skylight_flash" step="0.01" placeholder="85.00">
    </div>
    <div class="input-group">
      <label for="valley_lf">Valley Flashing (per LF)</label>
      <input type="number" id="valley_lf" step="0.01" placeholder="6.00">
    </div>
  </div>

  <h4>Labor</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="labor_rate_sqft">Base Labor (hrs per sqft)</label>
      <input type="number" id="labor_rate_sqft" step="0.001" placeholder="0.04">
    </div>
    <div class="input-group">
      <label for="chimney_labor_hrs">Chimney Labor (hrs each)</label>
      <input type="number" id="chimney_labor_hrs" step="0.5" placeholder="3">
    </div>
    <div class="input-group">
      <label for="skylight_labor_hrs">Skylight Labor (hrs each)</label>
      <input type="number" id="skylight_labor_hrs" step="0.5" placeholder="2">
    </div>
  </div>

  <div class="section-actions">
    <button class="btn-save" onclick="saveConfig('roofing')">üíæ Save Roofing Config</button>
    <span id="roofing-status" class="status-message"></span>
  </div>
</div>

 <!-- ============================================ -->
<!-- HVAC SECTION -->
<!-- ============================================ -->
<div class="config-section tab-pane" id="hvac-section">
  <h3>‚ùÑÔ∏è HVAC Configuration</h3>
  
  <h4>Furnace</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_furnace_standard">Standard Furnace</label>
      <input type="number" id="hvac_furnace_standard" step="1" placeholder="3500">
    </div>
    <div class="input-group">
      <label for="hvac_furnace_high">High-Efficiency Furnace</label>
      <input type="number" id="hvac_furnace_high" step="1" placeholder="4500">
    </div>
  </div>

  <h4>Air Conditioning</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_ac_standard">Standard AC Unit</label>
      <input type="number" id="hvac_ac_standard" step="1" placeholder="4000">
    </div>
    <div class="input-group">
      <label for="hvac_ac_high">High-Efficiency AC Unit</label>
      <input type="number" id="hvac_ac_high" step="1" placeholder="5500">
    </div>
  </div>

  <h4>Heat Pump</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_heatpump_standard">Standard Heat Pump</label>
      <input type="number" id="hvac_heatpump_standard" step="1" placeholder="5500">
    </div>
    <div class="input-group">
      <label for="hvac_heatpump_high">High-Efficiency Heat Pump</label>
      <input type="number" id="hvac_heatpump_high" step="1" placeholder="7500">
    </div>
  </div>

  <h4>Mini Split</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_minisplit">Mini Split (per zone)</label>
      <input type="number" id="hvac_minisplit" step="1" placeholder="2500">
    </div>
  </div>

  <h4>Ductwork</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_duct_new">New Ductwork (per LF)</label>
      <input type="number" id="hvac_duct_new" step="0.01" placeholder="15">
    </div>
    <div class="input-group">
      <label for="hvac_duct_repair">Ductwork Repair (per LF)</label>
      <input type="number" id="hvac_duct_repair" step="0.01" placeholder="8">
    </div>
  </div>

  <h4>Components</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_thermostat">Smart Thermostat</label>
      <input type="number" id="hvac_thermostat" step="1" placeholder="350">
    </div>
    <div class="input-group">
      <label for="hvac_refrigerant">Refrigerant Charge</label>
      <input type="number" id="hvac_refrigerant" step="1" placeholder="250">
    </div>
    <div class="input-group">
      <label for="hvac_filters">Filters & Supplies</label>
      <input type="number" id="hvac_filters" step="1" placeholder="200">
    </div>
  </div>

  <h4>Labor (base hours by system)</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_labor_rate">Hourly Rate ($)</label>
      <input type="number" id="hvac_labor_rate" step="1" placeholder="85">
    </div>
    <div class="input-group">
      <label for="hvac_labor_furnace">Furnace Install (hrs)</label>
      <input type="number" id="hvac_labor_furnace" step="0.5" placeholder="12">
    </div>
    <div class="input-group">
      <label for="hvac_labor_ac">AC Install (hrs)</label>
      <input type="number" id="hvac_labor_ac" step="0.5" placeholder="10">
    </div>
    <div class="input-group">
      <label for="hvac_labor_heatpump">Heat Pump Install (hrs)</label>
      <input type="number" id="hvac_labor_heatpump" step="0.5" placeholder="14">
    </div>
    <div class="input-group">
      <label for="hvac_labor_minisplit">Mini Split Install (hrs/zone)</label>
      <input type="number" id="hvac_labor_minisplit" step="0.5" placeholder="8">
    </div>
  </div>

  <h4>Size Multipliers (by sqft)</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_size_small">Small (&lt;1500 sqft)</label>
      <input type="number" id="hvac_size_small" step="0.01" placeholder="0.9">
    </div>
    <div class="input-group">
      <label for="hvac_size_med">Medium (1500-2500 sqft)</label>
      <input type="number" id="hvac_size_med" step="0.01" placeholder="1.0">
    </div>
    <div class="input-group">
      <label for="hvac_size_large">Large (2500-4000 sqft)</label>
      <input type="number" id="hvac_size_large" step="0.01" placeholder="1.2">
    </div>
    <div class="input-group">
      <label for="hvac_size_xlarge">X-Large (4000+ sqft)</label>
      <input type="number" id="hvac_size_xlarge" step="0.01" placeholder="1.4">
    </div>
  </div>

  <h4>Story Multipliers</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="hvac_story_2">2 Story</label>
      <input type="number" id="hvac_story_2" step="0.01" placeholder="1.2">
    </div>
    <div class="input-group">
      <label for="hvac_story_3">3 Story</label>
      <input type="number" id="hvac_story_3" step="0.01" placeholder="1.4">
    </div>
  </div>

  <div class="section-actions">
    <button class="btn-save" onclick="saveConfig('hvac')">üíæ Save HVAC Config</button>
    <span id="hvac-status" class="status-message"></span>
  </div>
</div>


  <!-- ELECTRICAL CONFIG SECTION -->
<div class="config-section tab-pane" id="electrical-section">
  <h3>‚ö° Electrical Pricing</h3>
  
  <h4>Wire & Rewire</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="elec_wire_lf">Wire per Linear Foot ($)</label>
      <input type="number" id="elec_wire_lf" step="0.01" placeholder="1.00">
    </div>
    <div class="input-group">
      <label for="elec_rewire_sqft">Full Rewire per Sqft ($)</label>
      <input type="number" id="elec_rewire_sqft" step="0.01" placeholder="11.50">
    </div>
  </div>
  
  <h4>Panel Upgrades</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="elec_panel_100">100A Panel ($)</label>
      <input type="number" id="elec_panel_100" step="0.01" placeholder="450.00">
    </div>
    <div class="input-group">
      <label for="elec_panel_200">200A Panel ($)</label>
      <input type="number" id="elec_panel_200" step="0.01" placeholder="550.00">
    </div>
    <div class="input-group">
      <label for="elec_panel_400">400A Panel ($)</label>
      <input type="number" id="elec_panel_400" step="0.01" placeholder="1200.00">
    </div>
  </div>
  
  <h4>Outlets & Switches</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="elec_outlet">Standard Outlet ($)</label>
      <input type="number" id="elec_outlet" step="0.01" placeholder="12.00">
    </div>
    <div class="input-group">
      <label for="elec_outlet_gfci">GFCI Outlet ($)</label>
      <input type="number" id="elec_outlet_gfci" step="0.01" placeholder="35.00">
    </div>
    <div class="input-group">
      <label for="elec_switch">Standard Switch ($)</label>
      <input type="number" id="elec_switch" step="0.01" placeholder="10.00">
    </div>
    <div class="input-group">
      <label for="elec_switch_dimmer">Dimmer Switch ($)</label>
      <input type="number" id="elec_switch_dimmer" step="0.01" placeholder="50.00">
    </div>
  </div>
  
  <h4>Lighting Installation</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="elec_light_install">Light Fixture Install ($)</label>
      <input type="number" id="elec_light_install" step="0.01" placeholder="35.00">
    </div>
    <div class="input-group">
      <label for="elec_recessed">Recessed Light ($)</label>
      <input type="number" id="elec_recessed" step="0.01" placeholder="55.00">
    </div>
    <div class="input-group">
      <label for="elec_ceiling_fan_install">Ceiling Fan Install ($)</label>
      <input type="number" id="elec_ceiling_fan_install" step="0.01" placeholder="200.00">
    </div>
  </div>
  
  <h4>Dedicated Circuits</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="elec_circuit_20a">20A Circuit ($)</label>
      <input type="number" id="elec_circuit_20a" step="0.01" placeholder="95.00">
    </div>
    <div class="input-group">
      <label for="elec_circuit_30a">30A Circuit ($)</label>
      <input type="number" id="elec_circuit_30a" step="0.01" placeholder="130.00">
    </div>
    <div class="input-group">
      <label for="elec_circuit_50a">50A Circuit ($)</label>
      <input type="number" id="elec_circuit_50a" step="0.01" placeholder="185.00">
    </div>
  </div>
  
  <h4>Specialty</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="elec_ev_charger">EV Charger Install ($)</label>
      <input type="number" id="elec_ev_charger" step="0.01" placeholder="350.00">
    </div>
    <div class="input-group">
      <label for="elec_permit">Permit ($)</label>
      <input type="number" id="elec_permit" step="0.01" placeholder="200.00">
    </div>
  </div>

  <div class="section-actions">
    <button class="btn-save" onclick="saveConfig('electrical')">üíæ Save Electrical Config</button>
    <span id="electrical-status" class="status-message"></span>
  </div>
</div>

  <!-- ========== PLUMBING PRICING ========== -->
<div class="config-section tab-pane" id="plumbing-section">
  <h3>üîß Plumbing Pricing</h3>
  
  <h4>Labor Rates</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Standard Labor (per hour)</label>
      <input type="number" id="plumb_labor_rate" value="95" step="5">
    </div>
    <div class="config-item">
      <label>Emergency Labor (per hour)</label>
      <input type="number" id="plumb_labor_emergency" value="175" step="5">
    </div>
    <div class="config-item">
      <label>Service Call Fee</label>
      <input type="number" id="plumb_service_call" value="95" step="5">
    </div>
  </div>
  
  <h4>Fixture Installation (includes basic materials)</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Toilet Install</label>
      <input type="number" id="plumb_toilet" value="375" step="25">
    </div>
    <div class="config-item">
      <label>Bathroom Sink Install</label>
      <input type="number" id="plumb_sink_bath" value="350" step="25">
    </div>
    <div class="config-item">
      <label>Kitchen Sink Install</label>
      <input type="number" id="plumb_sink_kitchen" value="550" step="25">
    </div>
    <div class="config-item">
      <label>Bathroom Faucet Install</label>
      <input type="number" id="plumb_faucet_bath" value="225" step="25">
    </div>
    <div class="config-item">
      <label>Kitchen Faucet Install</label>
      <input type="number" id="plumb_faucet_kitchen" value="300" step="25">
    </div>
    <div class="config-item">
      <label>Shower Valve Install</label>
      <input type="number" id="plumb_shower_valve" value="450" step="25">
    </div>
    <div class="config-item">
      <label>Tub Install</label>
      <input type="number" id="plumb_tub" value="1200" step="50">
    </div>
    <div class="config-item">
      <label>Dishwasher Hookup</label>
      <input type="number" id="plumb_dishwasher" value="200" step="25">
    </div>
    <div class="config-item">
      <label>Garbage Disposal Install</label>
      <input type="number" id="plumb_garbage_disposal" value="325" step="25">
    </div>
    <div class="config-item">
      <label>Ice Maker Line</label>
      <input type="number" id="plumb_ice_maker" value="150" step="25">
    </div>
  </div>
  
  <h4>Water Heaters (installed)</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Tank 40 gal</label>
      <input type="number" id="plumb_heater_tank_40" value="1200" step="50">
    </div>
    <div class="config-item">
      <label>Tank 50 gal</label>
      <input type="number" id="plumb_heater_tank_50" value="1600" step="50">
    </div>
    <div class="config-item">
      <label>Tankless Gas</label>
      <input type="number" id="plumb_heater_tankless_gas" value="3500" step="100">
    </div>
    <div class="config-item">
      <label>Tankless Electric</label>
      <input type="number" id="plumb_heater_tankless_elec" value="2200" step="100">
    </div>
  </div>
  
  <h4>Water Systems</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Water Softener Install</label>
      <input type="number" id="plumb_water_softener" value="1800" step="100">
    </div>
    <div class="config-item">
      <label>Sump Pump Install</label>
      <input type="number" id="plumb_sump_pump" value="650" step="50">
    </div>
  </div>
  
  <h4>Repipe (per linear foot)</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>PEX Pipe</label>
      <input type="number" id="plumb_repipe_pex_lf" value="2.50" step="0.25">
    </div>
    <div class="config-item">
      <label>Copper Pipe</label>
      <input type="number" id="plumb_repipe_copper_lf" value="4.50" step="0.25">
    </div>
  </div>
  
  <h4>Major Jobs</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Main Line Replacement</label>
      <input type="number" id="plumb_main_line" value="1200" step="100">
    </div>
    <div class="config-item">
      <label>New Gas Line</label>
      <input type="number" id="plumb_gas_line_new" value="500" step="50">
    </div>
  </div>
  
  <h4>Access Type Multipliers</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Basement (easy)</label>
      <input type="number" id="plumb_access_basement" value="1.0" step="0.05">
    </div>
    <div class="config-item">
      <label>Crawlspace</label>
      <input type="number" id="plumb_access_crawlspace" value="1.15" step="0.05">
    </div>
    <div class="config-item">
      <label>Slab (hardest)</label>
      <input type="number" id="plumb_access_slab" value="1.35" step="0.05">
    </div>
  </div>
  
  <h4>Water Heater Location Multipliers</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Garage</label>
      <input type="number" id="plumb_location_garage" value="1.0" step="0.05">
    </div>
    <div class="config-item">
      <label>Basement</label>
      <input type="number" id="plumb_location_basement" value="1.0" step="0.05">
    </div>
    <div class="config-item">
      <label>Closet</label>
      <input type="number" id="plumb_location_closet" value="1.1" step="0.05">
    </div>
    <div class="config-item">
      <label>Attic (hardest)</label>
      <input type="number" id="plumb_location_attic" value="1.25" step="0.05">
    </div>
  </div>
  <div class="section-actions">
    <button class="btn-save" onclick="saveConfig('plumbing')">üíæ Save Plumbing Config</button>
    <span id="plumbing-status" class="status-message"></span>
  </div>
</div>
</div>

 <!-- ============================================ -->
<!-- FLOORING SECTION -->
<!-- ============================================ -->
<div class="config-section tab-pane" id="flooring-section">
  <h3>ü™µ Flooring Configuration</h3>
  
  <h4>Material Costs (per sqft)</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="floor_carpet">Carpet</label>
      <input type="number" id="floor_carpet" step="0.01" placeholder="5.00">
    </div>
    <div class="input-group">
      <label for="floor_vinyl">Vinyl</label>
      <input type="number" id="floor_vinyl" step="0.01" placeholder="3.50">
    </div>
    <div class="input-group">
      <label for="floor_laminate">Laminate</label>
      <input type="number" id="floor_laminate" step="0.01" placeholder="4.00">
    </div>
    <div class="input-group">
      <label for="floor_lvp">Luxury Vinyl Plank</label>
      <input type="number" id="floor_lvp" step="0.01" placeholder="4.50">
    </div>
    <div class="input-group">
      <label for="floor_hardwood_eng">Engineered Hardwood</label>
      <input type="number" id="floor_hardwood_eng" step="0.01" placeholder="10.00">
    </div>
    <div class="input-group">
      <label for="floor_hardwood_solid">Solid Hardwood</label>
      <input type="number" id="floor_hardwood_solid" step="0.01" placeholder="14.00">
    </div>
    <div class="input-group">
      <label for="floor_tile_ceramic">Ceramic Tile</label>
      <input type="number" id="floor_tile_ceramic" step="0.01" placeholder="7.50">
    </div>
    <div class="input-group">
      <label for="floor_tile_porcelain">Porcelain Tile</label>
      <input type="number" id="floor_tile_porcelain" step="0.01" placeholder="10.00">
    </div>
  </div>

  <h4>Installation Labor (per sqft)</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="floor_labor_carpet">Carpet Install</label>
      <input type="number" id="floor_labor_carpet" step="0.01" placeholder="2.00">
    </div>
    <div class="input-group">
      <label for="floor_labor_vinyl">Vinyl Install</label>
      <input type="number" id="floor_labor_vinyl" step="0.01" placeholder="2.50">
    </div>
    <div class="input-group">
      <label for="floor_labor_hardwood">Hardwood Install</label>
      <input type="number" id="floor_labor_hardwood" step="0.01" placeholder="5.00">
    </div>
    <div class="input-group">
      <label for="floor_labor_tile">Tile Install</label>
      <input type="number" id="floor_labor_tile" step="0.01" placeholder="6.50">
    </div>
  </div>

  <h4>Prep & Extras</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="floor_subfloor">Subfloor Repair (per sqft)</label>
      <input type="number" id="floor_subfloor" step="0.01" placeholder="4.00">
    </div>
    <div class="input-group">
      <label for="floor_removal">Old Floor Removal (per sqft)</label>
      <input type="number" id="floor_removal" step="0.01" placeholder="2.00">
    </div>
    <div class="input-group">
      <label for="floor_underlay">Underlayment (per sqft)</label>
      <input type="number" id="floor_underlay" step="0.01" placeholder="0.50">
    </div>
    <div class="input-group">
      <label for="floor_baseboard">Baseboard (per LF)</label>
      <input type="number" id="floor_baseboard" step="0.01" placeholder="5.00">
    </div>
  </div>

  <h4>Complexity Multipliers</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="floor_standard">Standard</label>
      <input type="number" id="floor_standard" step="0.01" placeholder="1.0">
    </div>
    <div class="input-group">
      <label for="floor_moderate">Moderate</label>
      <input type="number" id="floor_moderate" step="0.01" placeholder="1.2">
    </div>
    <div class="input-group">
      <label for="floor_complex">Complex</label>
      <input type="number" id="floor_complex" step="0.01" placeholder="1.4">
    </div>
  </div>

  <div class="section-actions">
    <button class="btn-save" onclick="saveConfig('flooring')">üíæ Save Flooring Config</button>
    <span id="flooring-status" class="status-message"></span>
  </div>
</div>

  <!-- ============================================ -->
  <!-- PAINTING SECTION -->
  <!-- ============================================ -->
  <div class="config-section tab-pane" id="painting-section">
    <h3>üé® Painting Configuration</h3>
    
    <h4>Exterior (per sqft)</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_exterior_mat">Materials</label>
        <input type="number" id="paint_exterior_mat" step="0.01" placeholder="0.45">
      </div>
      <div class="input-group">
        <label for="paint_exterior_labor">Labor</label>
        <input type="number" id="paint_exterior_labor" step="0.01" placeholder="2.50">
      </div>
    </div>

    <h4>Interior (per sqft)</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_interior_mat">Materials</label>
        <input type="number" id="paint_interior_mat" step="0.01" placeholder="0.45">
      </div>
      <div class="input-group">
        <label for="paint_interior_labor">Labor</label>
        <input type="number" id="paint_interior_labor" step="0.01" placeholder="3.50">
      </div>
    </div>

    <h4>Ceilings (per sqft)</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_ceiling_mat">Materials</label>
        <input type="number" id="paint_ceiling_mat" step="0.01" placeholder="0.35">
      </div>
      <div class="input-group">
        <label for="paint_ceiling_labor">Labor</label>
        <input type="number" id="paint_ceiling_labor" step="0.01" placeholder="1.25">
      </div>
    </div>

    <h4>Trim (per linear ft)</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_trim_mat">Materials</label>
        <input type="number" id="paint_trim_mat" step="0.01" placeholder="0.50">
      </div>
      <div class="input-group">
        <label for="paint_trim_labor">Labor</label>
        <input type="number" id="paint_trim_labor" step="0.01" placeholder="2.00">
      </div>
    </div>

    <h4>Doors (each)</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_door_mat">Materials</label>
        <input type="number" id="paint_door_mat" step="1" placeholder="15">
      </div>
      <div class="input-group">
        <label for="paint_door_labor">Labor</label>
        <input type="number" id="paint_door_labor" step="1" placeholder="60">
      </div>
    </div>

    <h4>Windows (each)</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_window_mat">Materials</label>
        <input type="number" id="paint_window_mat" step="1" placeholder="10">
      </div>
      <div class="input-group">
        <label for="paint_window_labor">Labor</label>
        <input type="number" id="paint_window_labor" step="1" placeholder="40">
      </div>
    </div>

    <h4>Power Washing (per sqft)</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_power_wash_mat">Materials</label>
        <input type="number" id="paint_power_wash_mat" step="0.01" placeholder="0.10">
      </div>
      <div class="input-group">
        <label for="paint_power_wash_labor">Labor</label>
        <input type="number" id="paint_power_wash_labor" step="0.01" placeholder="0.15">
      </div>
    </div>

    <h4>Patching - Minor</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_patch_minor_mat">Materials</label>
        <input type="number" id="paint_patch_minor_mat" step="1" placeholder="50">
      </div>
      <div class="input-group">
        <label for="paint_patch_minor_labor">Labor</label>
        <input type="number" id="paint_patch_minor_labor" step="1" placeholder="100">
      </div>
    </div>

    <h4>Patching - Moderate</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_patch_moderate_mat">Materials</label>
        <input type="number" id="paint_patch_moderate_mat" step="1" placeholder="100">
      </div>
      <div class="input-group">
        <label for="paint_patch_moderate_labor">Labor</label>
        <input type="number" id="paint_patch_moderate_labor" step="1" placeholder="250">
      </div>
    </div>

    <h4>Patching - Extensive</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_patch_extensive_mat">Materials</label>
        <input type="number" id="paint_patch_extensive_mat" step="1" placeholder="250">
      </div>
      <div class="input-group">
        <label for="paint_patch_extensive_labor">Labor</label>
        <input type="number" id="paint_patch_extensive_labor" step="1" placeholder="500">
      </div>
    </div>

    <h4>Primer - Color Change (per sqft)</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_primer_mat">Materials</label>
        <input type="number" id="paint_primer_mat" step="0.01" placeholder="0.20">
      </div>
      <div class="input-group">
        <label for="paint_primer_labor">Labor</label>
        <input type="number" id="paint_primer_labor" step="0.01" placeholder="0.30">
      </div>
    </div>

    <h4>Lead Paint Abatement</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="paint_lead_mat">Materials</label>
        <input type="number" id="paint_lead_mat" step="1" placeholder="150">
      </div>
      <div class="input-group">
        <label for="paint_lead_labor">Labor</label>
        <input type="number" id="paint_lead_labor" step="1" placeholder="350">
      </div>
    </div>

    <div class="section-actions">
      <button class="btn-save" onclick="saveConfig('painting')">üíæ Save Painting Config</button>
      <span id="painting-status" class="status-message"></span>
    </div>
  </div>

  <!-- Drywall Pricing Section -->
<div class="config-section tab-pane" id="drywall-section">
  <h3>Drywall Pricing Configuration</h3>
  
  <h4>Labor</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Labor Rate (per hour)</label>
      <input type="number" id="drywall_labor_rate" step="0.01" placeholder="55.00">
    </div>
    <div class="config-item">
      <label>Hang Labor (per sqft)</label>
      <input type="number" id="drywall_hang_sqft" step="0.01" placeholder="0.75">
    </div>
    <div class="config-item">
      <label>Tape/Mud Labor (per sqft)</label>
      <input type="number" id="drywall_tape_sqft" step="0.01" placeholder="0.65">
    </div>
    <div class="config-item">
      <label>Sand/Finish Labor (per sqft)</label>
      <input type="number" id="drywall_sand_sqft" step="0.01" placeholder="0.35">
    </div>
  </div>
  
  <h4>Materials</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Drywall Sheet 1/2" (4x8)</label>
      <input type="number" id="drywall_sheet_half" step="0.01" placeholder="12.00">
    </div>
    <div class="config-item">
      <label>Drywall Sheet 5/8" (4x8)</label>
      <input type="number" id="drywall_sheet_5_8" step="0.01" placeholder="18.00">
    </div>
    <div class="config-item">
      <label>Joint Compound (bucket)</label>
      <input type="number" id="drywall_joint_compound" step="0.01" placeholder="18.00">
    </div>
    <div class="config-item">
      <label>Drywall Tape (roll)</label>
      <input type="number" id="drywall_tape" step="0.01" placeholder="8.00">
    </div>
    <div class="config-item">
      <label>Screws (box)</label>
      <input type="number" id="drywall_screws" step="0.01" placeholder="12.00">
    </div>
    <div class="config-item">
      <label>Corner Bead (8ft)</label>
      <input type="number" id="drywall_corner_bead" step="0.01" placeholder="5.00">
    </div>
  </div>
  
  <h4>Finish Level Multipliers</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Level 3 - Standard</label>
      <input type="number" id="drywall_finish_level_3" step="0.01" placeholder="1.00">
    </div>
    <div class="config-item">
      <label>Level 4 - Smooth</label>
      <input type="number" id="drywall_finish_level_4" step="0.01" placeholder="1.25">
    </div>
    <div class="config-item">
      <label>Level 5 - Glass Smooth</label>
      <input type="number" id="drywall_finish_level_5" step="0.01" placeholder="1.50">
    </div>
  </div>
  
  <h4>Texture (per sqft)</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>No Texture</label>
      <input type="number" id="drywall_texture_none" step="0.01" placeholder="0.00">
    </div>
    <div class="config-item">
      <label>Orange Peel</label>
      <input type="number" id="drywall_texture_orange_peel" step="0.01" placeholder="0.80">
    </div>
    <div class="config-item">
      <label>Knockdown</label>
      <input type="number" id="drywall_texture_knockdown" step="0.01" placeholder="1.00">
    </div>
    <div class="config-item">
      <label>Popcorn</label>
      <input type="number" id="drywall_texture_popcorn" step="0.01" placeholder="0.65">
    </div>
  </div>
  
  <h4>Ceiling Height Multipliers</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>10ft Ceiling</label>
      <input type="number" id="drywall_ceiling_10ft" step="0.01" placeholder="1.15">
    </div>
    <div class="config-item">
      <label>12ft+ Ceiling</label>
      <input type="number" id="drywall_ceiling_12ft" step="0.01" placeholder="1.30">
    </div>
  </div>
  
  <h4>Repair Pricing (flat rate)</h4>
  <div class="config-grid">
    <div class="config-item">
      <label>Minor Repair</label>
      <input type="number" id="drywall_repair_minor" step="0.01" placeholder="175.00">
    </div>
    <div class="config-item">
      <label>Moderate Repair</label>
      <input type="number" id="drywall_repair_moderate" step="0.01" placeholder="400.00">
    </div>
    <div class="config-item">
      <label>Extensive Repair</label>
      <input type="number" id="drywall_repair_extensive" step="0.01" placeholder="900.00">
    </div>
  </div>
  <div class="section-actions">
    <button class="btn-save" onclick="saveConfig('drywall')">üíæ Save Drywall Config</button>
    <span id="drywall-status" class="status-message"></span>
  </div>
</div>
</div>

<!-- ============================================ -->
<!-- SIDING SECTION -->
<!-- ============================================ -->
<div class="config-section tab-pane" id="siding-section">
  <h3>üè† Siding Configuration</h3>
  
  <h4>Material Costs (per sqft)</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="siding_vinyl">Vinyl</label>
      <input type="number" id="siding_vinyl" step="0.01" placeholder="5.50">
    </div>
    <div class="input-group">
      <label for="siding_fiber_cement">Fiber Cement (Hardie)</label>
      <input type="number" id="siding_fiber_cement" step="0.01" placeholder="9.50">
    </div>
    <div class="input-group">
      <label for="siding_wood">Wood</label>
      <input type="number" id="siding_wood" step="0.01" placeholder="14.00">
    </div>
    <div class="input-group">
      <label for="siding_metal">Metal</label>
      <input type="number" id="siding_metal" step="0.01" placeholder="8.00">
    </div>
    <div class="input-group">
      <label for="siding_stucco">Stucco</label>
      <input type="number" id="siding_stucco" step="0.01" placeholder="11.00">
    </div>
  </div>

  <h4>Labor Rates (per sqft by type)</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="siding_labor_vinyl">Vinyl Labor</label>
      <input type="number" id="siding_labor_vinyl" step="0.01" placeholder="3.50">
    </div>
    <div class="input-group">
      <label for="siding_labor_fiber">Fiber Cement Labor</label>
      <input type="number" id="siding_labor_fiber" step="0.01" placeholder="5.50">
    </div>
    <div class="input-group">
      <label for="siding_labor_wood">Wood Labor</label>
      <input type="number" id="siding_labor_wood" step="0.01" placeholder="6.50">
    </div>
    <div class="input-group">
      <label for="siding_labor_metal">Metal Labor</label>
      <input type="number" id="siding_labor_metal" step="0.01" placeholder="4.50">
    </div>
    <div class="input-group">
      <label for="siding_labor_stucco">Stucco Labor</label>
      <input type="number" id="siding_labor_stucco" step="0.01" placeholder="7.50">
    </div>
    <div class="input-group">
      <label for="siding_labor_rate">Hourly Rate ($)</label>
      <input type="number" id="siding_labor_rate" step="1" placeholder="45">
    </div>
  </div>

  <h4>Trim & Accessories</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="siding_housewrap_roll">House Wrap (per roll)</label>
      <input type="number" id="siding_housewrap_roll" step="1" placeholder="175">
    </div>
    <div class="input-group">
      <label for="siding_j_channel">J-Channel (per 12ft piece)</label>
      <input type="number" id="siding_j_channel" step="0.01" placeholder="12.00">
    </div>
    <div class="input-group">
      <label for="siding_corner_post">Corner Post (each)</label>
      <input type="number" id="siding_corner_post" step="1" placeholder="35">
    </div>
    <div class="input-group">
      <label for="siding_window_trim">Window Trim (each)</label>
      <input type="number" id="siding_window_trim" step="0.01" placeholder="55.00">
    </div>
    <div class="input-group">
      <label for="siding_door_trim">Door Trim (each)</label>
      <input type="number" id="siding_door_trim" step="0.01" placeholder="75.00">
    </div>
    <div class="input-group">
      <label for="siding_soffit_sqft">Soffit (per sqft)</label>
      <input type="number" id="siding_soffit_sqft" step="0.01" placeholder="8.00">
    </div>
    <div class="input-group">
      <label for="siding_fascia_lf">Fascia (per linear ft)</label>
      <input type="number" id="siding_fascia_lf" step="0.01" placeholder="6.00">
    </div>
    <div class="input-group">
      <label for="siding_fastener_kit">Fasteners/Caulk Kit</label>
      <input type="number" id="siding_fastener_kit" step="1" placeholder="175">
    </div>
    <div class="input-group">
      <label for="siding_removal_sqft">Removal (per sqft)</label>
      <input type="number" id="siding_removal_sqft" step="0.01" placeholder="1.75">
    </div>
  </div>

  <h4>Story Multipliers</h4>
  <div class="input-grid">
    <div class="input-group">
      <label for="siding_story_2">2 Story</label>
      <input type="number" id="siding_story_2" step="0.01" placeholder="1.25">
    </div>
    <div class="input-group">
      <label for="siding_story_3">3 Story</label>
      <input type="number" id="siding_story_3" step="0.01" placeholder="1.50">
    </div>
  </div>

  <div class="section-actions">
    <button class="btn-save" onclick="saveConfig('siding')">üíæ Save Siding Config</button>
    <span id="siding-status" class="status-message"></span>
  </div>
</div>

  <!-- ============================================ -->
  <!-- REGIONAL SECTION (16 fields) -->
  <!-- ============================================ -->
  <div class="config-section tab-pane" id="regional-section">
    <h3>üìç Regional Multipliers</h3>
    <p style="color: #8b949e; margin-bottom: 15px;">These override the database state multipliers for your specific market.</p>
    
    <h4>High Cost States</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="region_CA">California</label>
        <input type="number" id="region_CA" step="0.01" placeholder="1.35">
      </div>
      <div class="input-group">
        <label for="region_NY">New York</label>
        <input type="number" id="region_NY" step="0.01" placeholder="1.30">
      </div>
      <div class="input-group">
        <label for="region_MA">Massachusetts</label>
        <input type="number" id="region_MA" step="0.01" placeholder="1.25">
      </div>
      <div class="input-group">
        <label for="region_HI">Hawaii</label>
        <input type="number" id="region_HI" step="0.01" placeholder="1.40">
      </div>
      <div class="input-group">
        <label for="region_WA">Washington</label>
        <input type="number" id="region_WA" step="0.01" placeholder="1.20">
      </div>
    </div>

    <h4>Medium-High Cost States</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="region_OR">Oregon</label>
        <input type="number" id="region_OR" step="0.01" placeholder="1.15">
      </div>
      <div class="input-group">
        <label for="region_CO">Colorado</label>
        <input type="number" id="region_CO" step="0.01" placeholder="1.15">
      </div>
      <div class="input-group">
        <label for="region_IL">Illinois</label>
        <input type="number" id="region_IL" step="0.01" placeholder="1.10">
      </div>
      <div class="input-group">
        <label for="region_VA">Virginia</label>
        <input type="number" id="region_VA" step="0.01" placeholder="1.10">
      </div>
    </div>

    <h4>Medium Cost States</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="region_TX">Texas</label>
        <input type="number" id="region_TX" step="0.01" placeholder="1.00">
      </div>
      <div class="input-group">
        <label for="region_FL">Florida</label>
        <input type="number" id="region_FL" step="0.01" placeholder="1.05">
      </div>
      <div class="input-group">
        <label for="region_GA">Georgia</label>
        <input type="number" id="region_GA" step="0.01" placeholder="1.00">
      </div>
      <div class="input-group">
        <label for="region_OH">Ohio</label>
        <input type="number" id="region_OH" step="0.01" placeholder="0.95">
      </div>
    </div>

    <h4>Lower Cost States</h4>
    <div class="input-grid">
      <div class="input-group">
        <label for="region_TN">Tennessee</label>
        <input type="number" id="region_TN" step="0.01" placeholder="0.90">
      </div>
      <div class="input-group">
        <label for="region_AL">Alabama</label>
        <input type="number" id="region_AL" step="0.01" placeholder="0.85">
      </div>
      <div class="input-group">
        <label for="region_default">Default (other states)</label>
        <input type="number" id="region_default" step="0.01" placeholder="1.00">
      </div>
    </div>

    <div class="section-actions">
      <button class="btn-save" onclick="saveConfig('regional')">üíæ Save Regional Config</button>
      <span id="regional-status" class="status-message"></span>
    </div>
  </div>

</div>

<!-- ============================================ -->
<!-- STYLES -->
<!-- ============================================ -->
<style>
.tab-navigation {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-bottom: 25px;
  padding: 20px;
  background: linear-gradient(135deg, #161b22 0%, #1a2029 100%);
  border-radius: 12px;
  border: 1px solid #30363d;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.tab-btn {
  padding: 12px 20px;
  background: #21262d;
  border: 1px solid #30363d;
  border-radius: 8px;
  color: #8b949e;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.25s ease;
  white-space: nowrap;
}

.tab-btn:hover {
  background: #30363d;
  color: #c9d1d9;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.tab-btn.active {
  background: linear-gradient(135deg, #00d4ff, #00a8cc);
  color: #000;
  border-color: #00d4ff;
  font-weight: 600;
  box-shadow: 0 4px 15px rgba(0, 212, 255, 0.35);
}


.tab-pane {
  display: none;
}

.tab-pane.active {
  display: block;
}

.config-section {
  background: #0d1117;
  border: 1px solid #30363d;
  border-radius: 8px;
  padding: 20px;
}

.config-section h3 {
  color: #00d4ff;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid #30363d;
}

.config-section h4 {
  color: #c9d1d9;
  margin: 20px 0 12px 0;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.config-section h4:first-of-type {
  margin-top: 0;
}

.input-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 15px;
}

.input-group {
  display: flex;
  flex-direction: column;
}

.input-group label {
  color: #8b949e;
  font-size: 12px;
  margin-bottom: 5px;
}

.input-group input {
  background: #161b22;
  border: 1px solid #30363d;
  border-radius: 4px;
  padding: 10px;
  color: #c9d1d9;
  font-size: 14px;
}

.input-group input:focus {
  outline: none;
  border-color: #00d4ff;
  box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
}

.input-group input::placeholder {
  color: #484f58;
}

.section-actions {
  margin-top: 25px;
  padding-top: 20px;
  border-top: 1px solid #30363d;
  display: flex;
  align-items: center;
  gap: 15px;
}

.btn-save {
  background: linear-gradient(135deg, #00d4ff, #00a8cc);
  color: #000;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-save:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
}

.status-message {
  color: #8b949e;
  font-size: 14px;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .tab-navigation {
    justify-content: center;
  }
  
  .tab-btn {
    padding: 8px 12px;
    font-size: 12px;
  }
  
  .input-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</div>


    <div class="main-content" id="estimate-tracker">
  <h2 class="section-title">üìä Estimate Tracker</h2>
  
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>üìÖ Google Calendar Integration</h3>
    
    <div id="calendarStatusBox">
      <div id="notConnected" style="display: none;">
        <p style="margin-bottom: 15px; color: #666;">
          Connect your Google Calendar to automatically block out busy dates for customer scheduling.
        </p>
        <button class="btn-save" onclick="connectGoogleCalendar()" style="margin-top: 0;">
          üîó Connect Google Calendar
        </button>
      </div>

      <div id="connected" style="display: none;">
        <p style="color: #28a745; margin-bottom: 10px;">
          ‚úÖ <span id="connectedEmail"></span>
        </p>
        <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
          Last synced: <span id="lastSync">Never</span>
        </p>
        <button class="btn-save" onclick="syncCalendar()" style="margin-right: 10px;">
          üîÑ Sync Now
        </button>
        <button class="btn-cancel" onclick="disconnectCalendar()">
          ‚ùå Disconnect
        </button>
      </div>
    </div>
    
    <div class="status-message" id="calendar-status"></div>
  </div>

 
  
<!-- ESTIMATE LIST AND DETAILS -->
  <div class="config-card" style="max-width: 100%; padding: 0; background: #161b22; border: 1px solid #30363d;">
    <div style="display: grid; grid-template-columns: 350px 1fr; min-height: 600px;">
      
      <!-- LEFT SIDEBAR: ESTIMATE QUEUE -->
      <div style="border-right: 1px solid #30363d; padding: 20px; background: #0d1117;">
        <h3 style="margin: 0 0 20px 0; font-size: 18px; color: #00d4ff;">üìã Estimates Queue</h3>
        
        <div id="estimatesList" style="display: flex; flex-direction: column; gap: 12px;">
          <!-- Estimates will load here -->
          <div style="text-align: center; padding: 40px 20px; color: #8b949e;">
            <p>Loading estimates...</p>
          </div>
        </div>
      </div>
      
      <!-- RIGHT PANEL: ESTIMATE DETAILS -->
      <div id="estimateDetails" style="padding: 30px; background: #161b22;">
        <div style="text-align: center; padding: 80px 40px; color: #8b949e;">
          <p style="font-size: 18px; margin-bottom: 10px;">üëà Select an estimate</p>
          <p style="font-size: 14px;">Click any estimate from the queue to view details</p>
        </div>
      </div>
      
    </div>
  </div>
</div>

<script>

  // Tab switching for pricing sub-tabs
function showTab(tabName) {
  // Hide all tab panes
  document.querySelectorAll('.tab-pane').forEach(pane => {
    pane.classList.remove('active');
    pane.style.display = 'none';
  });
  
  // Remove active from all tab buttons
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Show selected tab
  const selectedPane = document.getElementById(tabName + '-section');
  if (selectedPane) {
    selectedPane.classList.add('active');
    selectedPane.style.display = 'block';
  }
  
  // Activate clicked button
  event.target.classList.add('active');
}

// ESTIMATE TRACKER FUNCTIONALITY
/*const window.RAILWAY_API = 'https://roofbid-backend-production.up.railway.app';*/
let currentEstimate = null;

// ‚úÖ AUTH HELPER - ADDS AUTHORIZATION HEADER TO ALL FETCH CALLS
function authFetch(url, options = {}) {
  const token = localStorage.getItem('session_token');
  
  if (!token) {
    console.error('‚ùå No session token - redirecting to login');
    window.location.href = '/login-html/';
    return Promise.reject('Not authenticated');
  }
  
  // Add Authorization header
  options.headers = {
    ...options.headers,
    'Authorization': `Bearer ${token}`
  };
  
  return fetch(url, options);
}

// Load estimates on page load
async function loadEstimates() {
  const container = document.getElementById('estimatesList');
  
  try {
   const response = await authFetch(`${window.RAILWAY_API}/api/estimates`);

    
    if (!response.ok) {
      throw new Error(`API returned ${response.status}`);
    }
    
    const estimates = await response.json();
    
    if (!estimates || estimates.length === 0) {
      container.innerHTML = `
        <div style="text-align: center; padding: 40px 20px; color: #999;">
          <p>No estimates yet</p>
          <p style="font-size: 12px; margin-top: 10px;">Estimates will appear here when customers submit quote requests</p>
        </div>
      `;
      return;
    }
    
    // Render estimate cards
    container.innerHTML = estimates.map(est => `
  <div class="estimate-card" onclick="viewEstimateDetails('${est.id}')" style="
    background: #161b22;
    border: 2px solid #30363d;
    border-radius: 8px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.2s;
  " onmouseover="this.style.borderColor='#00d4ff'" onmouseout="this.style.borderColor='#30363d'">
    
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
      <div>
        <div style="font-weight: 600; font-size: 16px; color: #e6edf3; margin-bottom: 4px;">
          ${est.customerName || 'Unknown Customer'}
        </div>
        <div style="font-size: 12px; color: #8b949e;">
          ${est.customerEmail || ''}
        </div>
      </div>
      <span style="
        background: ${getTradeColor(est.trade)};
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
      ">${est.trade || 'General'}</span>
    </div>
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid #30363d;">
      <div style="font-size: 20px; font-weight: 700; color: #00d4ff;">
        $${parseFloat(est.totalCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
      <div style="font-size: 11px; color: #8b949e;">
        ${new Date(est.createdAt).toLocaleDateString()}
      </div>
    </div>
    
  </div>
`).join('');

    
  } catch (error) {
    console.error('Error loading estimates:', error);
    container.innerHTML = `
      <div style="text-align: center; padding: 40px 20px; color: #dc3545;">
        <p style="font-weight: 600; margin-bottom: 10px;">‚ö†Ô∏è Connection Error</p>
        <p style="font-size: 12px;">Unable to load estimates. Railway backend may be down.</p>
        <button onclick="loadEstimates()" style="
          margin-top: 15px;
          padding: 8px 16px;
          background: #667eea;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 12px;
        ">üîÑ Retry</button>
      </div>
    `;
  }
}

// Get color based on trade type
function getTradeColor(trade) {
  const colors = {
    'roofing': '#dc3545',
    'hvac': '#007bff',
    'electrical': '#ffc107',
    'plumbing': '#17a2b8',
    'flooring': '#6c757d',
    'painting': '#28a745',
    'drywall': '#fd7e14',
    'siding': '#6f42c1'
  };
  return colors[trade?.toLowerCase()] || '#667eea';
}

// Render trade-specific details
function renderTradeDetails(trade, details) {
  if (!details || typeof details !== 'object') return '<p style="color: #999;">No additional details</p>';
  
  // Parse if it's a string
  if (typeof details === 'string') {
    try {
      details = JSON.parse(details);
    } catch (e) {
      return '<p style="color: #999;">Unable to parse details</p>';
    }
  }
  
  const fieldLabels = {
    squareFeet: 'Square Feet', stories: 'Stories', pitch: 'Roof Pitch',
    material: 'Material', layers: 'Existing Layers', chimneys: 'Chimneys',
    valleys: 'Valleys', skylights: 'Skylights', needsPlywood: 'Needs Plywood',
    plywoodSqft: 'Plywood Sq Ft', ridgeVentFeet: 'Ridge Vent (ft)',
    existingRoofType: 'Existing Roof', systemType: 'System Type',
    units: 'Units', registers: 'Registers', accessType: 'Access Type',
    existingDucts: 'Existing Ducts', zoning: 'Zoning', tonnage: 'Tonnage',
    efficiency: 'Efficiency', gasLineNeeded: 'Gas Line Needed',
    electricalUpgrade: 'Electrical Upgrade', serviceType: 'Service Type',
    amperage: 'Amperage', receptacles: 'Receptacles', switches: 'Switches',
    lightFixtures: 'Light Fixtures', ceilingFans: 'Ceiling Fans',
    gfciOutlets: 'GFCI Outlets', bathrooms: 'Bathrooms', kitchens: 'Kitchens',
    laundryRooms: 'Laundry Rooms', heaterType: 'Water Heater Type',
    floorType: 'Floor Type', rooms: 'Rooms', needRemoval: 'Remove Existing',
    stairs: 'Include Stairs', stairSteps: 'Stair Steps', paintType: 'Paint Type',
    coats: 'Coats', includeCeilings: 'Include Ceilings', includeTrim: 'Include Trim',
    doorCount: 'Doors', windowCount: 'Windows', projectType: 'Project Type',
    ceilingHeight: 'Ceiling Height', finishLevel: 'Finish Level',
    textureType: 'Texture Type', sidingType: 'Siding Type',
    needsRemoval: 'Remove Existing', trimLinearFeet: 'Trim (Linear Ft)',
    projectDetails: 'Project Details', additionalNotes: 'Additional Details'

  };
  
  const skipFields = ['name', 'email', 'phone', 'address', 'city', 'state', 'zip', 'photos'];
  let html = '';
  
  for (const [key, value] of Object.entries(details)) {
    if (value === null || value === undefined || value === '' || skipFields.includes(key)) continue;
    if (Array.isArray(value)) continue;
    
    const label = fieldLabels[key] || key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
    let displayValue = value;
    
    if (value === 'yes') displayValue = '‚úì Yes';
    else if (value === 'no') displayValue = '‚úó No';
    else if (typeof value === 'number') displayValue = value.toLocaleString();
    else if (typeof value === 'string' && value.includes('_')) {
      displayValue = value.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
    }
    
    html += `
      <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #e0e0e0;">
        <div style="font-size: 11px; color: #999; margin-bottom: 4px; text-transform: uppercase;">${label}</div>
        <div style="font-size: 15px; font-weight: 600; color: #333;">${displayValue}</div>
      </div>
    `;
  }
  
  return html || '<p style="color: #999;">No additional specifications</p>';
}

// ‚úÖ NEW: Display material list from database (no recalculation)
async function generateMaterialList(estimateId) {
  const btn = document.getElementById('generateMaterialListBtn');
  btn.innerHTML = '‚è≥ Loading...';
  btn.disabled = true;
  
  try {
    // Fetch the estimate which already has material_list saved
    const response = await authFetch(`${window.RAILWAY_API}/api/estimates/${estimateId}`);
    const estimate = await response.json();
    
    // Check if material list exists
    if (!estimate.material_list || !estimate.material_list.materialList) {
      btn.innerHTML = '‚ùå No material list available';
      setTimeout(() => {
        btn.innerHTML = 'üìã Generate Material List';
        btn.disabled = false;
      }, 2000);
      return;
    }
    
    const materialList = estimate.material_list.materialList;
    const totalCost = estimate.material_list.totalMaterialCost;
    const laborHours = estimate.material_list.laborHours;
    
  
   // Get regional multiplier from estimate (calculated by backend)
const multiplier = estimate.regional_multiplier || estimate.material_list.regionalMultiplier || 1.0;
    
    // Build the material list HTML
    const materialListHTML = `
      <div id="materialListResults" style="background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin-top: 20px;">
        <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00d4ff;">üì¶ Material List</h3>
        <p style="font-size: 12px; color: #8b949e; margin-bottom: 15px;">
          Region: ${estimate.state} State Average (${(multiplier * 100).toFixed(0)}% of national avg)
        </p>
        
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <thead>
            <tr style="border-bottom: 2px solid #30363d;">
              <th style="text-align: left; padding: 10px; color: #8b949e;">Item</th>
              <th style="text-align: right; padding: 10px; color: #8b949e;">Qty</th>
              <th style="text-align: left; padding: 10px; color: #8b949e;">Unit</th>
              <th style="text-align: right; padding: 10px; color: #8b949e;">Unit Cost</th>
              <th style="text-align: right; padding: 10px; color: #8b949e;">Total</th>
              <th style="text-align: left; padding: 10px; color: #8b949e;">Category</th>
            </tr>
          </thead>
          <tbody>
            ${materialList.map(item => `
              <tr style="border-bottom: 1px solid #21262d;">
                <td style="padding: 10px; color: #e6edf3;">${item.item}</td>
                <td style="padding: 10px; color: #e6edf3; text-align: right;">${item.quantity}</td>
                <td style="padding: 10px; color: #8b949e;">${item.unit}</td>
                <td style="padding: 10px; color: #e6edf3; text-align: right;">$${item.unitCost.toFixed(2)}</td>
                <td style="padding: 10px; color: #e6edf3; text-align: right;">$${item.totalCost.toFixed(2)}</td>
                <td style="padding: 10px; color: #8b949e;">${item.category}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        
        <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #30363d; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
          <div>
            <div style="font-size: 12px; color: #8b949e;">Total Items</div>
            <div style="font-size: 20px; font-weight: 600; color: #e6edf3;">${materialList.length}</div>
          </div>
          <div>
            <div style="font-size: 12px; color: #8b949e;">Labor Hours</div>
            <div style="font-size: 20px; font-weight: 600; color: #e6edf3;">${laborHours}</div>
          </div>
          <div>
            <div style="font-size: 12px; color: #8b949e;">Material Cost</div>
            <div style="font-size: 20px; font-weight: 600; color: #00d4ff;">$${totalCost.toFixed(2)}</div>
          </div>
        </div>
      </div>
    `;
    
    // Remove old results if any
    const oldResults = document.getElementById('materialListResults');
    if (oldResults) oldResults.remove();
    
    // Insert after the button
    btn.insertAdjacentHTML('afterend', materialListHTML);
    btn.innerHTML = '‚úÖ Material List Loaded';
    btn.disabled = false;
    
  } catch (error) {
    console.error('Error loading material list:', error);
    btn.innerHTML = '‚ùå Error loading material list';
    setTimeout(() => {
      btn.innerHTML = 'üìã Generate Material List';
      btn.disabled = false;
    }, 2000);
  }
}


 // Google Maps instances
let aerialMap = null;
let streetViewPanorama = null;
let mapMarker = null;

function initializeDashboardMaps(address) {
  const mapContainer = document.getElementById('dashboardMapContainer');
  if (!mapContainer) return;
  
  // Initialize Geocoder
  const geocoder = new google.maps.Geocoder();
  
  geocoder.geocode({ address: address }, function(results, status) {
    if (status === 'OK' && results[0]) {
      const location = results[0].geometry.location;
      
      // Initialize Aerial Map
      aerialMap = new google.maps.Map(document.getElementById('dashboardAerialMap'), {
        center: location,
        zoom: 19,
        mapTypeId: 'satellite',
        mapTypeControl: true,
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
          position: google.maps.ControlPosition.TOP_RIGHT
        },
        fullscreenControl: true,
        streetViewControl: false
      });
      
      // Add marker
      mapMarker = new google.maps.Marker({
        position: location,
        map: aerialMap,
        title: 'Property Location'
      });
      
      // Initialize Street View
      streetViewPanorama = new google.maps.StreetViewPanorama(
        document.getElementById('dashboardStreetView'),
        {
          position: location,
          pov: { heading: 34, pitch: 10 },
          addressControl: true,
          visible: false
        }
      );
      
      // Check Street View availability
      const streetViewService = new google.maps.StreetViewService();
      streetViewService.getPanorama({ location: location, radius: 50 }, function(data, status) {
        if (status === 'OK') {
          streetViewPanorama.setPosition(data.location.latLng);
          streetViewPanorama.setPov({ heading: 34, pitch: 10 });
          streetViewPanorama.setVisible(true);
        } else {
          document.getElementById('dashboardStreetView').innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f0f0f0; color: #666; font-size: 14px;">
              üö´ Street View not available at this location
            </div>
          `;
        }
      });
      
    } else {
      console.error('Geocoding failed:', status);
      mapContainer.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #999;">
          üìç Unable to load map for this address
        </div>
      `;
    }
  });
}

// View estimate details
async function viewEstimateDetails(estimateId) {
  const detailsPanel = document.getElementById('estimateDetails');
  
  try {
    const response = await authFetch(`${window.RAILWAY_API}/api/estimates/${estimateId}`);
    const estimate = await response.json();
    currentEstimate = estimate;
    console.log('üì¶ Estimate from API:', estimate);
    console.log('üì¶ material_list:', estimate.material_list);
    // ‚úÖ DEBUG: CHECK PHOTOS
    console.log('üì∏ Full estimate object:', estimate);
    console.log('üì∏ estimate.photos:', estimate.photos);
    console.log('üì∏ Photos conditional result:', estimate.photos && estimate.photos.length > 0);

    detailsPanel.innerHTML = `
      <div style="max-width: 700px;">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
          <div>
            <h2 style="margin: 0 0 10px 0; color: #e6edf3;">${estimate.customerName}</h2>
            <p style="color: #8b949e; margin: 0;">${estimate.customerEmail} ‚Ä¢ ${estimate.customerPhone || 'No phone'}</p>
          </div>
          <span style="
            background: ${getTradeColor(estimate.trade)};
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            text-transform: uppercase;
          ">${estimate.trade}</span>
        </div>
        
        <div style="background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
          <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00d4ff;">üìç Project Address</h3>
          <p style="margin: 0; color: #8b949e; line-height: 1.6;">
            ${estimate.address || 'No address provided'}<br>
            ${estimate.city ? estimate.city + ', ' : ''}${estimate.state || ''} ${estimate.zipCode || ''}
          </p>
        </div>
        
         <!-- ‚úÖ PROJECT SPECIFICATIONS -->
        ${estimate.projectDetails ? `
          <div style="background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00d4ff;">üìã Project Specifications</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
              ${renderTradeDetails(estimate.trade, estimate.projectDetails)}
            </div>
          </div>
        ` : ''}


        <!-- ‚úÖ NEW: GOOGLE MAPS SPLIT VIEW -->
        ${estimate.address && estimate.city && estimate.state && estimate.zipCode ? `
          <div id="dashboardMapContainer" style="background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00d4ff;">üó∫Ô∏è Property Views</h3>
            <div style="height: 500px; display: grid; grid-template-rows: 1fr 1fr; gap: 0; border: 2px solid #30363d; border-radius: 6px; overflow: hidden;">
              <div style="position: relative; height: 100%;">
                <div style="position: absolute; top: 10px; left: 10px; background: rgba(13,17,23,0.95); color: #e6edf3; padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: 600; z-index: 1; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 1px solid #30363d;">
                  üõ∞Ô∏è Aerial View
                </div>
                <div id="dashboardAerialMap" style="width: 100%; height: 100%;"></div>
              </div>
              <div style="position: relative; height: 100%;">
                <div style="position: absolute; top: 10px; left: 10px; background: rgba(13,17,23,0.95); color: #e6edf3; padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: 600; z-index: 1; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 1px solid #30363d;">
                  üöó Street View
                </div>
                <div id="dashboardStreetView" style="width: 100%; height: 100%;"></div>
              </div>
            </div>
          </div>
        ` : ''}
        
        <!-- ‚úÖ NEW: CUSTOMER PHOTOS SECTION -->
        ${estimate.photos && estimate.photos.length > 0 ? `
          <div style="background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00d4ff;">üì∏ Customer Photos (${estimate.photos.length})</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px;">
              ${estimate.photos.map((photo, index) => `
                <div style="position: relative; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.3); cursor: pointer; border: 1px solid #30363d;" onclick="openPhotoModal('${photo}', ${index})">
                  <img src="${photo}" alt="Customer photo ${index + 1}" style="width: 100%; height: 150px; object-fit: cover;">
                  <div style="position: absolute; top: 8px; right: 8px; background: rgba(0,212,255,0.9); color: #000; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                    ${index + 1}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        ` : ''}
        
<div style="background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
  <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00d4ff;">üí∞ Estimate Breakdown</h3>
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
    <div>
      <div style="font-size: 12px; color: #8b949e; margin-bottom: 4px;">Materials</div>
      <div style="font-size: 20px; font-weight: 600; color: #e6edf3;">
        $${parseFloat(estimate.materialsCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
    <div>
      <div style="font-size: 12px; color: #8b949e; margin-bottom: 4px;">Labor</div>
      <div style="font-size: 20px; font-weight: 600; color: #e6edf3;">
        $${parseFloat(estimate.laborCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
  </div>
  <div style="border-top: 1px solid #30363d; margin-top: 15px; padding-top: 15px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
      <div style="font-size: 13px; color: #8b949e;">Subtotal</div>
      <div style="font-size: 16px; font-weight: 600; color: #e6edf3;">
        $${parseFloat(estimate.totalCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
      <div style="font-size: 13px; color: #8b949e;">Tax (${parseFloat(estimate.taxRate || 8.25).toFixed(2)}%)</div>
      <div style="font-size: 16px; font-weight: 600; color: #e6edf3;">
        $${parseFloat(estimate.taxAmount || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
  </div>
  <div style="border-top: 2px solid #00d4ff; margin-top: 10px; padding-top: 15px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div style="font-size: 14px; font-weight: 600; color: #8b949e;">TOTAL (incl. tax)</div>
      <div style="font-size: 28px; font-weight: 700; color: #00d4ff;">
        $${parseFloat(estimate.totalWithTax || estimate.totalCost || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}
      </div>
    </div>
  </div>
</div>
        
        ${['roofing', 'painting', 'hvac', 'electrical', 'plumbing', 'flooring', 'drywall', 'siding'].includes(estimate.trade) ? `
  <button id="generateMaterialListBtn" onclick="generateMaterialList('${estimate.id}')" style="
    width: 100%;
    background: linear-gradient(135deg, #00d4ff, #00a8cc);
    color: #000;
    padding: 16px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(0,212,255,0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
    üìã Generate Material List
  </button>
` : `
  <div style="text-align: center; padding: 20px; background: rgba(255,193,7,0.1); border: 1px solid rgba(255,193,7,0.3); border-radius: 8px; color: #ffc107;">
    üìã Material list generation not yet available for ${estimate.trade} estimates
  </div>
`}
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #30363d; font-size: 12px; color: #8b949e;">
          Created: ${new Date(estimate.createdAt).toLocaleString()}
        </div>
      </div>
    `;
    
    // ‚úÖ AUTO-LOAD MAPS AFTER DOM RENDERS
    if (estimate.address && estimate.city && estimate.state && estimate.zipCode) {
      const fullAddress = `${estimate.address}, ${estimate.city}, ${estimate.state} ${estimate.zipCode}`;
      setTimeout(() => initializeDashboardMaps(fullAddress), 300);
    }
    
  } catch (error) {
    console.error('Error loading estimate details:', error);
    detailsPanel.innerHTML = `
      <div style="text-align: center; padding: 80px 40px; color: #f85149;">
        <p style="font-size: 18px; margin-bottom: 10px;">‚ö†Ô∏è Error Loading Details</p>
        <p style="font-size: 14px; color: #8b949e;">Unable to fetch estimate information</p>
      </div>
    `;
  }
}

function openPhotoModal(photoSrc, index) {
  const modal = document.createElement('div');
  modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; align-items: center; justify-content: center; cursor: pointer;';
  
  modal.innerHTML = `
    <div style="position: relative; max-width: 90%; max-height: 90%;">
      <img src="${photoSrc}" style="max-width: 100%; max-height: 90vh; border-radius: 8px;">
      <div style="position: absolute; top: -40px; right: 0; color: white; font-size: 32px; cursor: pointer;">√ó</div>
    </div>
  `;
  
  modal.onclick = () => modal.remove();
  document.body.appendChild(modal);
}

// Initialize on tab switch
document.addEventListener('DOMContentLoaded', function() {
  // Load estimates when Estimate Tracker tab is clicked
  const estimateTrackerBtn = document.querySelector('[onclick="showSection(\'estimate-tracker\')"]');
  if (estimateTrackerBtn) {
    estimateTrackerBtn.addEventListener('click', loadEstimates);
  }
});
</script>

<div class="main-content" id="company-profile">
  <h2 class="section-title">üè¢ Company Profile Settings</h2>

  <!-- SECTION 1: COMPANY INFORMATION -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>üìã Company Information</h3>
    <div style="display: grid; gap: 15px;">
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600;">Company Name <span style="color: red;">*</span></label>
        <input type="text" id="profile_company_name" required style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600;">Phone <span style="color: red;">*</span></label>
        <input type="tel" id="profile_phone" required style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600;">Email <span style="color: red;">*</span></label>
        <input type="email" id="profile_email" required style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600;">Street Address</label>
        <input type="text" id="profile_address" style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div style="display: grid; grid-template-columns: 150px 1fr 1fr 120px; gap: 10px; border-bottom: 1px solid #ddd; padding: 12px 0;">
        <label style="font-weight: 600; grid-column: 1;">City, State, ZIP</label>
        <input type="text" id="profile_city" placeholder="City" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
        <input type="text" id="profile_state" placeholder="State" maxlength="2" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px; text-transform: uppercase;">
        <input type="text" id="profile_zip" placeholder="ZIP" maxlength="10" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
      <div class="config-item" style="display: grid; grid-template-columns: 150px 1fr; padding: 12px 0;">
        <label style="font-weight: 600;">License Number</label>
        <input type="text" id="profile_license" style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
      </div>
    </div>
  </div>

  <!-- SECTION 2: LOGO UPLOAD -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>üé® Company Logo</h3>
    <div id="logoDropZone" style="
      border: 3px dashed #ddd;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: white;
    " onclick="document.getElementById('logoFileInput').click()">
      <div id="logoPreview" style="display: none; margin-bottom: 20px;">
        <img id="logoImg" style="max-width: 200px; max-height: 100px; border-radius: 8px;">
      </div>
      <div id="logoPlaceholder">
        <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
        <p style="color: #666; font-weight: 600; margin-bottom: 5px;">Click to upload logo</p>
        <p style="color: #999; font-size: 14px;">PNG, JPG, or SVG ‚Ä¢ Max 2MB</p>
      </div>
      <input type="file" id="logoFileInput" accept="image/*" style="display: none;">
    </div>
  </div>

  <!-- SECTION 3: BRAND COLORS -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
    <h3>üé® Brand Colors</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
      <div style="text-align: center;">
        <label style="display: block; font-weight: 600; margin-bottom: 10px;">Primary Color</label>
        <input type="color" id="profile_primary_color" value="#4CAF50" style="width: 100%; height: 60px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
        <input type="text" id="profile_primary_hex" value="#4CAF50" readonly style="width: 100%; margin-top: 8px; padding: 6px; text-align: center; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
      </div>
      <div style="text-align: center;">
        <label style="display: block; font-weight: 600; margin-bottom: 10px;">Secondary Color</label>
        <input type="color" id="profile_secondary_color" value="#2196F3" style="width: 100%; height: 60px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
        <input type="text" id="profile_secondary_hex" value="#2196F3" readonly style="width: 100%; margin-top: 8px; padding: 6px; text-align: center; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
      </div>
      <div style="text-align: center;">
        <label style="display: block; font-weight: 600; margin-bottom: 10px;">Accent Color</label>
        <input type="color" id="profile_accent_color" value="#FF9800" style="width: 100%; height: 60px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
        <input type="text" id="profile_accent_hex" value="#FF9800" readonly style="width: 100%; margin-top: 8px; padding: 6px; text-align: center; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
      </div>
    </div>
  </div>

<!-- SECTION 4: BUSINESS SETTINGS -->
<div class="config-card" style="max-width: 800px; margin-bottom: 30px;">
  <h3>‚öôÔ∏è Business Settings</h3>
  <div class="config-item" style="display: grid; grid-template-columns: 200px 1fr; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee;">
    <label style="font-weight: 600;">Tax Rate (%)</label>
    <input type="number" id="profile_tax_rate" step="0.01" min="0" max="100" placeholder="8.5" style="width: 140px; padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; text-align: right;">
  </div>
  <div class="config-item" style="display: grid; grid-template-columns: 200px 1fr; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee;">
    <label style="font-weight: 600;">Default Markup (%)</label>
    <input type="number" id="profile_default_markup" step="0.01" min="0" max="100" placeholder="20" style="width: 140px; padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; text-align: right;">
  </div>
  <div class="config-item" style="display: grid; grid-template-columns: 200px 1fr; align-items: center; padding: 12px 0;">
    <label style="font-weight: 600;">Labor Rate Override ($/hr)</label>
    <input type="number" id="profile_labor_rate_override" step="0.50" min="0" placeholder="Leave blank to use regional rates" style="width: 200px; padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; text-align: right;">
    <small style="grid-column: 2; color: #666; margin-top: 4px;">Leave blank to use BLS regional rates √ó 1.5</small>
  </div>
</div>

<!-- SECTION 4B: ESTIMATE DISPLAY SETTINGS -->
<div class="config-card" style="max-width: 800px; margin-bottom: 30px; background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%); border: 2px solid #e9ecef;">
  <h3>üìã Customer Estimate Display</h3>
  <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Choose what customers see on their estimates and PDFs. Most contractors prefer showing only the total.</p>
  
  <div style="display: grid; gap: 15px;">
    <label style="display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">
      <input type="checkbox" id="display_show_labor" style="width: 20px; height: 20px; cursor: pointer;">
      <div>
        <strong>Show Labor Breakdown</strong>
        <div style="font-size: 13px; color: #666;">Display hours √ó rate = labor cost</div>
      </div>
    </label>
    
    <label style="display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">
      <input type="checkbox" id="display_show_materials" style="width: 20px; height: 20px; cursor: pointer;">
      <div>
        <strong>Show Materials Breakdown</strong>
        <div style="font-size: 13px; color: #666;">Display material costs separately</div>
      </div>
    </label>
    
    <label style="display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">
      <input type="checkbox" id="display_show_equipment" style="width: 20px; height: 20px; cursor: pointer;">
      <div>
        <strong>Show Equipment Breakdown</strong>
        <div style="font-size: 13px; color: #666;">Display equipment/rental costs</div>
      </div>
    </label>
    
    <label style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #e8f5e9; border: 2px solid #4caf50; border-radius: 8px; cursor: not-allowed; opacity: 0.8;">
      <input type="checkbox" id="display_show_total" checked disabled style="width: 20px; height: 20px;">
      <div>
        <strong>Show Total</strong>
        <div style="font-size: 13px; color: #666;">Always shown (required)</div>
      </div>
    </label>
  </div>
  
  <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffc107;">
    <strong>üí° Pro Tip:</strong> <span style="color: #666;">Showing only the total avoids the "my brother-in-law can get materials cheaper" conversation.</span>
  </div>
</div>

<!-- SECTION 4C: INTEGRATIONS -->
<div class="config-card" style="max-width: 800px; margin-bottom: 30px; background: linear-gradient(135deg, #1a1a2e 0%, #0d1117 100%); border: 1px solid #30363d;">
  <h3 style="color: #00d4ff;">üîå Integrations</h3>
  
  <!-- STRIPE -->
  <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #30363d;">
    <h4 style="color: #e6edf3; margin-bottom: 10px;">üí≥ Stripe (Collect Payments)</h4>
    <p style="color: #8b949e; font-size: 13px; margin-bottom: 15px;">
      Accept deposits and payments from customers. 
      <a href="[https://dashboard.stripe.com/apikeys"](https://dashboard.stripe.com/apikeys") target="_blank" style="color: #60a5fa;">üîó Get your keys from Stripe</a>
    </p>
    <div style="display: grid; gap: 12px;">
      <div style="display: grid; grid-template-columns: 140px 1fr; align-items: center; gap: 10px;">
        <label style="color: #8b949e; font-size: 13px;">Publishable Key</label>
        <input type="text" id="profile_stripe_pk" placeholder="pk_live_..." style="padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-family: monospace; font-size: 13px;">
      </div>
      <div style="display: grid; grid-template-columns: 140px 1fr; align-items: center; gap: 10px;">
        <label style="color: #8b949e; font-size: 13px;">Secret Key</label>
        <input type="password" id="profile_stripe_sk" placeholder="sk_live_..." style="padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-family: monospace; font-size: 13px;">
      </div>
    </div>
  </div>
  
  <!-- GOOGLE MAPS -->
  <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #30363d;">
    <h4 style="color: #e6edf3; margin-bottom: 10px;">üìç Google Maps API</h4>
    <p style="color: #8b949e; font-size: 13px; margin-bottom: 15px;">
      Show property locations on estimates. 
      <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color: #60a5fa;">üîó Get your API key from Google Cloud</a>
    </p>
    <div style="display: grid; grid-template-columns: 140px 1fr; align-items: center; gap: 10px;">
      <label style="color: #8b949e; font-size: 13px;">API Key</label>
      <input type="text" id="profile_google_maps_key" placeholder="AIza..." style="padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-family: monospace; font-size: 13px;">
    </div>
  </div>
  
  <!-- EMAIL/SMTP -->
  <div>
    <h4 style="color: #e6edf3; margin-bottom: 10px;">üìß Email Settings (SMTP)</h4>
    <p style="color: #8b949e; font-size: 13px; margin-bottom: 15px;">
      Send estimates and confirmations from YOUR email address.
      <a href="#" onclick="showEmailHelp(); return false;" style="color: #60a5fa;">üîó Setup guide</a>
    </p>
    <div style="display: grid; gap: 12px;">
      <div style="display: grid; grid-template-columns: 140px 1fr 80px; align-items: center; gap: 10px;">
        <label style="color: #8b949e; font-size: 13px;">SMTP Host</label>
        <input type="text" id="profile_smtp_host" placeholder="smtp.gmail.com" style="padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px;">
        <input type="text" id="profile_smtp_port" placeholder="587" style="padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; text-align: center;">
      </div>
      <div style="display: grid; grid-template-columns: 140px 1fr; align-items: center; gap: 10px;">
        <label style="color: #8b949e; font-size: 13px;">Username</label>
        <input type="text" id="profile_smtp_user" placeholder="you@yourdomain.com" style="padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px;">
      </div>
      <div style="display: grid; grid-template-columns: 140px 1fr; align-items: center; gap: 10px;">
        <label style="color: #8b949e; font-size: 13px;">Password</label>
        <input type="password" id="profile_smtp_pass" placeholder="App password" style="padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px;">
      </div>
      <div style="margin-top: 10px;">
        <button onclick="sendTestEmail()" style="padding: 10px 20px; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">üì§ Send Test Email</button>
        <span id="email-test-status" style="margin-left: 15px; color: #8b949e;"></span>
      </div>
    </div>
  </div>
</div>

  <!-- SECTION 5: SUBSCRIPTION INFO (READ-ONLY) -->
  <div class="config-card" style="max-width: 800px; margin-bottom: 30px; background: #f0f8ff;">
    <h3>üí≥ Subscription</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
      <div>
        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Plan</div>
        <div id="profile_subscription_level" style="font-size: 20px; font-weight: 700; color: #667eea;">Free</div>
      </div>
      <div>
        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Status</div>
        <div id="profile_subscription_status" style="font-size: 20px; font-weight: 700; color: #28a745;">Active</div>
      </div>
      <div>
        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Renewal</div>
        <div id="profile_renewal_date" style="font-size: 20px; font-weight: 700; color: #333;">‚Äî</div>
      </div>
    </div>
  </div>
<!-- SECTION 6: API KEY & EMBED - UPGRADED VERSION -->
<div class="config-card" style="max-width: 800px; margin-bottom: 30px; background: linear-gradient(135deg, #1a1a2e 0%, #0d1117 100%); border: 1px solid #30363d;">
  <h3 style="color: #00d4ff;">üîó Your Estimate Form</h3>
  
  <!-- SHARE LINK -->
  <div style="margin-bottom: 25px;">
    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #e6edf3;">Share this link with customers:</label>
    <div style="display: flex; gap: 10px;">
      <input type="text" id="profile_share_link" readonly style="flex: 1; padding: 12px; background: #0d1117; border: 2px solid #30363d; border-radius: 6px; color: #00d4ff; font-family: monospace; font-size: 13px;">
      <button onclick="copyShareLink()" style="padding: 12px 20px; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">üìã Copy</button>
    </div>
  </div>
  
  <!-- EMBED OPTIONS TABS -->
  <div style="margin-bottom: 20px;">
    <label style="display: block; font-weight: 600; margin-bottom: 12px; color: #e6edf3;">Or embed on your website:</label>
    
    <!-- Tab Navigation -->
    <div style="display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #30363d;">
      <button class="embed-tab-btn active" onclick="switchEmbedTab('script')" data-tab="script" style="
        padding: 10px 20px; 
        background: none; 
        border: none; 
        border-bottom: 3px solid #00d4ff; 
        color: #00d4ff; 
        font-weight: 600; 
        cursor: pointer;
        transition: all 0.2s;
      ">üìú Script Tag</button>
      
      <button class="embed-tab-btn" onclick="switchEmbedTab('iframe')" data-tab="iframe" style="
        padding: 10px 20px; 
        background: none; 
        border: none; 
        border-bottom: 3px solid transparent; 
        color: #8b949e; 
        font-weight: 600; 
        cursor: pointer;
        transition: all 0.2s;
      ">üñºÔ∏è iframe</button>
      
      <!--<button class="embed-tab-btn" onclick="switchEmbedTab('wordpress')" data-tab="wordpress" style="
        padding: 10px 20px; 
        background: none; 
        border: none; 
        border-bottom: 3px solid transparent; 
        color: #8b949e; 
        font-weight: 600; 
        cursor: pointer;
        transition: all 0.2s;
      ">üîå WordPress</button>-->
    </div>
    
    <!-- Tab Contents -->
    
   <!----> SCRIPT TAB -->
    <div class="embed-tab-content" data-content="script">
      <p style="color: #8b949e; font-size: 13px; margin-bottom: 10px;">‚ú® Recommended - Works on most platforms</p>
      <div style="display: flex; gap: 10px;">
        <textarea id="embed_code_script" readonly rows="2" style="flex: 1; padding: 12px; background: #0d1117; border: 2px solid #30363d; border-radius: 6px; color: #00ff88; font-family: monospace; font-size: 12px; resize: none;"></textarea>
        <button onclick="copyEmbedCode('script')" style="padding: 12px 20px; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">üìã Copy</button>
      </div>
    </div>
    
   <!-- IFRAME TAB -->
<div class="embed-tab-content active" data-content="iframe">
  <p style="color: #8b949e; font-size: 13px; margin-bottom: 10px;">üì¶ Copy this code and paste it on your website</p>
  <div style="display: flex; gap: 10px;">
    <textarea id="embed_code_iframe" readonly rows="4" style="flex: 1; padding: 12px; background: #0d1117; border: 2px solid #30363d; border-radius: 6px; color: #00ff88; font-family: monospace; font-size: 12px; resize: none;"></textarea>
    <button onclick="copyEmbedCode('iframe')" style="padding: 12px 20px; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">üìã Copy</button>
  </div>
</div>
    
    <!-- WORDPRESS TAB -->
   <!-- <div class="embed-tab-content" data-content="wordpress" style="display: none;">
      <p style="color: #8b949e; font-size: 13px; margin-bottom: 10px;">üéØ For WordPress - Add to Custom HTML block</p>
      <div style="display: flex; gap: 10px;">
        <textarea id="embed_code_wordpress" readonly rows="2" style="flex: 1; padding: 12px; background: #0d1117; border: 2px solid #30363d; border-radius: 6px; color: #00ff88; font-family: monospace; font-size: 12px; resize: none;"></textarea>
        <button onclick="copyEmbedCode('wordpress')" style="padding: 12px 20px; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">üìã Copy</button>
      </div>
      <div style="margin-top: 10px; padding: 10px; background: #1a1a2e; border-left: 3px solid #00d4ff; border-radius: 4px;">
        <p style="color: #8b949e; font-size: 12px; margin: 0;">üí° <strong style="color: #e6edf3;">Tip:</strong> Use the Script Tab version - it's the same code and easier!</p>
      </div>
    </div>
  </div>-->
  
  <!-- TEST BUTTON -->
  <div style="margin-bottom: 20px;">
    <button onclick="testEmbed()" style="
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 15px;
    ">üß™ Test Your Embed in New Window</button>
  </div>
  
  <!-- API KEY -->
  <div style="border-top: 1px solid #30363d; padding-top: 15px;">
    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #8b949e; font-size: 13px;">Your API Key:</label>
    <div style="display: flex; gap: 10px;">
      <input type="text" id="profile_api_key" readonly style="flex: 1; padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #8b949e; font-family: monospace; font-size: 12px;">
      <button onclick="copyApiKey()" style="padding: 10px 16px; background: #30363d; color: #e6edf3; border: none; border-radius: 6px; cursor: pointer;">üìã</button>
    </div>
  </div>
</div>

<style>
/* Embed Tab Hover Effects */
.embed-tab-btn:hover {
  background: rgba(0, 212, 255, 0.1) !important;
}

.embed-tab-btn.active {
  border-bottom-color: #00d4ff !important;
  color: #00d4ff !important;
}

.embed-tab-content {
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<script>
// ============================================
// EMBED CODE GENERATOR - Updated Functions
// ============================================

// Switch between embed tabs
function switchEmbedTab(tab) {
  // Update tab buttons
  document.querySelectorAll('.embed-tab-btn').forEach(btn => {
    if (btn.dataset.tab === tab) {
      btn.classList.add('active');
      btn.style.borderBottomColor = '#00d4ff';
      btn.style.color = '#00d4ff';
    } else {
      btn.classList.remove('active');
      btn.style.borderBottomColor = 'transparent';
      btn.style.color = '#8b949e';
    }
  });
  
  // Update tab content
  document.querySelectorAll('.embed-tab-content').forEach(content => {
    if (content.dataset.content === tab) {
      content.style.display = 'block';
      content.classList.add('active');
    } else {
      content.style.display = 'none';
      content.classList.remove('active');
    }
  });
}

// Generate all embed codes (call this when profile loads)
function generateEmbedCodes() {
  const apiKey = document.getElementById('profile_api_key').value || 'YOUR_API_KEY';
  const baseUrl = 'https://white-raven-264519.hostingersite.com';
  
  // Script Tag Code
  const scriptField = document.getElementById('embed_code_script');
  if (scriptField) {
    const scriptCode = '<div id="instabid-calculator"></div>\n<scr' + 'ipt src="' + baseUrl + '/embed.js" data-api-key="' + apiKey + '"></scr' + 'ipt>';
    scriptField.value = scriptCode;
  }
  
  // iframe Code
  const iframeCode = `<iframe 
  src="${baseUrl}/estimate/?key=${apiKey}" 
  style="width:100%; height:1600px; border:none;"
  frameborder="0"
  scrolling="no">
</iframe>`;
  
  document.getElementById('embed_code_iframe').value = iframeCode;
  
  // Also update old embed code field if it exists (backwards compatibility)
  const oldEmbedField = document.getElementById('profile_embed_code');
  if (oldEmbedField) {
    oldEmbedField.value = iframeCode;
  }
}

// Copy specific embed code
function copyEmbedCode(type) {
  let textArea;
  
  if (type === 'script') {
    textArea = document.getElementById('embed_code_script');
  } else {
    textArea = document.getElementById('embed_code_iframe');
  }
  
  if (!textArea) {
    alert('‚ùå Error: Embed code field not found');
    return;
  }
  
  // Modern clipboard API
  navigator.clipboard.writeText(textArea.value).then(() => {
    alert('‚úÖ Embed code copied to clipboard!');
  }).catch(err => {
    console.error('Copy failed:', err);
    alert('‚ùå Copy failed. Please select and copy manually.');
  });
}

// Test embed in new window
function testEmbed() {
  const apiKey = document.getElementById('profile_api_key').value;
  const testUrl = `https://white-raven-264519.hostingersite.com/estimate/?key=${apiKey}`;
  window.open(testUrl, '_blank', 'width=1200,height=900');
}

// Auto-generate codes when API key is populated
const apiKeyObserver = new MutationObserver(() => {
  const apiKey = document.getElementById('profile_api_key').value;
  if (apiKey && apiKey !== 'YOUR_API_KEY') {
    generateEmbedCodes();
  }
});

// Watch for API key field updates
const apiKeyField = document.getElementById('profile_api_key');
if (apiKeyField) {
  apiKeyObserver.observe(apiKeyField, { 
    attributes: true, 
    attributeFilter: ['value'] 
  });
  
  // Also trigger on value change
  apiKeyField.addEventListener('change', generateEmbedCodes);
  
  // Generate on load if key already exists
  if (apiKeyField.value) {
    generateEmbedCodes();
  }
}
</script>
 
  <!-- SAVE BUTTON -->
  <button class="btn-save" onclick="saveCompanyProfile()">üíæ Save Company Profile</button>
  <div class="status-message" id="profile-status"></div>
</div>

<script>
// COMPANY PROFILE FUNCTIONALITY
/*const window.RAILWAY_API = 'https://roofbid-backend-production.up.railway.app';*/

// Color picker sync
['primary', 'secondary', 'accent'].forEach(color => {
  const picker = document.getElementById(`profile_${color}_color`);
  const hex = document.getElementById(`profile_${color}_hex`);
  
  picker.addEventListener('input', (e) => {
    hex.value = e.target.value.toUpperCase();
  });
});

// Logo upload handler
document.getElementById('logoFileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  if (file.size > 2 * 1024 * 1024) {
    alert('File too large! Max 2MB');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(event) {
    document.getElementById('logoImg').src = event.target.result;
    document.getElementById('logoPreview').style.display = 'block';
    document.getElementById('logoPlaceholder').style.display = 'none';
  };
  reader.readAsDataURL(file);
});

// Drag & drop for logo
const dropZone = document.getElementById('logoDropZone');
dropZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropZone.style.borderColor = '#667eea';
  dropZone.style.background = '#f0f4ff';
});

dropZone.addEventListener('dragleave', () => {
  dropZone.style.borderColor = '#ddd';
  dropZone.style.background = 'white';
});

dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.style.borderColor = '#ddd';
  dropZone.style.background = 'white';
  
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) {
    document.getElementById('logoFileInput').files = e.dataTransfer.files;
    document.getElementById('logoFileInput').dispatchEvent(new Event('change'));
  }
});

// Load contractor profile
async function loadCompanyProfile() {
  const contractorId = localStorage.getItem('contractor_id');
  const sessionToken = localStorage.getItem('session_token');
  
  if (!contractorId || !sessionToken) {
    window.location.href = '/login';
    return;
  }
  
  try {
    const response = await fetch(`${window.RAILWAY_API}/api/contractors/${contractorId}`, {
      headers: {
        'Authorization': `Bearer ${sessionToken}`
      }
    });
    
    if (response.status === 401 || response.status === 403) {
      localStorage.clear();
      window.location.href = '/login';
      return;
    }
    
    const contractor = await response.json();
    
    // Populate form fields
    document.getElementById('profile_company_name').value = contractor.company_name || '';
    document.getElementById('profile_phone').value = contractor.phone || '';
    document.getElementById('profile_email').value = contractor.email || '';
    document.getElementById('profile_address').value = contractor.address || '';
    document.getElementById('profile_city').value = contractor.city || '';
    document.getElementById('profile_state').value = contractor.state || '';
    document.getElementById('profile_zip').value = contractor.zip || '';
    document.getElementById('profile_license').value = contractor.license_number || '';
    
    // Colors
    if (contractor.primary_color) {
      document.getElementById('profile_primary_color').value = contractor.primary_color;
      document.getElementById('profile_primary_hex').value = contractor.primary_color;
    }
    if (contractor.secondary_color) {
      document.getElementById('profile_secondary_color').value = contractor.secondary_color;
      document.getElementById('profile_secondary_hex').value = contractor.secondary_color;
    }
    if (contractor.accent_color) {
      document.getElementById('profile_accent_color').value = contractor.accent_color;
      document.getElementById('profile_accent_hex').value = contractor.accent_color;
    }
    
    // Business settings
    document.getElementById('profile_tax_rate').value = contractor.tax_rate || '';
    document.getElementById('profile_default_markup').value = contractor.default_markup || '';
   
    // Labor rate override
    document.getElementById('profile_labor_rate_override').value = contractor.labor_rate_override || '';

    // Estimate display settings
    const displaySettings = contractor.estimate_display || { showLabor: false, showMaterials: false, showEquipment: false, showTotal: true };
    document.getElementById('display_show_labor').checked = displaySettings.showLabor;
    document.getElementById('display_show_materials').checked = displaySettings.showMaterials;
    document.getElementById('display_show_equipment').checked = displaySettings.showEquipment;
   
    // Logo
    if (contractor.logo_url) {
      document.getElementById('logoImg').src = contractor.logo_url;
      document.getElementById('logoPreview').style.display = 'block';
      document.getElementById('logoPlaceholder').style.display = 'none';
    }
    
    // Subscription info
    document.getElementById('profile_subscription_level').textContent = contractor.subscription_level || 'Free';
    document.getElementById('profile_subscription_status').textContent = contractor.subscription_status || 'Active';
    document.getElementById('profile_renewal_date').textContent = contractor.renewal_date ? new Date(contractor.renewal_date).toLocaleDateString() : '‚Äî';
    
    // API Key & Embed Code
    const apiKey = contractor.api_key || '';
    const baseUrl = 'https://white-raven-264519.hostingersite.com/estimate/';

    document.getElementById('profile_api_key').value = apiKey;
    document.getElementById('profile_share_link').value = baseUrl + '?key=' + apiKey;

    // Integrations
    document.getElementById('profile_stripe_pk').value = contractor.stripe_publishable_key || '';
    document.getElementById('profile_stripe_sk').value = contractor.stripe_secret_key ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '';
    document.getElementById('profile_google_maps_key').value = contractor.google_maps_api_key || '';
    document.getElementById('profile_smtp_host').value = contractor.smtp_host || '';
    document.getElementById('profile_smtp_port').value = contractor.smtp_port || '587';
    document.getElementById('profile_smtp_user').value = contractor.smtp_user || '';
    document.getElementById('profile_smtp_pass').value = contractor.smtp_pass ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '';
    
  } catch (error) {
    console.error('Error loading profile:', error);
    alert('Failed to load company profile');
  }
  setTimeout(generateEmbedCodes, 100);
}

// Email help popup
function showEmailHelp() {
  alert(`üìß Email Setup Guide:

GMAIL:
‚Ä¢ Host: smtp.gmail.com
‚Ä¢ Port: 587
‚Ä¢ Username: your@gmail.com
‚Ä¢ Password: Use an App Password (not your regular password)
  ‚Üí Google Account ‚Üí Security ‚Üí 2FA ‚Üí App Passwords

OUTLOOK/OFFICE 365:
‚Ä¢ Host: smtp.office365.com
‚Ä¢ Port: 587
‚Ä¢ Username: your@outlook.com
‚Ä¢ Password: Your password

OTHER PROVIDERS:
‚Ä¢ Check your email provider's SMTP settings
‚Ä¢ Most use port 587 with TLS`);
}

// Test email function
async function sendTestEmail() {
  const statusEl = document.getElementById('email-test-status');
  statusEl.textContent = '‚è≥ Sending...';
  statusEl.style.color = '#f59e0b';
  
  try {
    const response = await authFetch(`${API_BASE}/api/contractor/test-email`, {
      method: 'POST'
    });
    
    const result = await response.json();
    
    if (result.success) {
      statusEl.textContent = '‚úÖ Test email sent! Check your inbox.';
      statusEl.style.color = '#22c55e';
    } else {
      statusEl.textContent = '‚ùå ' + (result.error || 'Failed to send');
      statusEl.style.color = '#ef4444';
    }
  } catch (error) {
    statusEl.textContent = '‚ùå Error: ' + error.message;
    statusEl.style.color = '#ef4444';
  }
  
  setTimeout(() => { statusEl.textContent = ''; }, 5000);
}

// Save company profile
async function saveCompanyProfile() {
  const contractorId = localStorage.getItem('contractor_id');
  const sessionToken = localStorage.getItem('session_token');
  
  if (!contractorId || !sessionToken) {
    window.location.href = '/login';
    return;
  }
  
  const statusDiv = document.getElementById('profile-status');
  statusDiv.textContent = '‚è≥ Saving...';
  statusDiv.className = 'status-message';
  statusDiv.style.display = 'block';
  
  // Collect form data
  const profileData = {
    company_name: document.getElementById('profile_company_name').value,
    phone: document.getElementById('profile_phone').value,
    email: document.getElementById('profile_email').value,
    address: document.getElementById('profile_address').value,
    city: document.getElementById('profile_city').value,
    state: document.getElementById('profile_state').value.toUpperCase(),
    zip: document.getElementById('profile_zip').value,
    license_number: document.getElementById('profile_license').value,
    primary_color: document.getElementById('profile_primary_color').value,
    secondary_color: document.getElementById('profile_secondary_color').value,
    accent_color: document.getElementById('profile_accent_color').value,
    tax_rate: parseFloat(document.getElementById('profile_tax_rate').value) || null,
    default_markup: parseFloat(document.getElementById('profile_default_markup').value) || null,
    logo_url: document.getElementById('logoImg').src || null,
    labor_rate_override: parseFloat(document.getElementById('profile_labor_rate_override').value) || null,
    estimate_display: {
      showLabor: document.getElementById('display_show_labor').checked,
      showMaterials: document.getElementById('display_show_materials').checked,
      showEquipment: document.getElementById('display_show_equipment').checked,
      showTotal: true
    },
    stripe_publishable_key: document.getElementById('profile_stripe_pk').value || null,
    stripe_secret_key: document.getElementById('profile_stripe_sk').value !== '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' ? document.getElementById('profile_stripe_sk').value : undefined,
    google_maps_api_key: document.getElementById('profile_google_maps_key').value || null,
google_maps_api_key: document.getElementById('profile_google_maps_key').value || null,
smtp_host: document.getElementById('profile_smtp_host').value || null,
smtp_port: document.getElementById('profile_smtp_port').value || null,
smtp_user: document.getElementById('profile_smtp_user').value || null,
smtp_pass: document.getElementById('profile_smtp_pass').value !== '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' ? document.getElementById('profile_smtp_pass').value : undefined
};
  
  
  try {
    const response = await fetch(`${window.RAILWAY_API}/api/contractors/${contractorId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${sessionToken}`
      },
      body: JSON.stringify(profileData)
    });
    
    if (response.status === 401 || response.status === 403) {
      localStorage.clear();
      window.location.href = '/login';
      return;
    }
    
    const result = await response.json();
    
    if (result.success) {
      statusDiv.textContent = '‚úÖ Profile saved successfully!';
      statusDiv.className = 'status-message success';
      setTimeout(() => { statusDiv.style.display = 'none'; }, 3000);
    } else {
      throw new Error(result.error || 'Save failed');
    }
    
  } catch (error) {
    console.error('Error saving profile:', error);
    statusDiv.textContent = '‚ùå Error: ' + error.message;
    statusDiv.className = 'status-message error';
  }
}

// Load profile when Company Profile tab is clicked
document.querySelector('[data-main="company-profile"]').addEventListener('click', loadCompanyProfile);
</script>

    <div class="main-content" id="contracts">
      <div class="placeholder-content">
        <h2>üìÑ Contract Templates</h2>
        <p>Customize contract language, terms, payment schedules</p>
        <p style="margin-top: 20px; color: #667eea; font-weight: 600;">Coming Soon</p>
      </div>
    </div>

  </div>
</div>

<script>
const API_BASE = 'https://roofbid-backend-production.up.railway.app';


function authFetch(url, options = {}) {
  const token = localStorage.getItem('session_token');
  
  if (!token) {
    console.error('‚ùå No session token - redirecting to login');
    window.location.href = '/login/';
    return Promise.reject('Not authenticated');
  }
  
  options.headers = {
    ...options.headers,
    'Authorization': 'Bearer ' + token
  };
  
  return fetch(url, options);
}

document.querySelectorAll('.main-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.main-content').forEach(c => c.classList.remove('active'));
    
    this.classList.add('active');
    document.getElementById(this.dataset.main).classList.add('active');
  });
});

document.querySelectorAll('.sub-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
    
    this.classList.add('active');
    document.getElementById(this.dataset.sub).classList.add('active');
    
    //loadConfig(this.dataset.sub);
  });
});

window.addEventListener('load', function() {
  //loadConfig('roofing');
  checkCalendarStatus();
});

function loadConfig(section) {
  authFetch(`${API_BASE}/api/config/${section}`)
    .then(res => res.json())
    .then(data => {
      if (data.success && data.config) {
        Object.keys(data.config).forEach(key => {
          const input = document.getElementById(key);
          if (input) input.value = data.config[key];
        });
      }
    })
    .catch(err => console.error('Load error:', err));
}

function getContractorId() {
  return localStorage.getItem('contractor_id') || '1';
}

async function connectGoogleCalendar() {
  try {
    const contractorId = getContractorId();
    const res = await authFetch(`${API_BASE}/api/google/auth-url?contractor_id=${contractorId}`);
    const data = await res.json();
    
    const popup = window.open(data.auth_url, 'google-auth', 'width=500,height=600');
    
    const timer = setInterval(() => {
      if (popup.closed) {
        clearInterval(timer);
        checkCalendarStatus();
      }
    }, 500);
  } catch (err) {
    alert('Error connecting to Google: ' + err.message);
  }
}

async function syncCalendar() {
  try {
    const contractorId = getContractorId();
    const res = await authFetch(`${API_BASE}/api/google/sync`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ contractor_id: contractorId })
    });
    const data = await res.json();
    alert('Synced! Blocked ' + (data.blocked_dates ? data.blocked_dates.length : 0) + ' dates');
    checkCalendarStatus();
  } catch (err) {
    alert('Sync failed: ' + err.message);
  }
}

async function disconnectCalendar() {
  if (!confirm('Disconnect Google Calendar?')) return;
  
  try {
    const contractorId = getContractorId();
    await authFetch(`${API_BASE}/api/google/disconnect`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ contractor_id: contractorId })
    });
    checkCalendarStatus();
  } catch (err) {
    alert('Disconnect failed: ' + err.message);
  }
}

async function checkCalendarStatus() {
  try {
    const contractorId = getContractorId();
    const res = await authFetch(`${API_BASE}/api/google/status?contractor_id=${contractorId}`);
    const data = await res.json();
    
    if (data.connected) {
      document.getElementById('notConnected').style.display = 'none';
      document.getElementById('connected').style.display = 'block';
      document.getElementById('connectedEmail').textContent = data.email;
      document.getElementById('lastSync').textContent = data.last_sync || 'Never';
    } else {
      document.getElementById('notConnected').style.display = 'block';
      document.getElementById('connected').style.display = 'none';
    }
  } catch (err) {
    document.getElementById('notConnected').style.display = 'block';
    document.getElementById('connected').style.display = 'none';
  }
}

function copyShareLink() {
  const input = document.getElementById('profile_share_link');
  input.select();
  document.execCommand('copy');
  alert('‚úÖ Link copied to clipboard!');
}

/*function copyEmbedCode() {
  const textarea = document.getElementById('profile_embed_code');
  textarea.select();
  document.execCommand('copy');
  alert('‚úÖ Embed code copied to clipboard!');
}*/

function copyApiKey() {
  const input = document.getElementById('profile_api_key');
  input.select();
  document.execCommand('copy');
  alert('‚úÖ API Key copied to clipboard!');
}
</script>


<!-- InstaBid Material Calculator Scripts -->
<!--<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/roofingCalculatorEnhanced.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/paintingCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/hvacCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/electricalCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/plumbingCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/flooringCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/drywallCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/sidingCalculator.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/materialMatcher.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SiteHypeInc/instabid2@main/js/calculators/materialListGenerator.js?v=2"></script>

-->

<script>
// MAIN TAB SWITCHING
document.querySelectorAll('.main-tab').forEach(button => {
  button.addEventListener('click', function() {
    const targetSection = this.getAttribute('data-main');
    
    // Remove active class from all main tabs
    document.querySelectorAll('.main-tab').forEach(btn => btn.classList.remove('active'));
    
    // Add active class to clicked tab
    this.classList.add('active');
    
    // Hide all main content sections
    document.querySelectorAll('.main-content').forEach(content => content.classList.remove('active'));
    
    // Show target section
    document.getElementById(targetSection).classList.add('active');
    
    // If switching to estimate tracker, load estimates
    if (targetSection === 'estimate-tracker') {
      loadEstimates();
    }
  });
});

// PRICING SUB-TAB SWITCHING
function showTab(tabName) {
  // Hide all pricing tab panes
  document.querySelectorAll('.tab-pane').forEach(pane => {
    pane.classList.remove('active');
  });
  
  // Remove active from all pricing tab buttons
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Show selected pane
  const pane = document.getElementById(tabName + '-section');
  if (pane) pane.classList.add('active');
  
  // Activate clicked button
  if (event && event.target) {
    event.target.classList.add('active');
  }
}
</script>


<script>
// ============================================
// CONTRACTOR PRICING - SAVE & LOAD
// ============================================

// Field IDs for each trade
const TRADE_FIELDS = {
  roofing: ['pitch_3_12', 'pitch_4_12', 'pitch_5_12', 'pitch_6_12', 'pitch_7_12', 'pitch_8_12', 'pitch_9_12', 'pitch_10_12', 'pitch_11_12', 'pitch_12_12', 'mat_asphalt', 'mat_arch', 'mat_metal', 'mat_tile', 'mat_wood_shake', 'underlayment_roll', 'nails_box', 'starter_lf', 'ridge_lf', 'drip_edge_lf', 'ice_shield_lf', 'vent_unit', 'ridge_vent_lf', 'osb_sheet', 'disposal_asphalt_sqft', 'disposal_wood_sqft', 'disposal_metal_sqft', 'disposal_tile_sqft', 'chimney_flash', 'skylight_flash', 'valley_lf', 'labor_rate_sqft', 'chimney_labor_hrs', 'skylight_labor_hrs'],
  hvac: ['hvac_furnace_standard', 'hvac_furnace_high', 'hvac_ac_standard', 'hvac_ac_high', 'hvac_heatpump_standard', 'hvac_heatpump_high', 'hvac_minisplit', 'hvac_duct_new', 'hvac_duct_repair', 'hvac_thermostat', 'hvac_refrigerant', 'hvac_filters', 'hvac_labor_rate', 'hvac_labor_furnace', 'hvac_labor_ac', 'hvac_labor_heatpump', 'hvac_labor_minisplit', 'hvac_size_small', 'hvac_size_med', 'hvac_size_large', 'hvac_size_xlarge', 'hvac_story_2', 'hvac_story_3'],
  electrical: ['elec_wire_lf', 'elec_panel_100', 'elec_panel_200', 'elec_panel_400', 'elec_rewire_sqft', 'elec_ceiling_fan_install', 'elec_outlet', 'elec_outlet_gfci', 'elec_switch', 'elec_switch_dimmer', 'elec_light_install', 'elec_recessed', 'elec_circuit_20a', 'elec_circuit_30a', 'elec_circuit_50a', 'elec_ev_charger', 'elec_permit'],
   plumbing: ['plumb_labor_rate', 'plumb_labor_emergency', 'plumb_service_call', 'plumb_toilet', 'plumb_sink_bath', 'plumb_sink_kitchen', 'plumb_faucet_bath', 'plumb_faucet_kitchen', 'plumb_shower_valve', 'plumb_tub', 'plumb_dishwasher', 'plumb_garbage_disposal', 'plumb_ice_maker', 'plumb_heater_tank_40', 'plumb_heater_tank_50', 'plumb_heater_tankless_gas', 'plumb_heater_tankless_elec', 'plumb_water_softener', 'plumb_sump_pump', 'plumb_repipe_pex_lf', 'plumb_repipe_copper_lf', 'plumb_main_line', 'plumb_gas_line_new', 'plumb_access_basement', 'plumb_access_crawlspace', 'plumb_access_slab', 'plumb_location_garage', 'plumb_location_basement', 'plumb_location_closet', 'plumb_location_attic'],

 flooring: ['floor_carpet', 'floor_vinyl', 'floor_laminate', 'floor_lvp', 'floor_hardwood_eng', 'floor_hardwood_solid', 'floor_tile_ceramic', 'floor_tile_porcelain', 'floor_labor_carpet', 'floor_labor_vinyl', 'floor_labor_hardwood', 'floor_labor_tile', 'floor_subfloor', 'floor_removal', 'floor_underlay', 'floor_baseboard', 'floor_standard', 'floor_moderate', 'floor_complex'],
  painting: ['paint_exterior_mat', 'paint_exterior_labor', 'paint_interior_mat', 'paint_interior_labor', 'paint_ceiling_mat', 'paint_ceiling_labor', 'paint_trim_mat', 'paint_trim_labor', 'paint_door_mat', 'paint_door_labor', 'paint_window_mat', 'paint_window_labor', 'paint_power_wash_mat', 'paint_power_wash_labor', 'paint_patch_minor_mat', 'paint_patch_minor_labor', 'paint_patch_moderate_mat', 'paint_patch_moderate_labor', 'paint_patch_extensive_mat', 'paint_patch_extensive_labor', 'paint_primer_mat', 'paint_primer_labor', 'paint_lead_mat', 'paint_lead_labor'],
   drywall: ['drywall_labor_rate', 'drywall_hang_sqft', 'drywall_tape_sqft', 'drywall_sand_sqft', 'drywall_sheet_half', 'drywall_sheet_5_8', 'drywall_joint_compound', 'drywall_tape', 'drywall_screws', 'drywall_corner_bead', 'drywall_finish_level_3', 'drywall_finish_level_4', 'drywall_finish_level_5', 'drywall_texture_none', 'drywall_texture_orange_peel', 'drywall_texture_knockdown', 'drywall_texture_popcorn', 'drywall_ceiling_10ft', 'drywall_ceiling_12ft', 'drywall_repair_minor', 'drywall_repair_moderate', 'drywall_repair_extensive'],
  siding: ['siding_vinyl', 'siding_fiber_cement', 'siding_wood', 'siding_metal', 'siding_stucco', 'siding_labor_vinyl', 'siding_labor_fiber', 'siding_labor_wood', 'siding_labor_metal', 'siding_labor_stucco', 'siding_labor_rate', 'siding_housewrap_roll', 'siding_j_channel', 'siding_corner_post', 'siding_window_trim', 'siding_door_trim', 'siding_soffit_sqft', 'siding_fascia_lf', 'siding_fastener_kit', 'siding_removal_sqft', 'siding_story_2', 'siding_story_3'],
  regional: ['region_CA', 'region_NY', 'region_MA', 'region_HI', 'region_WA', 'region_OR', 'region_CO', 'region_IL', 'region_VA', 'region_TX', 'region_FL', 'region_GA', 'region_OH', 'region_TN', 'region_AL', 'region_default']
};


async function saveConfig(trade) {
  const statusEl = document.getElementById(`${trade}-status`);
  statusEl.textContent = 'Saving...';
  statusEl.style.color = '#ffc107';

  const section = document.getElementById(`${trade}-section`);
  
  if (!section) {
    console.error(`‚ùå Section not found: ${trade}-section`);
    statusEl.textContent = '‚ùå Section not found';
    statusEl.style.color = '#dc3545';
    return;
  }
  
  const inputs = section.querySelectorAll('input');
  const config = {};

  inputs.forEach(input => {
    // Use value if entered, otherwise skip (don't save empty)
    if (input.value !== '' && input.value !== undefined) {
      config[input.id] = parseFloat(input.value);
    }
  });

  console.log('üì¶ Trade:', trade);
  console.log('üì¶ Config:', config);
  console.log('üì¶ Input count:', inputs.length);

  // Allow saving even if some fields empty - just save what's filled
  if (!trade) {
    console.error('‚ùå Missing trade');
    statusEl.textContent = '‚ùå Error';
    statusEl.style.color = '#dc3545';
    return;
  }

  try {
    const token = localStorage.getItem('session_token');
    const response = await fetch(`${window.RAILWAY_API}/api/contractor/pricing`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({ trade, pricing: config })
    });

    const data = await response.json();
    console.log('üì¶ Response:', data);

    if (data.success) {
      statusEl.textContent = '‚úÖ Saved!';
      statusEl.style.color = '#28a745';
    } else {
      throw new Error(data.error || 'Save failed');
    }
  } catch (error) {
    console.error('Save error:', error);
    statusEl.textContent = '‚ùå ' + error.message;
    statusEl.style.color = '#dc3545';
  }

  setTimeout(() => {
    statusEl.textContent = '';
  }, 3000);
}

// Load all pricing on page load
async function loadContractorPricing() {
  try {
    const response = await fetch(`${API_BASE}/api/contractor/pricing`, {
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem('session_token')
      }
    });

    const data = await response.json();

    if (data.success && data.pricing) {
      // Loop through each trade's saved values
      for (const [trade, values] of Object.entries(data.pricing)) {
        for (const [key, value] of Object.entries(values)) {
          const el = document.getElementById(key);
          if (el) {
            el.value = value;
          }
        }
      }
      console.log('‚úÖ Loaded contractor pricing overrides');
    }
  } catch (err) {
    console.error('Failed to load pricing:', err);
  }
}

function logout() {
  localStorage.clear();
  window.location.href = '/login/';
}

async function loadPricingConfig() {
  try {
    const token = localStorage.getItem('session_token');
    const response = await fetch(`${window.RAILWAY_API}/api/contractor/pricing`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    const data = await response.json();

    
      // Populate form fields with saved values
    
        if (data.success && data.pricing) {
  Object.keys(data.pricing).forEach(trade => {
    const tradeConfig = data.pricing[trade];
        Object.keys(tradeConfig).forEach(fieldId => {
          const input = document.getElementById(fieldId);
          if (input) {
            input.value = tradeConfig[fieldId];
          }
        });
      });
      console.log('‚úÖ Pricing config loaded');
    }
  } catch (error) {
    console.error('Error loading pricing config:', error);
  }
}

// Check if first login - show welcome modal
function checkFirstLogin() {
  const hasSeenWelcome = localStorage.getItem('instabid_welcome_seen');
  
  if (!hasSeenWelcome) {
    document.getElementById('welcomeModal').style.display = 'flex';
  }
}

function closeWelcomeModal() {
  document.getElementById('welcomeModal').style.display = 'none';
  localStorage.setItem('instabid_welcome_seen', 'true');
  
  // Navigate to Company Profile tab
  document.querySelector('[data-main="company-profile"]').click();
}

// Call on page load
window.addEventListener('load', function() {
  checkFirstLogin();
});

// Call on page load
document.addEventListener('DOMContentLoaded', loadPricingConfig);
</script>
<!-- WELCOME MODAL -->
<div id="welcomeModal" style="
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  z-index: 9999;
  justify-content: center;
  align-items: center;
">
  <div style="
    background: linear-gradient(135deg, #1a1a2e 0%, #0d1117 100%);
    border: 2px solid #30363d;
    border-radius: 16px;
    padding: 40px;
    max-width: 500px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  ">
    <div style="font-size: 64px; margin-bottom: 20px;">üéâ</div>
    <h2 style="color: #e6edf3; margin-bottom: 10px;">Welcome to InstaBid!</h2>
    <p style="color: #8b949e; margin-bottom: 30px;">Let's get you live in 5 minutes.</p>
    
    <div style="text-align: left; margin-bottom: 30px;">
      <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #0d1117; border-radius: 8px; margin-bottom: 10px;">
        <span style="background: #238636; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</span>
        <span style="color: #e6edf3;">Add your company info & logo</span>
      </div>
      <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #0d1117; border-radius: 8px; margin-bottom: 10px;">
        <span style="background: #238636; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</span>
        <span style="color: #e6edf3;">Set your pricing for each trade</span>
      </div>
      <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #0d1117; border-radius: 8px; margin-bottom: 10px;">
        <span style="background: #238636; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</span>
        <span style="color: #e6edf3;">Copy your embed code</span>
      </div>
      <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #0d1117; border-radius: 8px;">
        <span style="background: #238636; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</span>
        <span style="color: #e6edf3;">Paste it on your website - done!</span>
      </div>
    </div>
    
    <button onclick="closeWelcomeModal()" style="
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
    ">üöÄ Let's Go!</button>
    
    <p style="color: #6e7681; font-size: 12px; margin-top: 15px;">
      Questions? Email support@instabid.com
    </p>
  </div>
</div>
</body>
</html>