<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InstaBid - Multi-Trade Estimator</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  overflow: hidden;
}

.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  text-align: center;
}

.header h1 {
  font-size: 2.5em;
  margin-bottom: 10px;
}

.main-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  padding: 30px;
}

.left-column, .right-column {
  padding: 20px;
}

.right-column {
  background: #f8f9fa;
  border-radius: 8px;
  min-height: 600px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  color: #333;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 1em;
  font-family: inherit;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #667eea;
}

.map-container {
  margin: 20px 0;
  border: 2px solid #ddd;
  border-radius: 6px;
  height: 500px;
  overflow: hidden;
  display: grid;
  grid-template-rows: 1fr 1fr;
  gap: 0;
}

.map-view {
  position: relative;
  height: 100%;
}

.map-label {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(255, 255, 255, 0.95);
  padding: 8px 12px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 0.9em;
  z-index: 1;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

#aerialMap {
  width: 100%;
  height: 100%;
}

#streetView {
  width: 100%;
  height: 100%;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 15px 30px;
  font-size: 1.1em;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  width: 100%;
  margin-top: 20px;
}

.btn-primary:hover {
  opacity: 0.9;
}

.btn-primary:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.result-section {
  display: none;
}

.result-section.active {
  display: block;
}

.result-section h2 {
  color: #667eea;
  margin-bottom: 20px;
  font-size: 1.8em;
}

.cost-breakdown {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
}

.cost-item {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #eee;
  font-size: 1.1em;
}

.cost-item:last-child {
  border-bottom: none;
  font-weight: bold;
  font-size: 1.3em;
  color: #667eea;
  padding-top: 15px;
  margin-top: 10px;
  border-top: 2px solid #667eea;
}

.action-buttons {
  display: flex;
  gap: 15px;
  margin-top: 20px;
}

.btn-action {
  flex: 1;
  padding: 12px 20px;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  font-size: 1em;
}

.btn-email {
  background: #28a745;
  color: white;
}

.btn-pdf {
  background: #dc3545;
  color: white;
}

.btn-contract {
  background: #ffc107;
  color: #333;
}

.btn-action:hover {
  opacity: 0.9;
}

.error-message {
  background: #f8d7da;
  color: #721c24;
  padding: 15px;
  border-radius: 6px;
  margin: 20px 0;
  display: none;
}

.photo-upload {
  margin: 20px 0;
}

.photo-preview {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-top: 10px;
}

.photo-item {
  position: relative;
  border-radius: 6px;
  overflow: hidden;
  border: 2px solid #ddd;
}

.photo-item img {
  width: 100%;
  height: 100px;
  object-fit: cover;
}

.photo-item button {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(255, 0, 0, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 25px;
  height: 25px;
  cursor: pointer;
  font-size: 16px;
}

@media (max-width: 968px) {
  .main-content {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üèóÔ∏è InstaBid</h1>
    <p>Multi-Trade Instant Estimator</p>
  </div>

  <div class="main-content">
    <div class="left-column">
      <form id="estimateForm">
        <div class="form-group">
          <label>Select Trade *</label>
          <select id="tradeSelector" required>
            <option value="">-- Select a Trade --</option>
            <option value="roofing">Roofing</option>
            <option value="hvac">HVAC</option>
            <option value="electrical">Electrical</option>
            <option value="plumbing">Plumbing</option>
            <option value="flooring">Flooring</option>
            <option value="painting">Painting</option>
            <option value="drywall">Drywall</option>
            <option value="siding">Siding</option>
        <!--<option value="general_contracting">General Contracting</option>-->
          </select>
        </div>

        <div id="dynamicFormFields"></div>

        <div class="photo-upload">
          <label>Upload Photos (Optional)</label>
          <input type="file" id="photoInput" accept="image/*" multiple>
          <div class="photo-preview" id="photoPreview"></div>
        </div>

        <div class="map-container">
          <div class="map-view">
            <div class="map-label">üõ∞Ô∏è Aerial View</div>
            <div id="aerialMap"></div>
          </div>
          <div class="map-view">
            <div class="map-label">üöó Street View</div>
            <div id="streetView"></div>
          </div>
        </div>

        <button type="submit" class="btn-primary" id="submitBtn">Get Instant Estimate</button>
      </form>
    </div>

    <div class="right-column">
      <div class="result-section" id="resultSection">
        <h2>Your Estimate</h2>
        <div class="cost-breakdown" id="costBreakdown"></div>
        <div class="action-buttons">
          <button class="btn-action btn-email" id="emailBtn">üìß Email</button>
          <button class="btn-action btn-pdf" id="pdfBtn">üìÑ PDF</button>
          <button class="btn-action btn-contract" id="contractBtn">üìù Contract</button>
        </div>
      </div>
      <div class="error-message" id="errorMessage"></div>
    </div>
  </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5u7bMfb76Il4K9x6oP-k2wccwB1mbSP0&libraries=places"></script>
<script>
var TRADE_FORM_SCHEMA = {
  roofing: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'pitch', label: 'Roof Pitch', type: 'select', options: ['3/12', '4/12', '5/12', '6/12', '7/12', '8/12', '9/12', '10/12', '11/12', '12/12+'], required: true },
    { name: 'material', label: 'Roofing Material', type: 'select', options: ['Asphalt Shingles ($2.50/sqft)', 'Architectural Shingles ($3.50/sqft)', 'Metal ($5.00/sqft)', 'Tile ($7.00/sqft)', 'Wood Shake ($6.00/sqft)'], required: true },
    { name: 'stories', label: 'Number of Stories', type: 'number', required: true },
    { name: 'layers', label: 'Existing Layers to Remove', type: 'number', required: false },
    { name: 'chimneys', label: 'Number of Chimneys', type: 'number', required: false },
    { name: 'valleys', label: 'Number of Valleys', type: 'number', required: false },
    { name: 'needsPlywood', label: 'Needs Plywood Replacement?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'plywoodSqft', label: 'Plywood Square Feet', type: 'number', required: false },
    { name: 'existingRoofType', label: 'Existing Roof Type', type: 'select', options: ['asphalt', 'tile', 'metal', 'wood_shake'], required: false },
    { name: 'skylights', label: 'Number of Skylights', type: 'number', required: false },
    { name: 'ridgeVentFeet', label: 'Ridge Vent (Linear Feet)', type: 'number', required: false },
    { name: 'additionalNotes', label: 'Additional Details', type: 'textarea', required: false }
  ],

  hvac: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'systemType', label: 'System Type', type: 'select', options: ['Central AC', 'Heat Pump', 'Furnace', 'Ductless Mini-Split', 'Boiler'], required: true },
    { name: 'units', label: 'Number of Units', type: 'number', required: true },
    { name: 'stories', label: 'Number of Stories', type: 'number', required: true },
    { name: 'registers', label: 'Number of Registers (Supply/Return)', type: 'number', required: false },
    { name: 'accessType', label: 'Access Type', type: 'select', options: ['basement', 'crawlspace', 'attic', 'slab'], required: false },
    { name: 'existingDucts', label: 'Existing Ductwork', type: 'select', options: ['yes', 'no', 'partial'], required: false },
    { name: 'zoning', label: 'Zoning', type: 'select', options: ['single', 'multi'], required: false },
    { name: 'tonnage', label: 'Tonnage', type: 'select', options: ['1.5', '2', '2.5', '3', '3.5', '4', '5'], required: false },
    { name: 'efficiency', label: 'Efficiency Rating', type: 'select', options: ['standard_14', 'high_16_20', 'premium_20plus'], required: false },
    { name: 'gasLineNeeded', label: 'Gas Line Needed?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'electricalUpgrade', label: 'Electrical Upgrade Needed?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'additionalNotes', label: 'Additional Details', type: 'textarea', required: false }
  ],

  electrical: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'serviceType', label: 'Service Type', type: 'select', options: ['panel', 'rewire', 'general'], required: true },
    { name: 'stories', label: 'Number of Stories', type: 'number', required: true },
    { name: 'amperage', label: 'Panel Amperage', type: 'select', options: ['100', '150', '200', '400'], required: false },
    { name: 'receptacles', label: 'Number of Receptacles (Outlets)', type: 'number', required: false },
    { name: 'switches', label: 'Number of Switches', type: 'number', required: false },
    { name: 'lightFixtures', label: 'Number of Light Fixtures', type: 'number', required: false },
    { name: 'accessType', label: 'Access Type', type: 'select', options: ['basement', 'crawlspace', 'attic', 'slab'], required: false },
    { name: 'knobAndTube', label: 'Knob & Tube Wiring?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'aluminumWiring', label: 'Aluminum Wiring?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'arcFaultBreakers', label: 'Arc-Fault Breakers Required?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'gfciOutlets', label: 'Number of GFCI Outlets', type: 'number', required: false },
    { name: 'ceilingFans', label: 'Number of Ceiling Fans', type: 'number', required: false },
    { name: 'smartHome', label: 'Smart Home Integration?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'additionalNotes', label: 'Additional Details', type: 'textarea', required: false }
  ],

  plumbing: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: false },
    { name: 'serviceType', label: 'Service Type', type: 'select', options: ['repipe', 'water_heater', 'fixture', 'general'], required: true },
    { name: 'stories', label: 'Number of Stories', type: 'number', required: true },
    { name: 'bathrooms', label: 'Number of Bathrooms', type: 'number', required: true },
    { name: 'accessType', label: 'Access Type', type: 'select', options: ['basement', 'crawlspace', 'slab'], required: false },
    { name: 'kitchens', label: 'Number of Kitchens', type: 'number', required: false },
    { name: 'laundryRooms', label: 'Number of Laundry Rooms', type: 'number', required: false },
    { name: 'heaterType', label: 'Water Heater Type', type: 'select', options: ['tank', 'tankless'], required: false },
    { name: 'waterHeaterLocation', label: 'Water Heater Location', type: 'select', options: ['garage', 'basement', 'attic', 'closet'], required: false },
    { name: 'gasLineNeeded', label: 'Gas Line Needed?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'sewerLineType', label: 'Sewer Line Type', type: 'select', options: ['city', 'septic'], required: false },
    { name: 'mainLineReplacement', label: 'Main Line Replacement?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'garbageDisposal', label: 'Garbage Disposal?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'iceMaker', label: 'Ice Maker Line?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'waterSoftener', label: 'Water Softener?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'fixtures', label: 'Number of Fixtures', type: 'number', required: false },
    { name: 'additionalNotes', label: 'Additional Details', type: 'textarea', required: false }
  ],

  flooring: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'floorType', label: 'Flooring Type', type: 'select', options: ['hardwood', 'engineered_hardwood', 'laminate', 'tile', 'carpet', 'vinyl', 'lvp'], required: true },
    { name: 'stories', label: 'Number of Stories', type: 'number', required: true },
    { name: 'rooms', label: 'Number of Rooms', type: 'number', required: false },
    { name: 'needRemoval', label: 'Remove Existing Flooring?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'stairs', label: 'Include Stairs?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'stairSteps', label: 'Number of Stair Steps', type: 'number', required: false },
    { name: 'subfloorCondition', label: 'Subfloor Condition', type: 'select', options: ['good', 'needs_repair', 'needs_replacement'], required: false },
    { name: 'moistureIssues', label: 'Moisture Issues?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'transitionStrips', label: 'Number of Transition Strips', type: 'number', required: false },
    { name: 'baseboardRemoval', label: 'Remove/Reinstall Baseboard?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'floorHeating', label: 'Radiant Floor Heating?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'additionalNotes', label: 'Additional Details', type: 'textarea', required: false }
  ],

  painting: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'paintType', label: 'Paint Type', type: 'select', options: ['interior', 'exterior', 'both'], required: true },
    { name: 'stories', label: 'Number of Stories', type: 'number', required: true },
    { name: 'coats', label: 'Number of Coats', type: 'select', options: ['1', '2', '3'], required: false },
    { name: 'rooms', label: 'Number of Rooms', type: 'number', required: false },
    { name: 'includeCeilings', label: 'Include Ceilings?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'includeTrim', label: 'Include Trim?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'doorCount', label: 'Number of Doors', type: 'number', required: false },
    { name: 'windowCount', label: 'Number of Windows', type: 'number', required: false },
    { name: 'sidingType', label: 'Siding Type (Exterior)', type: 'select', options: ['wood', 'vinyl', 'brick', 'stucco', 'hardie', 'metal'], required: false },
    { name: 'sidingCondition', label: 'Siding Condition', type: 'select', options: ['excellent', 'good', 'fair', 'poor', 'needs_repair'], required: false },
    { name: 'cabinetPainting', label: 'Paint Cabinets?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'cabinetCount', label: 'Number of Cabinet Faces', type: 'number', required: false },
    { name: 'wallCondition', label: 'Wall Condition', type: 'select', options: ['smooth', 'textured', 'damaged'], required: false },
    { name: 'patchingNeeded', label: 'Patching Needed', type: 'select', options: ['none', 'minor', 'moderate', 'extensive'], required: false },
    { name: 'powerWashing', label: 'Power Washing (Exterior)?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'leadPaint', label: 'Lead Paint Present (Pre-1978)?', type: 'radio', options: ['yes', 'no', 'unknown'], required: false },
    { name: 'colorChangeDramatic', label: 'Dramatic Color Change?', type: 'radio', options: ['yes', 'no'], required: false },
    { name: 'additionalNotes', label: 'Additional Details', type: 'textarea', required: false }
  ],

  drywall: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'projectType', label: 'Project Type', type: 'select', options: ['new_construction', 'repair'], required: true },
    { name: 'rooms', label: 'Number of Rooms', type: 'number', required: true },
    { name: 'ceilingHeight', label: 'Ceiling Height', type: 'select', options: ['8ft', '9ft', '10ft', '12ft+'], required: true },
    { name: 'finishLevel', label: 'Finish Level', type: 'select', options: ['level_3_standard', 'level_4_smooth', 'level_5_glass'], required: false },
    { name: 'textureType', label: 'Texture Type', type: 'select', options: ['none', 'orange_peel', 'knockdown', 'popcorn'], required: false },
    { name: 'damageExtent', label: 'Damage Extent (Repair)', type: 'select', options: ['minor', 'moderate', 'extensive'], required: false },
    { name: 'additionalNotes', label: 'Additional Details', type: 'textarea', required: false }
  ],

  siding: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'sidingType', label: 'Siding Type', type: 'select', options: ['vinyl', 'fiber_cement', 'wood_cedar', 'metal_aluminum', 'stucco'], required: true },
    { name: 'stories', label: 'Number of Stories', type: 'number', required: true },
    { name: 'needsRemoval', label: 'Remove Existing Siding?', type: 'radio', options: ['yes', 'no'], required: true },
    { name: 'windowCount', label: 'Number of Windows', type: 'number', required: false },
    { name: 'doorCount', label: 'Number of Doors', type: 'number', required: false },
    { name: 'trimLinearFeet', label: 'Trim (Linear Feet)', type: 'number', required: false },
    { name: 'additionalNotes', label: 'Additional Details', type: 'textarea', required: false }
  ],

  general_contracting: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'projectType', label: 'Project Type', type: 'select', options: ['Remodel', 'Addition', 'New Construction', 'Renovation'], required: true },
    { name: 'projectDetails', label: 'Project Details', type: 'textarea', required: true }
  ]
};

var selectedTrade = null;
var aerialMap = null;
var streetViewPanorama = null;
var marker = null;
var uploadedPhotos = [];
var currentEstimateData = null;

// ============================================
// EMAIL NOTIFICATION STYLES (ADD ANIMATIONS)
// ============================================
const styleSheet = document.createElement('style');
styleSheet.textContent = `
  @keyframes slideIn {
    from { transform: translate(-50%, -60%); opacity: 0; }
    to { transform: translate(-50%, -50%); opacity: 1; }
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  .email-notification button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }
`;
document.head.appendChild(styleSheet);

// ============================================
// EMAIL NOTIFICATION FUNCTIONS (GLOBAL SCOPE)
// ============================================

function showEmailNotification() {
  const overlay = document.createElement('div');
  overlay.className = 'email-notification-overlay';
  overlay.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    animation: fadeIn 0.3s ease;
  `;
  
  const notification = document.createElement('div');
  notification.className = 'email-notification';
  notification.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 40px 50px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    z-index: 10000;
    text-align: center;
    animation: slideIn 0.3s ease;
    max-width: 500px;
  `;
  
  notification.innerHTML = `
    <div style="font-size: 60px; margin-bottom: 20px;">üìß</div>
    <h2 style="color: #28a745; font-size: 28px; margin-bottom: 15px;">Thanks for your request!</h2>
    <p style="color: #666; font-size: 16px; line-height: 1.6; margin-bottom: 25px;">
      Your estimate is already on the way to your inbox!<br>
      We'll be in touch shortly to discuss your project.
    </p>
    <button onclick="closeEmailNotification()" style="
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    ">Got it!</button>
  `;
  
  document.body.appendChild(overlay);
  document.body.appendChild(notification);
  
  overlay.onclick = closeEmailNotification;
  setTimeout(closeEmailNotification, 5000);
}

function showEmailErrorNotification(errorMsg) {
  const overlay = document.createElement('div');
  overlay.className = 'email-notification-overlay';
  overlay.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    animation: fadeIn 0.3s ease;
  `;
  
  const notification = document.createElement('div');
  notification.className = 'email-notification';
  notification.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 40px 50px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    z-index: 10000;
    text-align: center;
    animation: slideIn 0.3s ease;
    max-width: 500px;
  `;
  
  notification.innerHTML = `
    <div style="font-size: 60px; margin-bottom: 20px;">‚ö†Ô∏è</div>
    <h2 style="color: #dc3545; font-size: 28px; margin-bottom: 15px;">Thanks for your request!</h2>
    <p style="color: #666; font-size: 16px; line-height: 1.6; margin-bottom: 10px;">
      Your estimate is already on the way to your inbox!<br>
    </p>
   <!-- <p style="color: #999; font-size: 14px; margin-bottom: 25px;">
      ${errorMsg}
    </p>-->
    <p style="color: #666; font-size: 15px; margin-bottom: 25px;">
      We'll be in touch shortly to discuss your project.
    </p>
    <button onclick="closeEmailNotification()" style="
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    ">Okay</button>
  `;
  
  document.body.appendChild(overlay);
  document.body.appendChild(notification);
  
  overlay.onclick = closeEmailNotification;
}

function closeEmailNotification() {
  const overlay = document.querySelector('.email-notification-overlay');
  const notification = document.querySelector('.email-notification');
  
  if (overlay) overlay.remove();
  if (notification) notification.remove();
}

// ============================================
// TRADE SELECTOR
// ============================================

document.getElementById('tradeSelector').addEventListener('change', function() {
  selectedTrade = this.value;
  if (selectedTrade) {
    renderForm(selectedTrade);
  } else {
    document.getElementById('dynamicFormFields').innerHTML = '';
  }
});

function renderForm(trade) {
  var container = document.getElementById('dynamicFormFields');
  container.innerHTML = '';
  
  var schema = TRADE_FORM_SCHEMA[trade];
  
  var helpers = {
    squareFeet: { placeholder: '2000', hint: '' },
    pitch: { placeholder: '6/12 or 8/12', hint: 'Enter as ratio (e.g., 4/12, 6/12, 9/12)' },
    material: { placeholder: '2.50', hint: 'Material cost per square foot (e.g., 2.50, 3.75)' },
    layers: { placeholder: '1', default: '1' },
    plywoodSqft: { placeholder: '0', default: '0', hint: 'Estimated sqft of plywood decking to replace' },
    chimneys: { placeholder: '0', default: '0' },
    valleys: { placeholder: '0', default: '0' },
    skylights: { placeholder: '0', default: '0', hint: '$300 each for flashing work' },
    ridgeVentFeet: { placeholder: '0', default: '0', hint: '$10 per linear foot' },
    stories: { placeholder: '1', default: '1' }
  };
  
  for (var i = 0; i < schema.length; i++) {
    var field = schema[i];
    var formGroup = document.createElement('div');
    formGroup.className = 'form-group';
    
    var input;
    var helper = helpers[field.name] || {};
    
    if (field.type === 'radio') {
      var label = document.createElement('label');
      label.textContent = field.label + (field.required ? ' *' : '');
      formGroup.appendChild(label);
      
      var radioContainer = document.createElement('div');
      radioContainer.style.display = 'flex';
      radioContainer.style.gap = '15px';
      radioContainer.style.marginTop = '8px';
      
      for (var j = 0; j < field.options.length; j++) {
        var radioLabel = document.createElement('label');
        radioLabel.style.display = 'flex';
        radioLabel.style.alignItems = 'center';
        radioLabel.style.gap = '5px';
        radioLabel.style.fontWeight = 'normal';
        
        var radioInput = document.createElement('input');
        radioInput.type = 'radio';
        radioInput.name = field.name;
        radioInput.value = field.options[j];
        if (j === 0) radioInput.checked = true;
        
        radioLabel.appendChild(radioInput);
        radioLabel.appendChild(document.createTextNode(field.options[j]));
        radioContainer.appendChild(radioLabel);
      }
      
      formGroup.appendChild(radioContainer);
    } else if (field.type === 'checkbox') {
      var label = document.createElement('label');
      input = document.createElement('input');
      input.type = 'checkbox';
      input.name = field.name;
      input.id = field.name;
      input.value = 'yes';
      label.appendChild(input);
      label.appendChild(document.createTextNode(' ' + field.label));
      formGroup.appendChild(label);
    } else {
      var label = document.createElement('label');
      label.textContent = field.label + (field.required ? ' *' : '');
      formGroup.appendChild(label);
      
      if (field.type === 'select') {
        input = document.createElement('select');
        input.innerHTML = '<option value="">Select...</option>';
        for (var j = 0; j < field.options.length; j++) {
          var option = document.createElement('option');
          option.value = field.options[j];
          option.textContent = field.options[j];
          input.appendChild(option);
        }
      } else if (field.type === 'textarea') {
        input = document.createElement('textarea');
        input.rows = 4;
      } else {
        input = document.createElement('input');
        input.type = field.type;
        
        if (helper.placeholder) {
          input.placeholder = helper.placeholder;
        }
        if (helper.default && !field.required) {
          input.value = helper.default;
        }
        
        if (field.type === 'number' && !field.required) {
          input.min = '0';
        }
      }
      
      input.name = field.name;
      input.id = field.name;
      input.required = field.required;
      
      formGroup.appendChild(input);
      
      if (helper.hint) {
        var small = document.createElement('small');
        small.textContent = helper.hint;
        small.style.display = 'block';
        small.style.marginTop = '5px';
        small.style.color = '#666';
        small.style.fontSize = '0.9em';
        formGroup.appendChild(small);
      }
    }
    
    container.appendChild(formGroup);
  }
  
  setTimeout(initMaps, 100);
}

// ============================================
// PHOTO UPLOAD
// ============================================

document.getElementById('photoInput').addEventListener('change', function(e) {
  var files = Array.prototype.slice.call(e.target.files);
  for (var i = 0; i < files.length; i++) {
    var file = files[i];
    var reader = new FileReader();
    reader.onload = function(event) {
      uploadedPhotos.push(event.target.result);
      renderPhotos();
    };
    reader.readAsDataURL(file);
  }
});

function renderPhotos() {
  var container = document.getElementById('photoPreview');
  container.innerHTML = '';
  for (var i = 0; i < uploadedPhotos.length; i++) {
    var photo = uploadedPhotos[i];
    var div = document.createElement('div');
    div.className = 'photo-item';
    div.innerHTML = '<img src="' + photo + '" alt="Photo ' + (i + 1) + '"><button type="button" onclick="removePhoto(' + i + ')">√ó</button>';
    container.appendChild(div);
  }
}

function removePhoto(index) {
  uploadedPhotos.splice(index, 1);
  renderPhotos();
}

// ============================================
// GOOGLE MAPS - SPLIT VIEW (AERIAL + STREET)
// ============================================

function initMaps() {
  // Initialize Aerial Map (Top)
  aerialMap = new google.maps.Map(document.getElementById('aerialMap'), {
    center: { lat: 39.8283, lng: -98.5795 },
    zoom: 4,
    mapTypeId: 'satellite',
    mapTypeControl: true,
    mapTypeControlOptions: {
      style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
      position: google.maps.ControlPosition.TOP_RIGHT
    },
    fullscreenControl: true,
    zoomControl: true
  });
  
  // Initialize Street View (Bottom)
  streetViewPanorama = new google.maps.StreetViewPanorama(
    document.getElementById('streetView'),
    {
      position: { lat: 39.8283, lng: -98.5795 },
      pov: { heading: 34, pitch: 10 },
      addressControl: true,
      visible: false
    }
  );
  
  // Setup address autocomplete
  var addressInput = document.getElementById('address');
  if (addressInput) {
    var autocomplete = new google.maps.places.Autocomplete(addressInput);
    autocomplete.addListener('place_changed', function() {
      var place = autocomplete.getPlace();
      if (place.geometry) {
        var location = place.geometry.location;
        
        // Update Aerial Map
        aerialMap.setCenter(location);
        aerialMap.setZoom(19);
        
        if (marker) marker.setMap(null);
        marker = new google.maps.Marker({
          position: location,
          map: aerialMap,
          title: 'Property Location'
        });
        
        // Update Street View
        var streetViewService = new google.maps.StreetViewService();
        streetViewService.getPanorama(
          { location: location, radius: 50 },
          function(data, status) {
            if (status === 'OK') {
              streetViewPanorama.setPosition(location);
              streetViewPanorama.setPov({
                heading: 34,
                pitch: 10
              });
              streetViewPanorama.setVisible(true);
            } else {
              // Street View not available
              document.getElementById('streetView').innerHTML = 
                '<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f0f0f0; color: #666; font-size: 1.1em;">' +
                'üö´ Street View not available at this location' +
                '</div>';
            }
          }
        );
        
        // Auto-fill city, state, zip
        var components = place.address_components;
        for (var i = 0; i < components.length; i++) {
          var comp = components[i];
          if (comp.types.indexOf('locality') > -1) {
            document.getElementById('city').value = comp.long_name;
          }
          if (comp.types.indexOf('administrative_area_level_1') > -1) {
            document.getElementById('state').value = comp.short_name;
          }
          if (comp.types.indexOf('postal_code') > -1) {
            document.getElementById('zip').value = comp.long_name;
          }
        }
      }
    });
  }
}

// ============================================
// FORM SUBMISSION
// ============================================

document.getElementById('estimateForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  var formData = new FormData(e.target);
  var data = {};
  
  formData.forEach(function(value, key) {
    data[key] = value;
  });
  
  var checkboxes = e.target.querySelectorAll('input[type="checkbox"]');
  for (var i = 0; i < checkboxes.length; i++) {
    var cb = checkboxes[i];
    if (!data[cb.name]) {
      data[cb.name] = cb.checked ? 'yes' : 'no';
    }
  }

  currentEstimateData = Object.assign({}, data);
  data.trade = selectedTrade;
  data.photos = uploadedPhotos;
  const urlParams = new URLSearchParams(window.location.search);
  data.api_key = urlParams.get('key') || 'ib_74064730bb369effbc6bdfe50b5352e72180054351a5f3afb87839af29b029be';
  console.log('üîë API Key being sent:', data.api_key);
  var submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = '‚è≥ Calculating...';
  console.log('üì¶ FULL DATA OBJECT:', JSON.stringify(data));
  
  fetch('https://roofbid-backend-production.up.railway.app/api/estimate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(function(response) {
    console.log('Response received:', response);
    return response.json().then(function(result) {
      console.log('Parsed JSON:', result);
      return { ok: response.ok, result: result };
    });
  })
  .then(function(data) {
    if (data.ok) {
      displayResults(data.result);
    } else {
      var errorMsg = data.result.user_message || data.result.error || 'Failed to calculate estimate';
      showError(errorMsg);
    }
    submitBtn.disabled = false;
    submitBtn.textContent = 'Get Instant Estimate';
  })
  .catch(function(error) {
    showError('Network error: ' + error.message);
    submitBtn.disabled = false;
    submitBtn.textContent = 'Get Instant Estimate';
  });
});

function displayResults(result) {
  var breakdown = document.getElementById('costBreakdown');
  
  var itemsHTML = '';
  result.lineItems.forEach(function(item) {
    itemsHTML += '<div class="cost-item"><span>' + item.description + ':</span><span>$' + item.amount.toFixed(2) + '</span></div>';
  });
  
  breakdown.innerHTML = itemsHTML + 
    '<div class="cost-item"><span>Subtotal:</span><span>$' + result.subtotal.toFixed(2) + '</span></div>' +
    '<div class="cost-item"><span>Tax (8.25%):</span><span>$' + result.tax.toFixed(2) + '</span></div>' +
    '<div class="cost-item"><span>Region: ' + result.msa + '</span><span>Timeline: ' + result.timeline + '</span></div>' +
    '<div class="cost-item"><span>Total Cost:</span><span>$' + result.total.toFixed(2) + '</span></div>';
  
  document.getElementById('resultSection').classList.add('active');
}

function showError(message) {
  var errorDiv = document.getElementById('errorMessage');
  errorDiv.innerHTML = '‚ùå ' + message + ' <button onclick="this.parentElement.style.display=\'none\'" style="margin-left:10px;cursor:pointer;">‚úï</button>';
  errorDiv.style.display = 'block';
}

// ============================================
// EMAIL BUTTON HANDLER
// ============================================

document.getElementById('emailBtn').addEventListener('click', function() {
  if (!currentEstimateData) return;
  
  this.disabled = true;
  this.textContent = '‚è≥ Sending...';
  
  var self = this;
  
  fetch('https://roofbid-backend-production.up.railway.app/api/estimate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(currentEstimateData)
  })
  .then(function(response) {
    return response.json().then(function(result) {
      return { ok: response.ok, result: result };
    });
  })
  .then(function(data) {
    if (data.ok) {
      showEmailNotification();
    } else {
      showEmailErrorNotification(data.result.error || 'Unknown error');
    }
    self.disabled = false;
    self.textContent = 'üìß Email';
  })
  .catch(function(error) {
    showEmailErrorNotification('Network error: ' + error.message);
    self.disabled = false;
    self.textContent = 'üìß Email';
  });
});

// ============================================
// PDF BUTTON HANDLER
// ============================================

document.getElementById('pdfBtn').addEventListener('click', function() {
  if (!currentEstimateData) return;
  
  this.disabled = true;
  this.textContent = '‚è≥ Generating...';
  
  var self = this;
  var payload = Object.assign({}, currentEstimateData);
  payload.trade = selectedTrade;
  payload.photos = uploadedPhotos;
  
  fetch('https://roofbid-backend-production.up.railway.app/api/generate-pdf', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(function(response) {
    if (!response.ok) throw new Error('PDF generation failed');
    return response.blob();
  })
  .then(function(blob) {
    var url = window.URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'estimate-' + (currentEstimateData.name || 'customer').replace(/\s+/g, '-') + '.pdf';
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
    
    self.disabled = false;
    self.textContent = 'üìÑ PDF';
    alert('‚úÖ PDF downloaded!');
  })
  .catch(function(error) {
    alert('‚ùå PDF error: ' + error.message);
    self.disabled = false;
    self.textContent = 'üìÑ PDF';
  });
});

// ============================================
// CONTRACT BUTTON HANDLER
// ============================================

document.getElementById('contractBtn').addEventListener('click', function() {
  if (!currentEstimateData) return;
  
  this.disabled = true;
  this.textContent = '‚è≥ Generating...';
  
  var self = this;
  var payload = Object.assign({}, currentEstimateData);
  payload.trade = selectedTrade;
  payload.photos = uploadedPhotos;
  
  console.log('üìù Sending contract request:', payload);
  
  fetch('https://roofbid-backend-production.up.railway.app/api/generate-contract', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(function(response) {
    console.log('Response status:', response.status);
    if (!response.ok) throw new Error('Contract generation failed');
    return response.blob();
  })
  .then(function(blob) {
    console.log('‚úÖ Blob received, size:', blob.size);
    var url = window.URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'contract-' + (currentEstimateData.name || 'customer').replace(/\s+/g, '-') + '.pdf';
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
    
    self.disabled = false;
    self.textContent = 'üìù Contract';
    alert('‚úÖ Contract downloaded!');
  })
  .catch(function(error) {
    console.error('‚ùå Contract error:', error);
    alert('‚ùå Contract error: ' + error.message);
    self.disabled = false;
    self.textContent = 'üìù Contract';
  });
});

// ========== FIELD SPY v3 - CATCHES PROPERTY CHANGES ==========
(function() {
  console.log('üïµÔ∏è FIELD SPY v3 - Deep property watching...');
  
  function watchField(el) {
    const id = el.id || el.name || 'unnamed';
    let lastValue = el.value;
    
    // Poll for changes every 100ms
    setInterval(function() {
      if (el.value !== lastValue) {
        console.log(`ü§ñ VALUE CHANGED [${id}]: "${lastValue}" ‚Üí "${el.value}"`);
        console.trace('Check call stack above');
        lastValue = el.value;
      }
    }, 100);
    
    // Also catch user input
    el.addEventListener('input', function() {
      lastValue = el.value; // Update so we don't double-report
      console.log(`üë§ USER [${id}]: "${el.value}"`);
    });
  }
  
  // Watch existing fields
  document.querySelectorAll('input, select, textarea').forEach(watchField);
  
  // Watch for dynamically added fields
  new MutationObserver(function(mutations) {
    mutations.forEach(function(m) {
      m.addedNodes.forEach(function(node) {
        if (node.nodeType === 1) {
          if (node.matches && node.matches('input, select, textarea')) {
            watchField(node);
          }
          node.querySelectorAll && node.querySelectorAll('input, select, textarea').forEach(watchField);
        }
      });
    });
  }).observe(document.body, { childList: true, subtree: true });
  
  console.log('üïµÔ∏è v3 active - will catch ALL value changes with stack traces');
})();
// ========== END FIELD SPY v3 ==========

</script>
</body>
</html>