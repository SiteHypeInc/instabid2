<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InstaBid - Multi-Trade Estimator</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  overflow: hidden;
}

.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  text-align: center;
}

.header h1 {
  font-size: 2.5em;
  margin-bottom: 10px;
}

.main-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  padding: 30px;
}

.left-column, .right-column {
  padding: 20px;
}

.right-column {
  background: #f8f9fa;
  border-radius: 8px;
  min-height: 600px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  color: #333;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 1em;
  font-family: inherit;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #667eea;
}

.map-container {
  margin: 20px 0;
  border: 2px solid #ddd;
  border-radius: 6px;
  height: 250px;
  overflow: hidden;
}

#map {
  width: 100%;
  height: 100%;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 15px 30px;
  font-size: 1.1em;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  width: 100%;
  margin-top: 20px;
}

.btn-primary:hover {
  opacity: 0.9;
}

.btn-primary:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.result-section {
  display: none;
}

.result-section.active {
  display: block;
}

.result-section h2 {
  color: #667eea;
  margin-bottom: 20px;
  font-size: 1.8em;
}

.cost-breakdown {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
}

.cost-item {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #eee;
  font-size: 1.1em;
}

.cost-item:last-child {
  border-bottom: none;
  font-weight: bold;
  font-size: 1.3em;
  color: #667eea;
  padding-top: 15px;
  margin-top: 10px;
  border-top: 2px solid #667eea;
}

.action-buttons {
  display: flex;
  gap: 15px;
  margin-top: 20px;
}

.btn-action {
  flex: 1;
  padding: 12px 20px;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  font-size: 1em;
}

.btn-email {
  background: #28a745;
  color: white;
}

.btn-pdf {
  background: #dc3545;
  color: white;
}

.btn-contract {
  background: #ffc107;
  color: #333;
}

.btn-action:hover {
  opacity: 0.9;
}

.error-message {
  background: #f8d7da;
  color: #721c24;
  padding: 15px;
  border-radius: 6px;
  margin: 20px 0;
  display: none;
}

.photo-upload {
  margin: 20px 0;
}

.photo-preview {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-top: 10px;
}

.photo-item {
  position: relative;
  border-radius: 6px;
  overflow: hidden;
  border: 2px solid #ddd;
}

.photo-item img {
  width: 100%;
  height: 100px;
  object-fit: cover;
}

.photo-item button {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(255, 0, 0, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 25px;
  height: 25px;
  cursor: pointer;
  font-size: 16px;
}

@media (max-width: 968px) {
  .main-content {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üèóÔ∏è InstaBid</h1>
    <p>Multi-Trade Instant Estimator</p>
  </div>

  <div class="main-content">
    <div class="left-column">
      <form id="estimateForm">
        <div class="form-group">
          <label>Select Trade *</label>
          <select id="tradeSelector" required>
            <option value="">-- Select a Trade --</option>
            <option value="roofing">Roofing</option>
            <option value="hvac">HVAC</option>
            <option value="electrical">Electrical</option>
            <option value="plumbing">Plumbing</option>
            <option value="flooring">Flooring</option>
            <option value="painting">Painting</option>
            <option value="general_contracting">General Contracting</option>
          </select>
        </div>

        <div id="dynamicFormFields"></div>

        <div class="photo-upload">
          <label>Upload Photos (Optional)</label>
          <input type="file" id="photoInput" accept="image/*" multiple>
          <div class="photo-preview" id="photoPreview"></div>
        </div>

        <div class="map-container">
          <div id="map"></div>
        </div>

        <button type="submit" class="btn-primary" id="submitBtn">Get Instant Estimate</button>
      </form>
    </div>

    <div class="right-column">
      <div class="result-section" id="resultSection">
        <h2>Your Estimate</h2>
        <div class="cost-breakdown" id="costBreakdown"></div>
        <div class="action-buttons">
          <button class="btn-action btn-email" id="emailBtn">üìß Email</button>
          <button class="btn-action btn-pdf" id="pdfBtn">üìÑ PDF</button>
          <button class="btn-action btn-contract" id="contractBtn">üìù Contract</button>
        </div>
      </div>
      <div class="error-message" id="errorMessage"></div>
    </div>
  </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5u7bMfb76Il4K9x6oP-k2wccwB1mbSP0&libraries=places"></script>
<script>
var TRADE_FORM_SCHEMA = {
  roofing: [
  { name: 'name', label: 'Full Name', type: 'text', required: true },
  { name: 'email', label: 'Email', type: 'email', required: true },
  { name: 'phone', label: 'Phone', type: 'tel', required: true },
  { name: 'address', label: 'Property Address', type: 'text', required: true },
  { name: 'city', label: 'City', type: 'text', required: true },
  { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
  { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
  { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
  { name: 'pitch', label: 'Roof Pitch (e.g., 6/12)', type: 'text', required: true },
  { name: 'material', label: 'Material Cost per Sq Ft (e.g., 2.50)', type: 'text', required: true },
  { name: 'layers', label: 'Tear-Off Layers', type: 'number', required: true },
  { name: 'existingRoofType', label: 'Existing Roof Type', type: 'select', options: ['asphalt', 'tile', 'metal', 'wood_shake'], required: false },
  { name: 'needsPlywood', label: 'Plywood Decking Replacement?', type: 'checkbox', required: false },
  { name: 'plywoodSqft', label: 'Plywood Square Feet', type: 'number', required: false },
  { name: 'chimneys', label: 'Number of Chimneys', type: 'number', required: false },
  { name: 'valleys', label: 'Number of Valleys', type: 'number', required: false },
  { name: 'skylights', label: 'Number of Skylights', type: 'number', required: false },
  { name: 'ridgeVentFeet', label: 'Ridge Vent (Linear Feet)', type: 'number', required: false },
  { name: 'stories', label: 'Number of Stories', type: 'number', required: true }
],

 /* roofing: [
  { name: 'name', label: 'Full Name', type: 'text', required: true },
  { name: 'email', label: 'Email', type: 'email', required: true },
  { name: 'phone', label: 'Phone', type: 'tel', required: true },
  { name: 'address', label: 'Property Address', type: 'text', required: true },
  { name: 'city', label: 'City', type: 'text', required: true },
  { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
  { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
  { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
  { name: 'pitch', label: 'Roof Pitch', type: 'select', options: ['1.0 (Flat)', '1.1 (4/12)', '1.2 (6/12)', '1.4 (8/12)', '1.6 (10/12)', '1.8 (12/12)'], required: true },
  { name: 'material', label: 'Material Cost per Sq Ft', type: 'select', options: ['2.50 (Basic Shingle)', '3.50 (Architectural)', '5.00 (Premium)', '8.00 (Metal)', '12.00 (Tile)'], required: true },
  { name: 'layers', label: 'Tear-Off Layers', type: 'select', options: ['0', '1', '2', '3'], required: true },
  { name: 'chimneys', label: 'Number of Chimneys', type: 'number', required: true },
  { name: 'valleys', label: 'Number of Valleys', type: 'number', required: true },
  { name: 'stories', label: 'Number of Stories', type: 'number', required: true }
],*/
  <div id="roofing-form" class="trade-form" style="display:none;">
  <h3>Roofing Project Details</h3>
  
  <div class="form-group">
    <label>Square Feet *</label>
    <input type="number" name="squareFeet" placeholder="2000" required>
  </div>
  
  <div class="form-group">
    <label>Roof Pitch *</label>
    <input type="text" name="pitch" placeholder="6/12 or 8/12" required>
    <small>Enter as ratio (e.g., 4/12, 6/12, 9/12)</small>
  </div>
  
  <div class="form-group">
    <label>Material Cost per SqFt *</label>
    <input type="text" name="material" placeholder="$2.50" required>
    <small>Material cost per square foot (e.g., 2.50, 3.75)</small>
  </div>
  
  <div class="form-group">
    <label>Layers to Remove</label>
    <input type="number" name="layers" placeholder="1" value="1" min="0">
  </div>
  
  <div class="form-group">
    <label>Existing Roof Type</label>
    <select name="existingRoofType">
      <option value="asphalt">Asphalt Shingles</option>
      <option value="tile">Tile (higher disposal cost)</option>
      <option value="metal">Metal</option>
      <option value="wood_shake">Wood Shake</option>
    </select>
  </div>
  
  <div class="form-group">
    <label>
      <input type="checkbox" name="needsPlywood" value="yes"> Plywood Decking Replacement Needed?
    </label>
  </div>
  
  <div class="form-group">
    <label>Plywood Square Feet (if needed)</label>
    <input type="number" name="plywoodSqft" placeholder="0" value="0" min="0">
    <small>Estimated sqft of plywood decking to replace</small>
  </div>
  
  <div class="form-group">
    <label>Number of Chimneys</label>
    <input type="number" name="chimneys" placeholder="0" value="0" min="0">
  </div>
  
  <div class="form-group">
    <label>Number of Valleys</label>
    <input type="number" name="valleys" placeholder="0" value="0" min="0">
  </div>
  
  <div class="form-group">
    <label>Number of Skylights</label>
    <input type="number" name="skylights" placeholder="0" value="0" min="0">
    <small>$300 each for flashing work</small>
  </div>
  
  <div class="form-group">
    <label>Ridge Vent (Linear Feet)</label>
    <input type="number" name="ridgeVentFeet" placeholder="0" value="0" min="0">
    <small>$10 per linear foot</small>
  </div>
  
  <div class="form-group">
    <label>Number of Stories</label>
    <input type="number" name="stories" placeholder="1" value="1" min="1" max="3">
  </div>
  
  <button type="submit" class="submit-btn">Get Roofing Estimate</button>
</div>
  
  hvac: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'systemType', label: 'System Type', type: 'select', options: ['Central AC', 'Heat Pump', 'Furnace', 'Ductless Mini-Split'], required: true },
    { name: 'units', label: 'Number of Units', type: 'number', required: true }
  ],
  electrical: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'serviceType', label: 'Service Type', type: 'select', options: ['Panel Upgrade', 'Rewiring', 'New Outlets', 'Lighting'], required: true }
  ],
  plumbing: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'serviceType', label: 'Service Type', type: 'select', options: ['Repiping', 'Drain Cleaning', 'Water Heater', 'Fixture Installation'], required: true },
    { name: 'bathrooms', label: 'Number of Bathrooms', type: 'number', required: true }
  ],
  flooring: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'floorType', label: 'Floor Type', type: 'select', options: ['Hardwood', 'Laminate', 'Tile', 'Carpet', 'Vinyl'], required: true },
    { name: 'rooms', label: 'Number of Rooms', type: 'number', required: true }
  ],
  painting: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'paintType', label: 'Paint Type', type: 'select', options: ['Interior', 'Exterior', 'Both'], required: true },
    { name: 'rooms', label: 'Number of Rooms', type: 'number', required: true }
  ],
  general_contracting: [
    { name: 'name', label: 'Full Name', type: 'text', required: true },
    { name: 'email', label: 'Email', type: 'email', required: true },
    { name: 'phone', label: 'Phone', type: 'tel', required: true },
    { name: 'address', label: 'Property Address', type: 'text', required: true },
    { name: 'city', label: 'City', type: 'text', required: true },
    { name: 'state', label: 'State', type: 'select', options: ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'], required: true },
    { name: 'zip', label: 'ZIP Code', type: 'text', required: true },
    { name: 'squareFeet', label: 'Square Feet', type: 'number', required: true },
    { name: 'projectType', label: 'Project Type', type: 'select', options: ['Remodel', 'Addition', 'New Construction', 'Renovation'], required: true },
    { name: 'projectDetails', label: 'Project Details', type: 'textarea', required: true }
  ]
};

var selectedTrade = null;
var map = null;
var marker = null;
var uploadedPhotos = [];
var currentEstimateData = null;

document.getElementById('tradeSelector').addEventListener('change', function() {
  selectedTrade = this.value;
  if (selectedTrade) {
    renderForm(selectedTrade);
  } else {
    document.getElementById('dynamicFormFields').innerHTML = '';
  }
});

/*function renderForm(trade) {
  var container = document.getElementById('dynamicFormFields');
  container.innerHTML = '';
  
  var schema = TRADE_FORM_SCHEMA[trade];
  
  for (var i = 0; i < schema.length; i++) {
    var field = schema[i];
    var formGroup = document.createElement('div');
    formGroup.className = 'form-group';
    
    var label = document.createElement('label');
    label.textContent = field.label + (field.required ? ' *' : '');
    formGroup.appendChild(label);
    
    var input;
    if (field.type === 'select') {
      input = document.createElement('select');
      input.innerHTML = '<option value="">Select...</option>';
      for (var j = 0; j < field.options.length; j++) {
        var option = document.createElement('option');
        option.value = field.options[j];
        option.textContent = field.options[j];
        input.appendChild(option);
      }
    } else if (field.type === 'textarea') {
      input = document.createElement('textarea');
      input.rows = 4;
    } else {
      input = document.createElement('input');
      input.type = field.type;
    }
    
    input.name = field.name;
    input.id = field.name;
    input.required = field.required;
    
    formGroup.appendChild(input);
    container.appendChild(formGroup);
  }
  
  setTimeout(initMap, 100);
}*/

  function renderForm(trade) {
  var container = document.getElementById('dynamicFormFields');
  container.innerHTML = '';
  
  var schema = TRADE_FORM_SCHEMA[trade];
  
  for (var i = 0; i < schema.length; i++) {
    var field = schema[i];
    var formGroup = document.createElement('div');
    formGroup.className = 'form-group';
    
    var input;
    
    if (field.type === 'checkbox') {
      var label = document.createElement('label');
      input = document.createElement('input');
      input.type = 'checkbox';
      input.name = field.name;
      input.id = field.name;
      input.value = 'yes';
      label.appendChild(input);
      label.appendChild(document.createTextNode(' ' + field.label));
      formGroup.appendChild(label);
    } else {
      var label = document.createElement('label');
      label.textContent = field.label + (field.required ? ' *' : '');
      formGroup.appendChild(label);
      
      if (field.type === 'select') {
        input = document.createElement('select');
        input.innerHTML = '<option value="">Select...</option>';
        for (var j = 0; j < field.options.length; j++) {
          var option = document.createElement('option');
          option.value = field.options[j];
          option.textContent = field.options[j];
          input.appendChild(option);
        }
      } else if (field.type === 'textarea') {
        input = document.createElement('textarea');
        input.rows = 4;
      } else {
        input = document.createElement('input');
        input.type = field.type;
      }
      
      input.name = field.name;
      input.id = field.name;
      input.required = field.required;
      
      formGroup.appendChild(input);
    }
    
    container.appendChild(formGroup);
  }
  
  setTimeout(initMap, 100);
}

document.getElementById('photoInput').addEventListener('change', function(e) {
  var files = Array.prototype.slice.call(e.target.files);
  for (var i = 0; i < files.length; i++) {
    var file = files[i];
    var reader = new FileReader();
    reader.onload = function(event) {
      uploadedPhotos.push(event.target.result);
      renderPhotos();
    };
    reader.readAsDataURL(file);
  }
});

function renderPhotos() {
  var container = document.getElementById('photoPreview');
  container.innerHTML = '';
  for (var i = 0; i < uploadedPhotos.length; i++) {
    var photo = uploadedPhotos[i];
    var div = document.createElement('div');
    div.className = 'photo-item';
    div.innerHTML = '<img src="' + photo + '" alt="Photo ' + (i + 1) + '"><button type="button" onclick="removePhoto(' + i + ')">√ó</button>';
    container.appendChild(div);
  }
}

function removePhoto(index) {
  uploadedPhotos.splice(index, 1);
  renderPhotos();
}

function initMap() {
  var mapDiv = document.getElementById('map');
  map = new google.maps.Map(mapDiv, {
    center: { lat: 39.8283, lng: -98.5795 },
    zoom: 4,
    mapTypeId: 'satellite'
  });
  
  var addressInput = document.getElementById('address');
  if (addressInput) {
    var autocomplete = new google.maps.places.Autocomplete(addressInput);
    autocomplete.addListener('place_changed', function() {
      var place = autocomplete.getPlace();
      if (place.geometry) {
        map.setCenter(place.geometry.location);
        map.setZoom(18);
        
        if (marker) marker.setMap(null);
        marker = new google.maps.Marker({
          position: place.geometry.location,
          map: map
        });
        
        var components = place.address_components;
        for (var i = 0; i < components.length; i++) {
          var comp = components[i];
          if (comp.types.indexOf('locality') > -1) {
            document.getElementById('city').value = comp.long_name;
          }
          if (comp.types.indexOf('administrative_area_level_1') > -1) {
            document.getElementById('state').value = comp.short_name;
          }
          if (comp.types.indexOf('postal_code') > -1) {
            document.getElementById('zip').value = comp.long_name;
          }
        }
      }
    });
  }
}

/*document.getElementById('estimateForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  var formData = new FormData(e.target);
  var data = {};
  
  formData.forEach(function(value, key) {
    data[key] = value;
  });
  
  data.trade = selectedTrade;
  data.photos = uploadedPhotos;
  
  var submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = '‚è≥ Processing...';
  
  fetch('https://roofbid-backend-production.up.railway.app/api/calculate-estimate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(function(response) {
    return response.json().then(function(result) {
      return { ok: response.ok, result: result };
    });
  })
  .then(function(data) {
    if (data.ok) {
      currentEstimateData = Object.assign({}, data.result);
      displayResults(data.result);
    } else {
      showError(data.result.error || 'Failed to calculate estimate');
    }
    submitBtn.disabled = false;
    submitBtn.textContent = 'Get Instant Estimate';
  })
  .catch(function(error) {
    showError('Network error: ' + error.message);
    submitBtn.disabled = false;
    submitBtn.textContent = 'Get Instant Estimate';
  });
});*/

 /* document.getElementById('estimateForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  var formData = new FormData(e.target);
  var data = {};
  
  formData.forEach(function(value, key) {
    data[key] = value;
  }); */

  document.getElementById('estimateForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  var formData = new FormData(e.target);
  var data = {};
  
  // Handle regular fields
  formData.forEach(function(value, key) {
    data[key] = value;
  });
  
  // Handle unchecked checkboxes (they don't appear in FormData)
  var checkboxes = e.target.querySelectorAll('input[type="checkbox"]');
  for (var i = 0; i < checkboxes.length; i++) {
    var cb = checkboxes[i];
    if (!data[cb.name]) {
      data[cb.name] = cb.checked ? 'yes' : 'no';
    }
  }

  
  data.trade = selectedTrade;
  data.photos = uploadedPhotos;
  
  console.log('About to send:', data);  // <-- ADD THIS LINE
  
  var submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = '‚è≥ Processing...';
  
  fetch('https://roofbid-backend-production.up.railway.app/api/calculate-estimate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(function(response) {
    console.log('Response received:', response);  // <-- ADD THIS LINE
    return response.json().then(function(result) {
      console.log('Parsed JSON:', result);  // <-- ADD THIS LINE
      return { ok: response.ok, result: result };
    });
  })
  .then(function(data) {
    if (data.ok) {
      currentEstimateData = Object.assign({}, data.result);
      displayResults(data.result);
    } else {
      showError(data.result.error || 'Failed to calculate estimate');
    }
    submitBtn.disabled = false;
    submitBtn.textContent = 'Get Instant Estimate';
  })
  .catch(function(error) {
    showError('Network error: ' + error.message);
    submitBtn.disabled = false;
    submitBtn.textContent = 'Get Instant Estimate';
  });
});

/*function displayResults(result) {
  var breakdown = document.getElementById('costBreakdown');
  breakdown.innerHTML = '<div class="cost-item"><span>Material Cost:</span><span>$' + result.materialCost.toFixed(2) + '</span></div><div class="cost-item"><span>Labor Cost:</span><span>$' + result.laborCost.toFixed(2) + '</span></div><div class="cost-item"><span>Fixed Costs:</span><span>$' + result.fixedCosts.toFixed(2) + '</span></div><div class="cost-item"><span>Region: ' + result.msa + '</span><span>Index: ' + result.costIndex.toFixed(2) + '</span></div><div class="cost-item"><span>Total Cost:</span><span>$' + result.totalCost.toFixed(2) + '</span></div>';
  
  document.getElementById('resultSection').classList.add('active');
}*/

function displayResults(result) {
  var breakdown = document.getElementById('costBreakdown');
  
  var itemsHTML = '';
  result.lineItems.forEach(function(item) {
    itemsHTML += '<div class="cost-item"><span>' + item.description + ':</span><span>$' + item.amount.toFixed(2) + '</span></div>';
  });
  
  breakdown.innerHTML = itemsHTML + 
    '<div class="cost-item"><span>Subtotal:</span><span>$' + result.subtotal.toFixed(2) + '</span></div>' +
    '<div class="cost-item"><span>Tax (8.25%):</span><span>$' + result.tax.toFixed(2) + '</span></div>' +
    '<div class="cost-item"><span>Region: ' + result.msa + '</span><span>Timeline: ' + result.timeline + '</span></div>' +
    '<div class="cost-item"><span>Total Cost:</span><span>$' + result.total.toFixed(2) + '</span></div>';
  
  document.getElementById('resultSection').classList.add('active');
}

function showError(message) {
  var errorDiv = document.getElementById('errorMessage');
  errorDiv.textContent = '‚ùå ' + message;
  errorDiv.style.display = 'block';
  setTimeout(function() {
    errorDiv.style.display = 'none';
  }, 5000);
}

document.getElementById('emailBtn').addEventListener('click', function() {
  if (!currentEstimateData) return;
  
  this.disabled = true;
  this.textContent = '‚è≥ Sending...';
  
  var self = this;
  
  fetch('https://roofbid-backend-production.up.railway.app/api/send-estimate-email', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(currentEstimateData)
  })
  .then(function(response) {
    return response.json().then(function(result) {
      return { ok: response.ok, result: result };
    });
  })
  .then(function(data) {
    if (data.ok) {
      alert('‚úÖ Email sent successfully!');
    } else {
      alert('‚ùå Failed to send email: ' + (data.result.error || 'Unknown error'));
    }
    self.disabled = false;
    self.textContent = 'üìß Email';
  })
  .catch(function(error) {
    alert('‚ùå Network error: ' + error.message);
    self.disabled = false;
    self.textContent = 'üìß Email';
  });
});

document.getElementById('pdfBtn').addEventListener('click', function() {
  if (!currentEstimateData) return;
  alert('PDF generation coming soon!');
});

document.getElementById('contractBtn').addEventListener('click', function() {
  if (!currentEstimateData) return;
  alert('Contract generation coming soon!');
});
</script>

</body>
</html>
